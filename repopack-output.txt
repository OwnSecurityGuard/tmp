This file is a merged representation of the entire codebase, combining all repository files into a single document.
Generated by Repopack on: 2026-01-10T06:35:27.522Z

================================================================
File Summary
================================================================

Purpose:
--------
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

File Format:
------------
The content is organized as follows:
1. This summary section
2. Repository information
3. Repository structure
4. Multiple file entries, each consisting of:
  a. A separator line (================)
  b. The file path (File: path/to/file)
  c. Another separator line
  d. The full contents of the file
  e. A blank line

Usage Guidelines:
-----------------
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

Notes:
------
- Some files may have been excluded based on .gitignore rules and Repopack's
  configuration.
- Binary files are not included in this packed representation. Please refer to
  the Repository Structure section for a complete list of file paths, including
  binary files.

Additional Info:
----------------

For more information about Repopack, visit: https://github.com/yamadashy/repopack

================================================================
Repository Structure
================================================================
cmd/refactor/main.go
cmd/server/main.go
cmd/test/client/main.go
cmd/test/common/common.go
cmd/test/main.go
go.mod
go.sum
internal/app/app.go
internal/app/events.go
internal/app/filter_loader.go
internal/app/model2struct.go
internal/app/notifier.go
internal/app/proxy_manager.go
internal/app/proxy_traffic_hook.go
internal/app/tmp.go
internal/app/wiring.go
internal/handler/proxy_handler.go
internal/middleware/cors.go
internal/modules/filter/compiled.go
internal/modules/filter/engine.go
internal/modules/filter/repository.go
internal/modules/filter/types.go
internal/modules/proxy/config.go
internal/modules/shadowsocks/connection.go
internal/modules/shadowsocks/dialer.go
internal/modules/shadowsocks/server_test.go
internal/modules/shadowsocks/server.go
internal/modules/shared/id.go
internal/modules/websocket/conn.go
internal/modules/websocket/hub.go
internal/modules/websocket/types.go
internal/modules/websocket/upgrader.go
internal/service/compat/integration_test.go
internal/service/compat/plugin.go
internal/service/compat/shadowsocks.go
internal/service/compat/websocket.go
internal/service/core/websocket/service.go
internal/service/core/websocket/types.go
internal/service/packet/filter_test.go
internal/service/packet/filter.go
internal/service/plugin/plugin_service.go
internal/service/plugin/types.go
internal/storage/filter/model.go
internal/storage/filter/repository.go
internal/storage/filter/sqlite.go
internal/traffic/context.go
internal/types/config.go
internal/types/plugin.go
makefile
plugins/æµ‹è¯•
plugins/asd
plugins/we
proto/common.proto
proto/common/common.pb.go
proto/plugin.proto
proto/plugin/plugin_grpc.pb.go
proto/plugin/plugin.pb.go
proto/raw_packet.proto
proto/raw/raw_packet.pb.go
proto/visual_message.proto
proto/visual/visual_message.pb.go

================================================================
Repository Files
================================================================

================
File: cmd/refactor/main.go
================
package main

import (
	"encoding/json"
	"github.com/gin-contrib/cors"
	"github.com/gin-gonic/gin"
	"log"
	"proxy-system-backend/internal/app"
	"proxy-system-backend/internal/handler"
	"proxy-system-backend/internal/modules/websocket"

	"time"
)

func main() {
	appCore := app.New()

	// ===== 2ï¸âƒ£ WebSocket Hub =====
	hub := websocket.NewHub(websocket.Config{
		PingInterval: 30 * time.Second,
	})
	go hub.Run()

	// ===== 3ï¸âƒ£ App â†’ WS =====
	appCore.Subscribe(func(e app.Event) {
		// ç»Ÿä¸€äº‹ä»¶ â†’ JSON

		data, err := json.Marshal(e)
		if err != nil {
			return
		}
		hub.Broadcast(data)
	})

	// ===== 4ï¸âƒ£ HTTP =====
	r := gin.Default()
	r.Use(cors.New(cors.Config{
		AllowOrigins:     []string{"http://localhost:3000"}, // å‰ç«¯åœ°å€
		AllowMethods:     []string{"GET", "POST", "PUT", "DELETE", "OPTIONS"},
		AllowHeaders:     []string{"Origin", "Content-Type", "Authorization"},
		ExposeHeaders:    []string{"Content-Length"},
		AllowCredentials: true,
		MaxAge:           12 * time.Hour,
	}))
	// WebSocket
	r.GET("/api/ws", hub.Handle)

	// API
	proxyHandler := handler.NewProxyHandler(appCore)
	api := r.Group("/api")
	{
		api.POST("/proxy/start", proxyHandler.StartProxy)
	}

	// ===== 5ï¸âƒ£ Start =====
	addr := ":8081"
	log.Println("ðŸš€ server listening on", addr)
	if err := r.Run(addr); err != nil {
		log.Fatal(err)
	}
}

================
File: cmd/server/main.go
================
package main

import (
	"github.com/gin-gonic/gin"
	"log"
	"proxy-system-backend/internal/handler"
	"proxy-system-backend/internal/middleware"
	"proxy-system-backend/internal/service/compat"
	"proxy-system-backend/internal/service/core/websocket"
	"proxy-system-backend/internal/types"
)

func main() {
	r := gin.Default()

	r.Use(middleware.CORS())
	r.Use(middleware.Recovery())

	// åˆå§‹åŒ–æ’ä»¶æœåŠ¡ï¼ˆä½¿ç”¨å…¼å®¹æ€§åŒ…è£…å™¨ï¼‰
	pluginConfig := types.PluginManagerConfig{
		PluginDir: "./plugins",
		MaxSize:   50 * 1024 * 1024, // 50MB
	}
	pluginService := compat.NewPluginService(pluginConfig)
	if err := pluginService.Initialize(); err != nil {
		log.Printf("Warning: failed to initialize plugin service: %v", err)
	}

	// åˆå§‹åŒ–WebSocketæœåŠ¡
	wsService := compat.NewWebSocketService()

	// å¯åŠ¨ WebSocket æœåŠ¡
	go wsService.Run()

	// åˆ›å»ºShadowsocksæœåŠ¡ï¼ˆåŒ…å«é›†æˆè¿‡æ»¤åŠŸèƒ½ï¼‰
	shadowsocksService := compat.NewShadowsocksService(wsService, pluginService)

	// å¯åŠ¨ WebSocket æœåŠ¡
	go wsService.Run()

	api := r.Group("/api")
	{
		handler.SetupWebSocketRoutes(api, wsService)
		 
	}

	r.GET("/health", func(c *gin.Context) {
		c.JSON(200, gin.H{"status": "ok"})
	})

	// ä½¿ç”¨ defer ç¡®ä¿ç¨‹åºé€€å‡ºæ—¶æ¸…ç†èµ„æº
	defer func() {
		if pluginService != nil {
			// æ’ä»¶æœåŠ¡ä¼šåœ¨åžƒåœ¾å›žæ”¶æ—¶è‡ªåŠ¨å…³é—­æ•°æ®åº“è¿žæŽ¥
			log.Println("Cleaning up resources...")
		}
	}()

	log.Println("Starting HTTP server on :8081")
	if err := r.Run(":8081"); err != nil {
		log.Fatal("Failed to start HTTP server:", err)
	}
}

================
File: cmd/test/client/main.go
================
package main

import (
	"context"
	"github.com/hashicorp/go-plugin"
	"proxy-system-backend/cmd/test/common"
	plugin2 "proxy-system-backend/proto/plugin"
	"proxy-system-backend/proto/visual"
)

type DemoPlugin struct{}

func (d *DemoPlugin) Info(ctx context.Context) (*plugin2.PluginInfo, error) {
	return &plugin2.PluginInfo{
		Name:        "demo-plugin",
		Game:        "demo-game",
		Version:     "v1.0.0",
		Author:      "you",
		Description: "demo protocol plugin",
		Protocols: []*plugin2.ProtocolDesc{
			{Id: "v1", DisplayName: "Demo Protocol v1"},
		},
	}, nil
}

func (d *DemoPlugin) Decode(
	ctx context.Context,
	req *plugin2.DecodeRequest,
) (*plugin2.DecodeResponse, error) {

	// å‡è£…è§£ç 
	msg := &visual.VisualMessage{
		Id:        "12",
		ConnId:    "213",
		Timestamp: 23,
		Direction: 0,
		Name:      "",
		Category:  "",
		Summary:   "",
		Fields:    nil,
		Raw:       nil,
		Tags:      nil,
	}

	return &plugin2.DecodeResponse{
		Messages: []*visual.VisualMessage{msg},
	}, nil
}

func (d *DemoPlugin) ResetConn(ctx context.Context, req *plugin2.ResetConnRequest) error {
	// demo ä»€ä¹ˆéƒ½ä¸åš
	return nil
}

func main() {
	plugin.Serve(&plugin.ServeConfig{
		HandshakeConfig: plugin.HandshakeConfig{
			ProtocolVersion:  1,
			MagicCookieKey:   "GAME_PROTOCOL_PLUGIN",
			MagicCookieValue: "hello",
		},
		Plugins: map[string]plugin.Plugin{
			"game_protocol": &common.GRPCPlugin{
				Impl: &DemoPlugin{},
			},
		},
		GRPCServer: plugin.DefaultGRPCServer,
	})
}

================
File: cmd/test/common/common.go
================
package common

import (
	"context"
	"github.com/hashicorp/go-plugin"
	"google.golang.org/grpc"
	"google.golang.org/protobuf/types/known/emptypb"
	plugin2 "proxy-system-backend/proto/plugin"
)

var PluginMap = map[string]plugin.Plugin{
	"kv_grpc": &GRPCPlugin{},
}

type GameProtocol interface {
	Info(ctx context.Context) (*plugin2.PluginInfo, error)
	Decode(ctx context.Context, req *plugin2.DecodeRequest) (*plugin2.DecodeResponse, error)
	ResetConn(ctx context.Context, req *plugin2.ResetConnRequest) error
}

type GRPCPlugin struct {
	plugin.Plugin
	Impl GameProtocol
}

func (p *GRPCPlugin) GRPCServer(
	broker *plugin.GRPCBroker,
	s *grpc.Server,
) error {
	plugin2.RegisterGameProtocolPluginServer(
		s,
		&GRPCServer{Impl: p.Impl},
	)
	return nil
}

func (p *GRPCPlugin) GRPCClient(
	ctx context.Context,
	broker *plugin.GRPCBroker,
	c *grpc.ClientConn,
) (interface{}, error) {
	return &GRPCClient{
		client: plugin2.NewGameProtocolPluginClient(c),
	}, nil
}

type GRPCClient struct {
	client plugin2.GameProtocolPluginClient
}

func (c *GRPCClient) Info(ctx context.Context) (*plugin2.PluginInfo, error) {
	return c.client.Info(ctx, &emptypb.Empty{})
}

func (c *GRPCClient) Decode(
	ctx context.Context,
	req *plugin2.DecodeRequest,
) (*plugin2.DecodeResponse, error) {
	return c.client.Decode(ctx, req)
}

func (c *GRPCClient) ResetConn(
	ctx context.Context,
	req *plugin2.ResetConnRequest,
) error {
	_, err := c.client.ResetConn(ctx, req)
	return err
}

type GRPCServer struct {
	plugin2.UnimplementedGameProtocolPluginServer
	Impl GameProtocol
}

func (s *GRPCServer) Info(ctx context.Context, _ *emptypb.Empty) (*plugin2.PluginInfo, error) {
	return s.Impl.Info(ctx)
}

func (s *GRPCServer) Decode(ctx context.Context, req *plugin2.DecodeRequest) (*plugin2.DecodeResponse, error) {
	return s.Impl.Decode(ctx, req)
}

func (s *GRPCServer) ResetConn(ctx context.Context, req *plugin2.ResetConnRequest) (*emptypb.Empty, error) {
	err := s.Impl.ResetConn(ctx, req)
	return &emptypb.Empty{}, err
}

================
File: cmd/test/main.go
================
package main

import (
	"context"
	"fmt"
	"github.com/hashicorp/go-plugin"
	"os/exec"
	"proxy-system-backend/cmd/test/common"
)

func main() {
	client := plugin.NewClient(&plugin.ClientConfig{
		HandshakeConfig: plugin.HandshakeConfig{
			ProtocolVersion:  1,
			MagicCookieKey:   "GAME_PROTOCOL_PLUGIN",
			MagicCookieValue: "hello",
		},
		Plugins: common.PluginMap,
		Cmd:     exec.Command("E:\\reply\\backend\\cmd\\test\\client\\test.exe"),

		AllowedProtocols: []plugin.Protocol{
			plugin.ProtocolGRPC},
	})
	defer client.Kill()
	rpcClient, err := client.Client()
	if err != nil {
		fmt.Println(err)
		return
	}
	raw, err := rpcClient.Dispense("kv_grpc")

	decoder := raw.(common.GameProtocol)

	info, _ := decoder.Info(context.Background())
	fmt.Println("info ", info.Name)

}

================
File: go.mod
================
module proxy-system-backend

go 1.24.0

toolchain go1.24.10

require (
	github.com/gin-contrib/cors v1.7.6
	github.com/gin-gonic/gin v1.10.1
	github.com/gorilla/websocket v1.5.1
	github.com/hashicorp/go-plugin v1.7.0
	github.com/shadowsocks/go-shadowsocks2 v0.1.5
	google.golang.org/grpc v1.78.0
	google.golang.org/protobuf v1.36.10
	gorm.io/gorm v1.31.1
	modernc.org/sqlite v1.27.0
)

require (
	github.com/bytedance/sonic v1.13.3 // indirect
	github.com/bytedance/sonic/loader v0.2.4 // indirect
	github.com/cloudwego/base64x v0.1.5 // indirect
	github.com/dustin/go-humanize v1.0.1 // indirect
	github.com/fatih/color v1.13.0 // indirect
	github.com/gabriel-vasile/mimetype v1.4.9 // indirect
	github.com/gin-contrib/sse v1.1.0 // indirect
	github.com/go-playground/locales v0.14.1 // indirect
	github.com/go-playground/universal-translator v0.18.1 // indirect
	github.com/go-playground/validator/v10 v10.26.0 // indirect
	github.com/goccy/go-json v0.10.5 // indirect
	github.com/golang/protobuf v1.5.4 // indirect
	github.com/google/uuid v1.6.0 // indirect
	github.com/hashicorp/go-hclog v1.6.3 // indirect
	github.com/hashicorp/yamux v0.1.2 // indirect
	github.com/jinzhu/inflection v1.0.0 // indirect
	github.com/jinzhu/now v1.1.5 // indirect
	github.com/json-iterator/go v1.1.12 // indirect
	github.com/kballard/go-shellquote v0.0.0-20180428030007-95032a82bc51 // indirect
	github.com/klauspost/cpuid/v2 v2.2.10 // indirect
	github.com/kr/text v0.2.0 // indirect
	github.com/leodido/go-urn v1.4.0 // indirect
	github.com/mattn/go-colorable v0.1.12 // indirect
	github.com/mattn/go-isatty v0.0.20 // indirect
	github.com/modern-go/concurrent v0.0.0-20180306012644-bacd9c7ef1dd // indirect
	github.com/modern-go/reflect2 v1.0.2 // indirect
	github.com/oklog/run v1.1.0 // indirect
	github.com/pelletier/go-toml/v2 v2.2.4 // indirect
	github.com/remyoudompheng/bigfft v0.0.0-20230129092748-24d4a6f8daec // indirect
	github.com/riobard/go-bloom v0.0.0-20200614022211-cdc8013cb5b3 // indirect
	github.com/twitchyliquid64/golang-asm v0.15.1 // indirect
	github.com/ugorji/go/codec v1.3.0 // indirect
	golang.org/x/arch v0.18.0 // indirect
	golang.org/x/crypto v0.44.0 // indirect
	golang.org/x/mod v0.29.0 // indirect
	golang.org/x/net v0.47.0 // indirect
	golang.org/x/sync v0.18.0 // indirect
	golang.org/x/sys v0.38.0 // indirect
	golang.org/x/text v0.31.0 // indirect
	golang.org/x/tools v0.38.0 // indirect
	google.golang.org/genproto/googleapis/rpc v0.0.0-20251029180050-ab9386a59fda // indirect
	gopkg.in/yaml.v3 v3.0.1 // indirect
	lukechampine.com/uint128 v1.2.0 // indirect
	modernc.org/cc/v3 v3.40.0 // indirect
	modernc.org/ccgo/v3 v3.16.13 // indirect
	modernc.org/libc v1.29.0 // indirect
	modernc.org/mathutil v1.6.0 // indirect
	modernc.org/memory v1.7.2 // indirect
	modernc.org/opt v0.1.3 // indirect
	modernc.org/strutil v1.1.3 // indirect
	modernc.org/token v1.0.1 // indirect
)

================
File: go.sum
================
github.com/bufbuild/protocompile v0.14.1 h1:iA73zAf/fyljNjQKwYzUHD6AD4R8KMasmwa/FBatYVw=
github.com/bufbuild/protocompile v0.14.1/go.mod h1:ppVdAIhbr2H8asPk6k4pY7t9zB1OU5DoEw9xY/FUi1c=
github.com/bytedance/sonic v1.13.3 h1:MS8gmaH16Gtirygw7jV91pDCN33NyMrPbN7qiYhEsF0=
github.com/bytedance/sonic v1.13.3/go.mod h1:o68xyaF9u2gvVBuGHPlUVCy+ZfmNNO5ETf1+KgkJhz4=
github.com/bytedance/sonic/loader v0.1.1/go.mod h1:ncP89zfokxS5LZrJxl5z0UJcsk4M4yY2JpfqGeCtNLU=
github.com/bytedance/sonic/loader v0.2.4 h1:ZWCw4stuXUsn1/+zQDqeE7JKP+QO47tz7QCNan80NzY=
github.com/bytedance/sonic/loader v0.2.4/go.mod h1:N8A3vUdtUebEY2/VQC0MyhYeKUFosQU6FxH2JmUe6VI=
github.com/cloudwego/base64x v0.1.5 h1:XPciSp1xaq2VCSt6lF0phncD4koWyULpl5bUxbfCyP4=
github.com/cloudwego/base64x v0.1.5/go.mod h1:0zlkT4Wn5C6NdauXdJRhSKRlJvmclQ1hhJgA0rcu/8w=
github.com/cloudwego/iasm v0.2.0/go.mod h1:8rXZaNYT2n95jn+zTI1sDr+IgcD2GVs0nlbbQPiEFhY=
github.com/creack/pty v1.1.9/go.mod h1:oKZEueFk5CKHvIhNR5MUki03XCEU+Q6VDXinZuGJ33E=
github.com/davecgh/go-spew v1.1.0/go.mod h1:J7Y8YcW2NihsgmVo/mv3lAwl/skON4iLHjSsI+c5H38=
github.com/davecgh/go-spew v1.1.1 h1:vj9j/u1bqnvCEfJOwUhtlOARqs3+rkHYY13jYWTU97c=
github.com/davecgh/go-spew v1.1.1/go.mod h1:J7Y8YcW2NihsgmVo/mv3lAwl/skON4iLHjSsI+c5H38=
github.com/dustin/go-humanize v1.0.1 h1:GzkhY7T5VNhEkwH0PVJgjz+fX1rhBrR7pRT3mDkpeCY=
github.com/dustin/go-humanize v1.0.1/go.mod h1:Mu1zIs6XwVuF/gI1OepvI0qD18qycQx+mFykh5fBlto=
github.com/fatih/color v1.13.0 h1:8LOYc1KYPPmyKMuN8QV2DNRWNbLo6LZ0iLs8+mlH53w=
github.com/fatih/color v1.13.0/go.mod h1:kLAiJbzzSOZDVNGyDpeOxJ47H46qBXwg5ILebYFFOfk=
github.com/gabriel-vasile/mimetype v1.4.9 h1:5k+WDwEsD9eTLL8Tz3L0VnmVh9QxGjRmjBvAG7U/oYY=
github.com/gabriel-vasile/mimetype v1.4.9/go.mod h1:WnSQhFKJuBlRyLiKohA/2DtIlPFAbguNaG7QCHcyGok=
github.com/gin-contrib/cors v1.7.6 h1:3gQ8GMzs1Ylpf70y8bMw4fVpycXIeX1ZemuSQIsnQQY=
github.com/gin-contrib/cors v1.7.6/go.mod h1:Ulcl+xN4jel9t1Ry8vqph23a60FwH9xVLd+3ykmTjOk=
github.com/gin-contrib/sse v1.1.0 h1:n0w2GMuUpWDVp7qSpvze6fAu9iRxJY4Hmj6AmBOU05w=
github.com/gin-contrib/sse v1.1.0/go.mod h1:hxRZ5gVpWMT7Z0B0gSNYqqsSCNIJMjzvm6fqCz9vjwM=
github.com/gin-gonic/gin v1.10.1 h1:T0ujvqyCSqRopADpgPgiTT63DUQVSfojyME59Ei63pQ=
github.com/gin-gonic/gin v1.10.1/go.mod h1:4PMNQiOhvDRa013RKVbsiNwoyezlm2rm0uX/T7kzp5Y=
github.com/go-logr/logr v1.4.3 h1:CjnDlHq8ikf6E492q6eKboGOC0T8CDaOvkHCIg8idEI=
github.com/go-logr/logr v1.4.3/go.mod h1:9T104GzyrTigFIr8wt5mBrctHMim0Nb2HLGrmQ40KvY=
github.com/go-logr/stdr v1.2.2 h1:hSWxHoqTgW2S2qGc0LTAI563KZ5YKYRhT3MFKZMbjag=
github.com/go-logr/stdr v1.2.2/go.mod h1:mMo/vtBO5dYbehREoey6XUKy/eSumjCCveDpRre4VKE=
github.com/go-playground/assert/v2 v2.2.0 h1:JvknZsQTYeFEAhQwI4qEt9cyV5ONwRHC+lYKSsYSR8s=
github.com/go-playground/assert/v2 v2.2.0/go.mod h1:VDjEfimB/XKnb+ZQfWdccd7VUvScMdVu0Titje2rxJ4=
github.com/go-playground/locales v0.14.1 h1:EWaQ/wswjilfKLTECiXz7Rh+3BjFhfDFKv/oXslEjJA=
github.com/go-playground/locales v0.14.1/go.mod h1:hxrqLVvrK65+Rwrd5Fc6F2O76J/NuW9t0sjnWqG1slY=
github.com/go-playground/universal-translator v0.18.1 h1:Bcnm0ZwsGyWbCzImXv+pAJnYK9S473LQFuzCbDbfSFY=
github.com/go-playground/universal-translator v0.18.1/go.mod h1:xekY+UJKNuX9WP91TpwSH2VMlDf28Uj24BCp08ZFTUY=
github.com/go-playground/validator/v10 v10.26.0 h1:SP05Nqhjcvz81uJaRfEV0YBSSSGMc/iMaVtFbr3Sw2k=
github.com/go-playground/validator/v10 v10.26.0/go.mod h1:I5QpIEbmr8On7W0TktmJAumgzX4CA1XNl4ZmDuVHKKo=
github.com/goccy/go-json v0.10.5 h1:Fq85nIqj+gXn/S5ahsiTlK3TmC85qgirsdTP/+DeaC4=
github.com/goccy/go-json v0.10.5/go.mod h1:oq7eo15ShAhp70Anwd5lgX2pLfOS3QCiwU/PULtXL6M=
github.com/golang/protobuf v1.5.4 h1:i7eJL8qZTpSEXOPTxNKhASYpMn+8e5Q6AdndVa1dWek=
github.com/golang/protobuf v1.5.4/go.mod h1:lnTiLA8Wa4RWRcIUkrtSVa5nRhsEGBg48fD6rSs7xps=
github.com/google/go-cmp v0.7.0 h1:wk8382ETsv4JYUZwIsn6YpYiWiBsYLSJiTsyBybVuN8=
github.com/google/go-cmp v0.7.0/go.mod h1:pXiqmnSA92OHEEa9HXL2W4E7lf9JzCmGVUdgjX3N/iU=
github.com/google/gofuzz v1.0.0/go.mod h1:dBl0BpW6vV/+mYPU4Po3pmUjxk6FQPldtuIdl/M65Eg=
github.com/google/pprof v0.0.0-20221118152302-e6195bd50e26 h1:Xim43kblpZXfIBQsbuBVKCudVG457BR2GZFIz3uw3hQ=
github.com/google/pprof v0.0.0-20221118152302-e6195bd50e26/go.mod h1:dDKJzRmX4S37WGHujM7tX//fmj1uioxKzKxz3lo4HJo=
github.com/google/uuid v1.6.0 h1:NIvaJDMOsjHA8n1jAhLSgzrAzy1Hgr+hNrb57e+94F0=
github.com/google/uuid v1.6.0/go.mod h1:TIyPZe4MgqvfeYDBFedMoGGpEw/LqOeaOT+nhxU+yHo=
github.com/gorilla/websocket v1.5.1 h1:gmztn0JnHVt9JZquRuzLw3g4wouNVzKL15iLr/zn/QY=
github.com/gorilla/websocket v1.5.1/go.mod h1:x3kM2JMyaluk02fnUJpQuwD2dCS5NDG2ZHL0uE0tcaY=
github.com/hashicorp/go-hclog v1.6.3 h1:Qr2kF+eVWjTiYmU7Y31tYlP1h0q/X3Nl3tPGdaB11/k=
github.com/hashicorp/go-hclog v1.6.3/go.mod h1:W4Qnvbt70Wk/zYJryRzDRU/4r0kIg0PVHBcfoyhpF5M=
github.com/hashicorp/go-plugin v1.7.0 h1:YghfQH/0QmPNc/AZMTFE3ac8fipZyZECHdDPshfk+mA=
github.com/hashicorp/go-plugin v1.7.0/go.mod h1:BExt6KEaIYx804z8k4gRzRLEvxKVb+kn0NMcihqOqb8=
github.com/hashicorp/yamux v0.1.2 h1:XtB8kyFOyHXYVFnwT5C3+Bdo8gArse7j2AQ0DA0Uey8=
github.com/hashicorp/yamux v0.1.2/go.mod h1:C+zze2n6e/7wshOZep2A70/aQU6QBRWJO/G6FT1wIns=
github.com/jhump/protoreflect v1.17.0 h1:qOEr613fac2lOuTgWN4tPAtLL7fUSbuJL5X5XumQh94=
github.com/jhump/protoreflect v1.17.0/go.mod h1:h9+vUUL38jiBzck8ck+6G/aeMX8Z4QUY/NiJPwPNi+8=
github.com/jinzhu/inflection v1.0.0 h1:K317FqzuhWc8YvSVlFMCCUb36O/S9MCKRDI7QkRKD/E=
github.com/jinzhu/inflection v1.0.0/go.mod h1:h+uFLlag+Qp1Va5pdKtLDYj+kHp5pxUVkryuEj+Srlc=
github.com/jinzhu/now v1.1.5 h1:/o9tlHleP7gOFmsnYNz3RGnqzefHA47wQpKrrdTIwXQ=
github.com/jinzhu/now v1.1.5/go.mod h1:d3SSVoowX0Lcu0IBviAWJpolVfI5UJVZZ7cO71lE/z8=
github.com/json-iterator/go v1.1.12 h1:PV8peI4a0ysnczrg+LtxykD8LfKY9ML6u2jnxaEnrnM=
github.com/json-iterator/go v1.1.12/go.mod h1:e30LSqwooZae/UwlEbR2852Gd8hjQvJoHmT4TnhNGBo=
github.com/kballard/go-shellquote v0.0.0-20180428030007-95032a82bc51 h1:Z9n2FFNUXsshfwJMBgNA0RU6/i7WVaAegv3PtuIHPMs=
github.com/kballard/go-shellquote v0.0.0-20180428030007-95032a82bc51/go.mod h1:CzGEWj7cYgsdH8dAjBGEr58BoE7ScuLd+fwFZ44+/x8=
github.com/klauspost/cpuid/v2 v2.0.9/go.mod h1:FInQzS24/EEf25PyTYn52gqo7WaD8xa0213Md/qVLRg=
github.com/klauspost/cpuid/v2 v2.2.10 h1:tBs3QSyvjDyFTq3uoc/9xFpCuOsJQFNPiAhYdw2skhE=
github.com/klauspost/cpuid/v2 v2.2.10/go.mod h1:hqwkgyIinND0mEev00jJYCxPNVRVXFQeu1XKlok6oO0=
github.com/knz/go-libedit v1.10.1/go.mod h1:MZTVkCWyz0oBc7JOWP3wNAzd002ZbM/5hgShxwh4x8M=
github.com/kr/pretty v0.3.0 h1:WgNl7dwNpEZ6jJ9k1snq4pZsg7DOEN8hP9Xw0Tsjwk0=
github.com/kr/pretty v0.3.0/go.mod h1:640gp4NfQd8pI5XOwp5fnNeVWj67G7CFk/SaSQn7NBk=
github.com/kr/text v0.2.0 h1:5Nx0Ya0ZqY2ygV366QzturHI13Jq95ApcVaJBhpS+AY=
github.com/kr/text v0.2.0/go.mod h1:eLer722TekiGuMkidMxC/pM04lWEeraHUUmBw8l2grE=
github.com/leodido/go-urn v1.4.0 h1:WT9HwE9SGECu3lg4d/dIA+jxlljEa1/ffXKmRjqdmIQ=
github.com/leodido/go-urn v1.4.0/go.mod h1:bvxc+MVxLKB4z00jd1z+Dvzr47oO32F/QSNjSBOlFxI=
github.com/mattn/go-colorable v0.1.9/go.mod h1:u6P/XSegPjTcexA+o6vUJrdnUu04hMope9wVRipJSqc=
github.com/mattn/go-colorable v0.1.12 h1:jF+Du6AlPIjs2BiUiQlKOX0rt3SujHxPnksPKZbaA40=
github.com/mattn/go-colorable v0.1.12/go.mod h1:u5H1YNBxpqRaxsYJYSkiCWKzEfiAb1Gb520KVy5xxl4=
github.com/mattn/go-isatty v0.0.12/go.mod h1:cbi8OIDigv2wuxKPP5vlRcQ1OAZbq2CE4Kysco4FUpU=
github.com/mattn/go-isatty v0.0.14/go.mod h1:7GGIvUiUoEMVVmxf/4nioHXj79iQHKdU27kJ6hsGG94=
github.com/mattn/go-isatty v0.0.20 h1:xfD0iDuEKnDkl03q4limB+vH+GxLEtL/jb4xVJSWWEY=
github.com/mattn/go-isatty v0.0.20/go.mod h1:W+V8PltTTMOvKvAeJH7IuucS94S2C6jfK/D7dTCTo3Y=
github.com/mattn/go-sqlite3 v1.14.22 h1:2gZY6PC6kBnID23Tichd1K+Z0oS6nE/XwU+Vz/5o4kU=
github.com/mattn/go-sqlite3 v1.14.22/go.mod h1:Uh1q+B4BYcTPb+yiD3kU8Ct7aC0hY9fxUwlHK0RXw+Y=
github.com/modern-go/concurrent v0.0.0-20180228061459-e0a39a4cb421/go.mod h1:6dJC0mAP4ikYIbvyc7fijjWJddQyLn8Ig3JB5CqoB9Q=
github.com/modern-go/concurrent v0.0.0-20180306012644-bacd9c7ef1dd h1:TRLaZ9cD/w8PVh93nsPXa1VrQ6jlwL5oN8l14QlcNfg=
github.com/modern-go/concurrent v0.0.0-20180306012644-bacd9c7ef1dd/go.mod h1:6dJC0mAP4ikYIbvyc7fijjWJddQyLn8Ig3JB5CqoB9Q=
github.com/modern-go/reflect2 v1.0.2 h1:xBagoLtFs94CBntxluKeaWgTMpvLxC4ur3nMaC9Gz0M=
github.com/modern-go/reflect2 v1.0.2/go.mod h1:yWuevngMOJpCy52FWWMvUC8ws7m/LJsjYzDa0/r8luk=
github.com/oklog/run v1.1.0 h1:GEenZ1cK0+q0+wsJew9qUg/DyD8k3JzYsZAi5gYi2mA=
github.com/oklog/run v1.1.0/go.mod h1:sVPdnTZT1zYwAJeCMu2Th4T21pA3FPOQRfWjQlk7DVU=
github.com/pelletier/go-toml/v2 v2.2.4 h1:mye9XuhQ6gvn5h28+VilKrrPoQVanw5PMw/TB0t5Ec4=
github.com/pelletier/go-toml/v2 v2.2.4/go.mod h1:2gIqNv+qfxSVS7cM2xJQKtLSTLUE9V8t9Stt+h56mCY=
github.com/pmezard/go-difflib v1.0.0 h1:4DBwDE0NGyQoBHbLQYPwSUPoCMWR5BEzIk/f1lZbAQM=
github.com/pmezard/go-difflib v1.0.0/go.mod h1:iKH77koFhYxTK1pcRnkKkqfTogsbg7gZNVY4sRDYZ/4=
github.com/remyoudompheng/bigfft v0.0.0-20230129092748-24d4a6f8daec h1:W09IVJc94icq4NjY3clb7Lk8O1qJ8BdBEF8z0ibU0rE=
github.com/remyoudompheng/bigfft v0.0.0-20230129092748-24d4a6f8daec/go.mod h1:qqbHyh8v60DhA7CoWK5oRCqLrMHRGoxYCSS9EjAz6Eo=
github.com/riobard/go-bloom v0.0.0-20200614022211-cdc8013cb5b3 h1:f/FNXud6gA3MNr8meMVVGxhp+QBTqY91tM8HjEuMjGg=
github.com/riobard/go-bloom v0.0.0-20200614022211-cdc8013cb5b3/go.mod h1:HgjTstvQsPGkxUsCd2KWxErBblirPizecHcpD3ffK+s=
github.com/rogpeppe/go-internal v1.8.0 h1:FCbCCtXNOY3UtUuHUYaghJg4y7Fd14rXifAYUAtL9R8=
github.com/rogpeppe/go-internal v1.8.0/go.mod h1:WmiCO8CzOY8rg0OYDC4/i/2WRWAB6poM+XZ2dLUbcbE=
github.com/shadowsocks/go-shadowsocks2 v0.1.5 h1:PDSQv9y2S85Fl7VBeOMF9StzeXZyK1HakRm86CUbr28=
github.com/shadowsocks/go-shadowsocks2 v0.1.5/go.mod h1:AGGpIoek4HRno4xzyFiAtLHkOpcoznZEkAccaI/rplM=
github.com/stretchr/objx v0.1.0/go.mod h1:HFkY916IF+rwdDfMAkV7OtwuqBVzrE8GR6GFx+wExME=
github.com/stretchr/objx v0.4.0/go.mod h1:YvHI0jy2hoMjB+UWwv71VJQ9isScKT/TqJzVSSt89Yw=
github.com/stretchr/objx v0.5.0/go.mod h1:Yh+to48EsGEfYuaHDzXPcE3xhTkx73EhmCGUpEOglKo=
github.com/stretchr/testify v1.3.0/go.mod h1:M5WIy9Dh21IEIfnGCwXGc5bZfKNJtfHm1UVUgZn+9EI=
github.com/stretchr/testify v1.7.0/go.mod h1:6Fq8oRcR53rry900zMqJjRRixrwX3KX962/h/Wwjteg=
github.com/stretchr/testify v1.7.1/go.mod h1:6Fq8oRcR53rry900zMqJjRRixrwX3KX962/h/Wwjteg=
github.com/stretchr/testify v1.7.2/go.mod h1:R6va5+xMeoiuVRoj+gSkQ7d3FALtqAAGI1FQKckRals=
github.com/stretchr/testify v1.8.0/go.mod h1:yNjHg4UonilssWZ8iaSj1OCr/vHnekPRkoO+kdMU+MU=
github.com/stretchr/testify v1.8.1/go.mod h1:w2LPCIKwWwSfY2zedu0+kehJoqGctiVI29o6fzry7u4=
github.com/stretchr/testify v1.10.0 h1:Xv5erBjTwe/5IxqUQTdXv5kgmIvbHo3QQyRwhJsOfJA=
github.com/stretchr/testify v1.10.0/go.mod h1:r2ic/lqez/lEtzL7wO/rwa5dbSLXVDPFyf8C91i36aY=
github.com/twitchyliquid64/golang-asm v0.15.1 h1:SU5vSMR7hnwNxj24w34ZyCi/FmDZTkS4MhqMhdFk5YI=
github.com/twitchyliquid64/golang-asm v0.15.1/go.mod h1:a1lVb/DtPvCB8fslRZhAngC2+aY1QWCk3Cedj/Gdt08=
github.com/ugorji/go/codec v1.3.0 h1:Qd2W2sQawAfG8XSvzwhBeoGq71zXOC/Q1E9y/wUcsUA=
github.com/ugorji/go/codec v1.3.0/go.mod h1:pRBVtBSKl77K30Bv8R2P+cLSGaTtex6fsA2Wjqmfxj4=
go.opentelemetry.io/auto/sdk v1.2.1 h1:jXsnJ4Lmnqd11kwkBV2LgLoFMZKizbCi5fNZ/ipaZ64=
go.opentelemetry.io/auto/sdk v1.2.1/go.mod h1:KRTj+aOaElaLi+wW1kO/DZRXwkF4C5xPbEe3ZiIhN7Y=
go.opentelemetry.io/otel v1.38.0 h1:RkfdswUDRimDg0m2Az18RKOsnI8UDzppJAtj01/Ymk8=
go.opentelemetry.io/otel v1.38.0/go.mod h1:zcmtmQ1+YmQM9wrNsTGV/q/uyusom3P8RxwExxkZhjM=
go.opentelemetry.io/otel/metric v1.38.0 h1:Kl6lzIYGAh5M159u9NgiRkmoMKjvbsKtYRwgfrA6WpA=
go.opentelemetry.io/otel/metric v1.38.0/go.mod h1:kB5n/QoRM8YwmUahxvI3bO34eVtQf2i4utNVLr9gEmI=
go.opentelemetry.io/otel/sdk v1.38.0 h1:l48sr5YbNf2hpCUj/FoGhW9yDkl+Ma+LrVl8qaM5b+E=
go.opentelemetry.io/otel/sdk v1.38.0/go.mod h1:ghmNdGlVemJI3+ZB5iDEuk4bWA3GkTpW+DOoZMYBVVg=
go.opentelemetry.io/otel/sdk/metric v1.38.0 h1:aSH66iL0aZqo//xXzQLYozmWrXxyFkBJ6qT5wthqPoM=
go.opentelemetry.io/otel/sdk/metric v1.38.0/go.mod h1:dg9PBnW9XdQ1Hd6ZnRz689CbtrUp0wMMs9iPcgT9EZA=
go.opentelemetry.io/otel/trace v1.38.0 h1:Fxk5bKrDZJUH+AMyyIXGcFAPah0oRcT+LuNtJrmcNLE=
go.opentelemetry.io/otel/trace v1.38.0/go.mod h1:j1P9ivuFsTceSWe1oY+EeW3sc+Pp42sO++GHkg4wwhs=
golang.org/x/arch v0.18.0 h1:WN9poc33zL4AzGxqf8VtpKUnGvMi8O9lhNyBMF/85qc=
golang.org/x/arch v0.18.0/go.mod h1:bdwinDaKcfZUGpH09BB7ZmOfhalA8lQdzl62l8gGWsk=
golang.org/x/crypto v0.0.0-20190308221718-c2843e01d9a2/go.mod h1:djNgcEr1/C05ACkg1iLfiJU5Ep61QUkGW8qpdssI0+w=
golang.org/x/crypto v0.0.0-20210220033148-5ea612d1eb83/go.mod h1:jdWPYTVW3xRLrWPugEBEK3UY2ZEsg3UU495nc5E+M+I=
golang.org/x/crypto v0.44.0 h1:A97SsFvM3AIwEEmTBiaxPPTYpDC47w720rdiiUvgoAU=
golang.org/x/crypto v0.44.0/go.mod h1:013i+Nw79BMiQiMsOPcVCB5ZIJbYkerPrGnOa00tvmc=
golang.org/x/mod v0.29.0 h1:HV8lRxZC4l2cr3Zq1LvtOsi/ThTgWnUk/y64QSs8GwA=
golang.org/x/mod v0.29.0/go.mod h1:NyhrlYXJ2H4eJiRy/WDBO6HMqZQ6q9nk4JzS3NuCK+w=
golang.org/x/net v0.0.0-20190404232315-eb5bcb51f2a3/go.mod h1:t9HGtf8HONx5eT2rtn7q6eTqICYqUVnKs3thJo3Qplg=
golang.org/x/net v0.47.0 h1:Mx+4dIFzqraBXUugkia1OOvlD6LemFo1ALMHjrXDOhY=
golang.org/x/net v0.47.0/go.mod h1:/jNxtkgq5yWUGYkaZGqo27cfGZ1c5Nen03aYrrKpVRU=
golang.org/x/sync v0.18.0 h1:kr88TuHDroi+UVf+0hZnirlk8o8T+4MrK6mr60WkH/I=
golang.org/x/sync v0.18.0/go.mod h1:9KTHXmSnoGruLpwFjVSX0lNNA75CykiMECbovNTZqGI=
golang.org/x/sys v0.0.0-20190215142949-d0b11bdaac8a/go.mod h1:STP8DvDyc/dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=
golang.org/x/sys v0.0.0-20191026070338-33540a1f6037/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20200116001909-b77594299b42/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20200223170610-d5e6a3e2c0ae/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20210630005230-0f9fa26af87c/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.0.0-20210927094055-39ccf1dd6fa6/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.0.0-20220503163025-988cb79eb6c6/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.6.0/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.38.0 h1:3yZWxaJjBmCWXqhN1qh02AkOnCQ1poK6oF+a7xWL6Gc=
golang.org/x/sys v0.38.0/go.mod h1:OgkHotnGiDImocRcuBABYBEXf8A9a87e/uXjp9XT3ks=
golang.org/x/term v0.0.0-20201117132131-f5c789dd3221/go.mod h1:Nr5EML6q2oocZ2LXRh80K7BxOlk5/8JxuGnuhpl+muw=
golang.org/x/text v0.3.0/go.mod h1:NqM8EUOU14njkJ3fqMW+pc6Ldnwhi/IjpwHt7yyuwOQ=
golang.org/x/text v0.31.0 h1:aC8ghyu4JhP8VojJ2lEHBnochRno1sgL6nEi9WGFGMM=
golang.org/x/text v0.31.0/go.mod h1:tKRAlv61yKIjGGHX/4tP1LTbc13YSec1pxVEWXzfoeM=
golang.org/x/tools v0.38.0 h1:Hx2Xv8hISq8Lm16jvBZ2VQf+RLmbd7wVUsALibYI/IQ=
golang.org/x/tools v0.38.0/go.mod h1:yEsQ/d/YK8cjh0L6rZlY8tgtlKiBNTL14pGDJPJpYQs=
gonum.org/v1/gonum v0.16.0 h1:5+ul4Swaf3ESvrOnidPp4GZbzf0mxVQpDCYUQE7OJfk=
gonum.org/v1/gonum v0.16.0/go.mod h1:fef3am4MQ93R2HHpKnLk4/Tbh/s0+wqD5nfa6Pnwy4E=
google.golang.org/genproto/googleapis/rpc v0.0.0-20251029180050-ab9386a59fda h1:i/Q+bfisr7gq6feoJnS/DlpdwEL4ihp41fvRiM3Ork0=
google.golang.org/genproto/googleapis/rpc v0.0.0-20251029180050-ab9386a59fda/go.mod h1:7i2o+ce6H/6BluujYR+kqX3GKH+dChPTQU19wjRPiGk=
google.golang.org/grpc v1.78.0 h1:K1XZG/yGDJnzMdd/uZHAkVqJE+xIDOcmdSFZkBUicNc=
google.golang.org/grpc v1.78.0/go.mod h1:I47qjTo4OKbMkjA/aOOwxDIiPSBofUtQUI5EfpWvW7U=
google.golang.org/protobuf v1.36.10 h1:AYd7cD/uASjIL6Q9LiTjz8JLcrh/88q5UObnmY3aOOE=
google.golang.org/protobuf v1.36.10/go.mod h1:HTf+CrKn2C3g5S8VImy6tdcUvCska2kB7j23XfzDpco=
gopkg.in/check.v1 v0.0.0-20161208181325-20d25e280405/go.mod h1:Co6ibVJAznAaIkqp8huTwlJQCZ016jof/cbN4VW5Yz0=
gopkg.in/check.v1 v1.0.0-20201130134442-10cb98267c6c h1:Hei/4ADfdWqJk1ZMxUNpqntNwaWcugrBjAiHlqqRiVk=
gopkg.in/check.v1 v1.0.0-20201130134442-10cb98267c6c/go.mod h1:JHkPIbrfpd72SG/EVd6muEfDQjcINNoR0C8j2r3qZ4Q=
gopkg.in/yaml.v3 v3.0.0-20200313102051-9f266ea9e77c/go.mod h1:K4uyk7z7BCEPqu6E+C64Yfv1cQ7kz7rIZviUmN+EgEM=
gopkg.in/yaml.v3 v3.0.1 h1:fxVm/GzAzEWqLHuvctI91KS9hhNmmWOoWu0XTYJS7CA=
gopkg.in/yaml.v3 v3.0.1/go.mod h1:K4uyk7z7BCEPqu6E+C64Yfv1cQ7kz7rIZviUmN+EgEM=
gorm.io/gorm v1.31.1 h1:7CA8FTFz/gRfgqgpeKIBcervUn3xSyPUmr6B2WXJ7kg=
gorm.io/gorm v1.31.1/go.mod h1:XyQVbO2k6YkOis7C2437jSit3SsDK72s7n7rsSHd+Gs=
lukechampine.com/uint128 v1.2.0 h1:mBi/5l91vocEN8otkC5bDLhi2KdCticRiwbdB0O+rjI=
lukechampine.com/uint128 v1.2.0/go.mod h1:c4eWIwlEGaxC/+H1VguhU4PHXNWDCDMUlWdIWl2j1gk=
modernc.org/cc/v3 v3.40.0 h1:P3g79IUS/93SYhtoeaHW+kRCIrYaxJ27MFPv+7kaTOw=
modernc.org/cc/v3 v3.40.0/go.mod h1:/bTg4dnWkSXowUO6ssQKnOV0yMVxDYNIsIrzqTFDGH0=
modernc.org/ccgo/v3 v3.16.13 h1:Mkgdzl46i5F/CNR/Kj80Ri59hC8TKAhZrYSaqvkwzUw=
modernc.org/ccgo/v3 v3.16.13/go.mod h1:2Quk+5YgpImhPjv2Qsob1DnZ/4som1lJTodubIcoUkY=
modernc.org/ccorpus v1.11.6 h1:J16RXiiqiCgua6+ZvQot4yUuUy8zxgqbqEEUuGPlISk=
modernc.org/ccorpus v1.11.6/go.mod h1:2gEUTrWqdpH2pXsmTM1ZkjeSrUWDpjMu2T6m29L/ErQ=
modernc.org/httpfs v1.0.6 h1:AAgIpFZRXuYnkjftxTAZwMIiwEqAfk8aVB2/oA6nAeM=
modernc.org/httpfs v1.0.6/go.mod h1:7dosgurJGp0sPaRanU53W4xZYKh14wfzX420oZADeHM=
modernc.org/libc v1.29.0 h1:tTFRFq69YKCF2QyGNuRUQxKBm1uZZLubf6Cjh/pVHXs=
modernc.org/libc v1.29.0/go.mod h1:DaG/4Q3LRRdqpiLyP0C2m1B8ZMGkQ+cCgOIjEtQlYhQ=
modernc.org/mathutil v1.6.0 h1:fRe9+AmYlaej+64JsEEhoWuAYBkOtQiMEU7n/XgfYi4=
modernc.org/mathutil v1.6.0/go.mod h1:Ui5Q9q1TR2gFm0AQRqQUaBWFLAhQpCwNcuhBOSedWPo=
modernc.org/memory v1.7.2 h1:Klh90S215mmH8c9gO98QxQFsY+W451E8AnzjoE2ee1E=
modernc.org/memory v1.7.2/go.mod h1:NO4NVCQy0N7ln+T9ngWqOQfi7ley4vpwvARR+Hjw95E=
modernc.org/opt v0.1.3 h1:3XOZf2yznlhC+ibLltsDGzABUGVx8J6pnFMS3E4dcq4=
modernc.org/opt v0.1.3/go.mod h1:WdSiB5evDcignE70guQKxYUl14mgWtbClRi5wmkkTX0=
modernc.org/sqlite v1.27.0 h1:MpKAHoyYB7xqcwnUwkuD+npwEa0fojF0B5QRbN+auJ8=
modernc.org/sqlite v1.27.0/go.mod h1:Qxpazz0zH8Z1xCFyi5GSL3FzbtZ3fvbjmywNogldEW0=
modernc.org/strutil v1.1.3 h1:fNMm+oJklMGYfU9Ylcywl0CO5O6nTfaowNsh2wpPjzY=
modernc.org/strutil v1.1.3/go.mod h1:MEHNA7PdEnEwLvspRMtWTNnp2nnyvMfkimT1NKNAGbw=
modernc.org/tcl v1.15.2 h1:C4ybAYCGJw968e+Me18oW55kD/FexcHbqH2xak1ROSY=
modernc.org/tcl v1.15.2/go.mod h1:3+k/ZaEbKrC8ePv8zJWPtBSW0V7Gg9g8rkmhI1Kfs3c=
modernc.org/token v1.0.1 h1:A3qvTqOwexpfZZeyI0FeGPDlSWX5pjZu9hF4lU+EKWg=
modernc.org/token v1.0.1/go.mod h1:UGzOrNV1mAFSEB63lOFHIpNRUVMvYTc6yu1SMY/XTDM=
modernc.org/z v1.7.3 h1:zDJf6iHjrnB+WRD88stbXokugjyc0/pB91ri1gO6LZY=
modernc.org/z v1.7.3/go.mod h1:Ipv4tsdxZRbQyLq9Q1M6gdbkxYzdlrciF2Hi/lS7nWE=
nullprogram.com/x/optparse v1.0.0/go.mod h1:KdyPE+Igbe0jQUrVfMqDMeJQIJZEuyV7pjYmp6pbG50=

================
File: internal/app/app.go
================
package app

import (
	"net"
	"proxy-system-backend/internal/modules/proxy"
	"proxy-system-backend/internal/modules/shadowsocks"
	"proxy-system-backend/internal/modules/shared"
	"proxy-system-backend/internal/traffic"

	"sync"
)

type App struct {
	mu        sync.RWMutex
	listeners []func(Event)
	proxyMgr  *ProxyManager
}

func New() *App {
	return &App{
		proxyMgr:  NewProxyManager(),
		listeners: make([]func(Event), 0),
	}
}

// Subscribe è®¢é˜…äº‹ä»¶ï¼ˆwebsocket / logger / metrics éƒ½å¯ä»¥ï¼‰
func (a *App) Subscribe(fn func(Event)) {
	a.mu.Lock()
	defer a.mu.Unlock()
	a.listeners = append(a.listeners, fn)
}

// Emit domain è°ƒç”¨è¿™ä¸ª
func (a *App) Emit(e Event) {
	a.mu.RLock()
	defer a.mu.RUnlock()

	for _, fn := range a.listeners {
		fn(e)
	}
}

// tmp
func (a *App) StartProxy(cfg proxy.Config) error {
	ln, err := net.Listen("tcp", cfg.ListenAddr)
	if err != nil {
		return err
	}
	proxyID := shared.GenerateConnID()
	c, err := cfg.BuildCipher()
	server := shadowsocks.NewServer(
		ln,
		c,
		DefaultDirectDialer(),
		func(connID string) traffic.TrafficHook {
			return a.newTrafficHook(proxyID, connID)
		},
	)

	return a.proxyMgr.StartProxy(proxyID, server)

}
func (a *App) newTrafficHook(proxyID, connID string) traffic.TrafficHook {
	return &proxyTrafficHook{
		app:     a,
		proxyID: proxyID,
		connID:  connID,
	}
}

================
File: internal/app/events.go
================
package app

type EventType string

const (
	EventProxyStarted EventType = "proxy_started"
	EventProxyStopped EventType = "proxy_stopped"
	EventRuleUpdated  EventType = "rule_updated"
	EventPluginLoaded EventType = "plugin_loaded"
	EventTraffic      EventType = "EventTraffic"
)

type Event struct {
	Type EventType
	Data any
}

================
File: internal/app/filter_loader.go
================
package app

import (
	"context"
	"log"

	"proxy-system-backend/internal/modules/filter"
	filterstore "proxy-system-backend/internal/storage/filter"
)

type FilterLoader struct {
	repo   filterstore.RuleRepository
	engine *filter.Engine
}

func NewFilterLoader(
	repo filterstore.RuleRepository,
	engine *filter.Engine,
) *FilterLoader {
	return &FilterLoader{repo: repo, engine: engine}
}

func (l *FilterLoader) Load(ctx context.Context) error {
	models, err := l.repo.List(ctx)
	if err != nil {
		return err
	}

	var compiled []*filter.CompiledRule

	for _, m := range models {
		rule, err := ModelToRule(m)
		if err != nil {
			log.Println("rule parse failed:", err)
			continue
		}

		cr, err := filter.CompileRule(*rule)
		if err != nil {
			log.Println("rule compile failed:", err)
			continue
		}

		compiled = append(compiled, cr)
	}

	l.engine.Replace(compiled)
	log.Printf("âœ… filter rules loaded: %d\n", len(compiled))
	return nil
}

================
File: internal/app/model2struct.go
================
package app

import (
	"encoding/json"
	"proxy-system-backend/internal/modules/filter"
	filterstore "proxy-system-backend/internal/storage/filter"
	"proxy-system-backend/internal/traffic"
)

func ModelToRule(m filterstore.RuleModel) (*filter.Rule, error) {
	var srcCIDR, dstCIDR []string
	var srcPort, dstPort []filter.PortRange
	var tags []string

	_ = json.Unmarshal([]byte(m.SrcCIDR), &srcCIDR)
	_ = json.Unmarshal([]byte(m.DstCIDR), &dstCIDR)
	_ = json.Unmarshal([]byte(m.SrcPort), &srcPort)
	_ = json.Unmarshal([]byte(m.DstPort), &dstPort)
	_ = json.Unmarshal([]byte(m.Tags), &tags)

	return &filter.Rule{
		ID:          m.ID,
		Name:        m.Name,
		Description: m.Description,

		Action:    filter.Action(m.Action),
		Direction: traffic.Direction(m.Direction),
		Priority:  m.Priority,
		Enabled:   m.Enabled,

		SrcCIDR: srcCIDR,
		DstCIDR: dstCIDR,
		SrcPort: srcPort,
		DstPort: dstPort,
		Tags:    tags,
	}, nil
}

================
File: internal/app/notifier.go
================
package app

import (
	"encoding/json"
	"log"
	"proxy-system-backend/internal/modules/websocket"
	"time"
)

type WSNotifier struct {
	hub *websocket.Hub
}

func NewWSNotifier(hub *websocket.Hub) *WSNotifier {
	return &WSNotifier{hub: hub}
}

func (n *WSNotifier) HandleEvent(e Event) {
	msg := map[string]any{
		"type":      e.Type,
		"data":      e.Data,
		"timestamp": time.Now().Unix(),
	}

	b, err := json.Marshal(msg)
	if err != nil {
		log.Printf("ws notifier marshal failed: %v", err)
		return
	}

	n.hub.Broadcast(b)
}

================
File: internal/app/proxy_manager.go
================
package app

import (
	"fmt"
	"proxy-system-backend/internal/modules/shadowsocks"
	"sync"
)

type ProxyManager struct {
	mu      sync.Mutex
	servers map[string]*shadowsocks.Server
}

func NewProxyManager() *ProxyManager {
	return &ProxyManager{
		servers: make(map[string]*shadowsocks.Server),
	}
}

func (pm *ProxyManager) StartProxy(
	id string,
	server *shadowsocks.Server,
) error {
	pm.mu.Lock()
	defer pm.mu.Unlock()

	if _, ok := pm.servers[id]; ok {
		return fmt.Errorf("proxy %s already running", id)
	}

	pm.servers[id] = server

	go func() {
		if err := server.Serve(); err != nil {
			// TODO: log / notify ws
		}
	}()

	return nil
}

func (pm *ProxyManager) StopProxy(id string) error {
	pm.mu.Lock()
	defer pm.mu.Unlock()

	srv, ok := pm.servers[id]
	if !ok {
		return fmt.Errorf("proxy %s not found", id)
	}

	_ = srv.Close() // ä½ å¯ä»¥å®žçŽ° Close
	delete(pm.servers, id)
	return nil
}

================
File: internal/app/proxy_traffic_hook.go
================
package app

import (
	"proxy-system-backend/internal/traffic"
)

type proxyTrafficHook struct {
	proxyID string
	connID  string
	app     *App
}

func (h *proxyTrafficHook) OnPacket(ctx *traffic.PacketContext) bool {
	h.app.Emit(Event{
		Type: EventTraffic,
		Data: map[string]any{
			"proxy_id": h.proxyID,
			"conn_id":  h.connID,
			"payload":  ctx,
		},
	})

	return true
}

================
File: internal/app/tmp.go
================
package app

import (
	"context"
	"net"
)

type DirectDialer struct {
	dialer net.Dialer
}

func DefaultDirectDialer() *DirectDialer {
	return &DirectDialer{
		dialer: net.Dialer{},
	}
}

func (d *DirectDialer) DialContext(
	ctx context.Context,
	network, addr string,
) (net.Conn, error) {
	return d.dialer.DialContext(ctx, network, addr)
}

================
File: internal/app/wiring.go
================
package app

import (
	websocket2 "proxy-system-backend/internal/modules/websocket"
	"time"
)

type Wiring struct {
	App   *App
	WSHub *websocket2.Hub
}

func Wire() *Wiring {
	// 1ï¸âƒ£ websocket hub
	wsHub := websocket2.NewHub(websocket2.Config{
		PingInterval: 10 * time.Second,
	})
	go wsHub.Run()

	// 2ï¸âƒ£ app core
	app := New()

	// 3ï¸âƒ£ websocket notifier
	wsNotifier := NewWSNotifier(wsHub)
	app.Subscribe(wsNotifier.HandleEvent)

	//db, _ := gorm.Open(sqlite.Open("data.db"), &gorm.Config{})
	//db.AutoMigrate(&filterstore.RuleModel{})
	//
	//repo := filterstore.NewSQLiteRepo(db)
	//engine := filter.NewEngine()
	//loader := NewFilterLoader(repo, engine)
	//_ = loader.Load(context.Background())

	return &Wiring{
		App:   app,
		WSHub: wsHub,
		//Shadowsocks: ss,
	}
}

================
File: internal/handler/proxy_handler.go
================
package handler

import (
	"github.com/gin-gonic/gin"
	"net/http"
	"proxy-system-backend/internal/app"
	"proxy-system-backend/internal/modules/proxy"
	"time"
)

type ProxyHandler struct {
	app *app.App
}

func NewProxyHandler(app *app.App) *ProxyHandler {
	return &ProxyHandler{app: app}
}

func (h *ProxyHandler) StartProxy(c *gin.Context) {
	var req proxy.Config
	if err := c.ShouldBindJSON(&req); err != nil {
		c.JSON(http.StatusBadRequest, gin.H{
			"success": false,
			"error":   err.Error(),
		})
		return
	}

	// è¡¥ç”Ÿå‘½å‘¨æœŸå­—æ®µ
	now := time.Now().Unix()
	req.Enabled = true
	req.CreatedAt = now
	req.UpdatedAt = now

	if err := h.app.StartProxy(req); err != nil {
		c.JSON(http.StatusBadRequest, gin.H{
			"success": false,
			"error":   err.Error(),
		})
		return
	}

	c.JSON(http.StatusOK, gin.H{
		"success":  true,
		"proxy_id": req.ID,
	})
}

================
File: internal/middleware/cors.go
================
package middleware

import (
	"github.com/gin-gonic/gin"
)

func CORS() gin.HandlerFunc {
	return func(c *gin.Context) {
		c.Writer.Header().Set("Access-Control-Allow-Origin", "*")
		c.Writer.Header().Set("Access-Control-Allow-Credentials", "true")
		c.Writer.Header().Set("Access-Control-Allow-Headers", "Content-Type, Content-Length, Authorization, X-Requested-With")
		c.Writer.Header().Set("Access-Control-Allow-Methods", "POST, OPTIONS, GET, PUT, DELETE")

		if c.Request.Method == "OPTIONS" {
			c.AbortWithStatus(204)
			return
		}

		c.Next()
	}
}

func Recovery() gin.HandlerFunc {
	return gin.Recovery()
}

================
File: internal/modules/filter/compiled.go
================
package filter

import (
	"net"
	"proxy-system-backend/internal/traffic"
)

type CompiledRule struct {
	ID       int64
	Action   Action
	Priority int

	Direction traffic.Direction

	SrcIPNets []*net.IPNet
	DstIPNets []*net.IPNet
	SrcPorts  []PortRange
	DstPorts  []PortRange
}

func (r *CompiledRule) Match(ctx traffic.PacketContext) bool {

	// 1ï¸âƒ£ æ–¹å‘åŒ¹é…
	if r.Direction != traffic.DirectionUnknown &&
		r.Direction != ctx.Direction {
		return false
	}

	// 2ï¸âƒ£ æº IP
	if len(r.SrcIPNets) > 0 {
		if ctx.SrcIP == nil || !matchIPNet(ctx.SrcIP, r.SrcIPNets) {
			return false
		}
	}

	// 3ï¸âƒ£ ç›®æ ‡ IP
	if len(r.DstIPNets) > 0 {
		if ctx.DstIP == nil || !matchIPNet(ctx.DstIP, r.DstIPNets) {
			return false
		}
	}

	// 4ï¸âƒ£ æºç«¯å£
	if len(r.SrcPorts) > 0 {
		if ctx.SrcPort == 0 || !matchPort(ctx.SrcPort, r.SrcPorts) {
			return false
		}
	}

	// 5ï¸âƒ£ ç›®æ ‡ç«¯å£
	if len(r.DstPorts) > 0 {
		if ctx.DstPort == 0 || !matchPort(ctx.DstPort, r.DstPorts) {
			return false
		}
	}

	return true
}
func matchIP(addr net.Addr, nets []*net.IPNet) bool {
	tcp, ok := addr.(*net.TCPAddr)
	if !ok {
		return false
	}

	for _, n := range nets {
		if n.Contains(tcp.IP) {
			return true
		}
	}
	return false
}

func matchPort(port int, ranges []PortRange) bool {
	for _, r := range ranges {
		if r.Contains(port) {
			return true
		}
	}
	return false
}

func CompileRule(r Rule) (*CompiledRule, error) {
	cr := &CompiledRule{
		ID:        r.ID,
		Action:    r.Action,
		Priority:  r.Priority,
		Direction: r.Direction,
		SrcPorts:  r.SrcPort,
		DstPorts:  r.DstPort,
	}

	for _, cidr := range r.SrcCIDR {
		_, n, err := net.ParseCIDR(cidr)
		if err != nil {
			return nil, err
		}
		cr.SrcIPNets = append(cr.SrcIPNets, n)
	}

	for _, cidr := range r.DstCIDR {
		_, n, err := net.ParseCIDR(cidr)
		if err != nil {
			return nil, err
		}
		cr.DstIPNets = append(cr.DstIPNets, n)
	}

	return cr, nil
}

================
File: internal/modules/filter/engine.go
================
package filter

import (
	"proxy-system-backend/internal/traffic"
	"sort"
	"sync/atomic"
)

type Engine struct {
	enabled       atomic.Bool
	defaultAction atomic.Value // Action
	rules         atomic.Value // []*CompiledRule
}

func NewEngine() *Engine {
	e := &Engine{}
	e.enabled.Store(false)
	e.defaultAction.Store(ActionAllow)
	e.rules.Store([]*CompiledRule{})
	return e
}
func (e *Engine) Load(cfg Config, rules []Rule) error {
	var compiled []*CompiledRule

	for _, r := range rules {
		if !r.Enabled {
			continue
		}
		cr, err := CompileRule(r)
		if err != nil {
			return err
		}
		compiled = append(compiled, cr)
	}

	sort.Slice(compiled, func(i, j int) bool {
		return compiled[i].Priority > compiled[j].Priority
	})

	e.enabled.Store(cfg.Enabled)
	e.defaultAction.Store(cfg.DefaultAction)
	e.rules.Store(compiled)

	return nil
}

func (e *Engine) Match(ctx traffic.PacketContext) bool {
	if !e.enabled.Load() {
		return true
	}

	rules := e.rules.Load().([]*CompiledRule)
	for _, r := range rules {
		if r.Match(ctx) {
			return r.Action == ActionAllow
		}
	}

	return e.defaultAction.Load().(Action) == ActionAllow
}
func (e *Engine) Replace(rules []*CompiledRule) {
	e.rules.Store(rules)
}

================
File: internal/modules/filter/repository.go
================
package filter

import "context"

type Repository interface {
	LoadConfig(ctx context.Context) ([]*Config, error)
	// SaveConfig ä¿å­˜å®Œæ•´é…ç½®ï¼ˆç®¡ç†ç«¯ä½¿ç”¨ï¼‰
	SaveConfig(ctx context.Context, cfg *Config) error
}

================
File: internal/modules/filter/types.go
================
package filter

import (
	"net"
	"proxy-system-backend/internal/traffic"
)

type Action string

const (
	ActionAllow Action = "allow"
	ActionDeny  Action = "deny"
)

type Config struct {
	Enabled       bool
	DefaultAction Action
	Rules         []Rule
}

type Rule struct {
	ID          int64
	Name        string
	Description string

	Action    Action
	Direction traffic.Direction
	Priority  int
	Enabled   bool

	// ===== åŒ¹é…æ¡ä»¶ï¼ˆæœªç¼–è¯‘ï¼‰=====
	SrcCIDR []string
	DstCIDR []string
	SrcPort []PortRange
	DstPort []PortRange

	Tags []string
}

func matchIPNet(ip net.IP, nets []*net.IPNet) bool {
	for _, n := range nets {
		if n.Contains(ip) {
			return true
		}
	}
	return false
}

type PortRange struct {
	Min int `json:"min"` // æœ€å°ç«¯å£
	Max int `json:"max"` // æœ€å¤§ç«¯å£
}

func (r PortRange) Contains(p int) bool {
	return p >= r.Min && p <= r.Max
}

================
File: internal/modules/proxy/config.go
================
package proxy

import (
	"fmt"
	"github.com/shadowsocks/go-shadowsocks2/core"
)

type Config struct {
	// ===== èº«ä»½ =====
	ID   string `json:"id"`   // proxy_idï¼ˆç¨³å®šæ ‡è¯†ï¼‰
	Name string `json:"name"` // æ˜¾ç¤ºç”¨

	// ===== ç½‘ç»œ =====
	ListenAddr string `json:"listen_addr"` // ":8388"

	// ===== Shadowsocks =====
	Method   string `json:"method"` // aes-256-gcm
	Password string `json:"password"`

	// ===== è¡Œä¸ºé…ç½® =====
	EnableFilter bool `json:"enable_filter"`

	// ===== ç”Ÿå‘½å‘¨æœŸ =====
	Enabled   bool  `json:"enabled"`
	CreatedAt int64 `json:"created_at"`
	UpdatedAt int64 `json:"updated_at"`
}

func (c *Config) BuildCipher() (core.Cipher, error) {
	if c.Method == "" {
		return nil, fmt.Errorf("cipher method is empty")
	}
	if c.Password == "" {
		return nil, fmt.Errorf("cipher password is empty")
	}

	cipher, err := core.PickCipher(
		c.Method,
		nil, // key is derived from password
		c.Password,
	)
	if err != nil {
		return nil, fmt.Errorf("pick cipher failed: %w", err)
	}

	return cipher, nil
}

================
File: internal/modules/shadowsocks/connection.go
================
package shadowsocks

import (
	"errors"
	"io"
	"net"
	"proxy-system-backend/internal/traffic"
)

type proxyConn struct {
	id   string
	hook traffic.TrafficHook
}

func (c *proxyConn) pipe(
	dst net.Conn,
	src net.Conn,
	ctx *traffic.PacketContext,
) error {

	buf := make([]byte, 32*1024)

	for {
		n, err := src.Read(buf)
		if n > 0 {
			ctx.Payload = buf[:n]

			if c.hook != nil && !c.hook.OnPacket(ctx) {
				return errors.New("blocked by hook") // è¢«è¿‡æ»¤ï¼Œç›´æŽ¥æ–­
			}

			if _, werr := dst.Write(ctx.Payload); werr != nil {
				return werr
			}
		}
		if err != nil {
			if err == io.EOF {
				return nil
			}
			return err
		}
	}
}

================
File: internal/modules/shadowsocks/dialer.go
================
package shadowsocks

import (
	"context"
	"net"
)

type Dialer interface {
	DialContext(ctx context.Context,
		network, addr string) (net.Conn, error)
}

================
File: internal/modules/shadowsocks/server_test.go
================
package shadowsocks

import (
	"context"
	"fmt"
	"github.com/shadowsocks/go-shadowsocks2/core"
	"net"
	"proxy-system-backend/internal/traffic"
	"testing"
)

type TestHook struct {
}
type DirectDialer struct {
	dialer net.Dialer
}

func NewDirectDialer() *DirectDialer {
	return &DirectDialer{
		dialer: net.Dialer{},
	}
}

func (d *DirectDialer) DialContext(
	ctx context.Context,
	network, addr string,
) (net.Conn, error) {
	return d.dialer.DialContext(ctx, network, addr)
}
func (t TestHook) OnPacket(ctx *traffic.PacketContext) bool {
	//TODO implement me
	fmt.Println(ctx.SrcAddr, ctx.DstAddr, ctx.DstAddr, ctx.DstAddr)
	return true
}

func TestNewServer(t *testing.T) {

	cipher, _ := core.PickCipher("aes-256-gcm", nil, "test-password")
	ln, _ := net.Listen("tcp", ":8388")
	s := NewServer(ln, NewDirectDialer(), func(connID string) traffic.TrafficHook {

	})
	s.cipher = cipher

	for {
		c, _ := ln.Accept()
		go s.handleConn(c)
	}
}

================
File: internal/modules/shadowsocks/server.go
================
package shadowsocks

import (
	"context"

	"github.com/shadowsocks/go-shadowsocks2/core"
	"github.com/shadowsocks/go-shadowsocks2/socks"
	"net"
	"proxy-system-backend/internal/modules/shared"
	"proxy-system-backend/internal/traffic"
	"sync"
)

type Server struct {
	listener net.Listener
	hookFn   func(connID string) traffic.TrafficHook
	wg       sync.WaitGroup
	dialer   Dialer
	cipher   core.Cipher

	closeOnce sync.Once
	closed    chan struct{}
}

func NewServer(l net.Listener, c core.Cipher, d Dialer, hf func(connID string) traffic.TrafficHook) *Server {
	return &Server{
		listener: l,
		dialer:   d,
		hookFn:   hf,
		cipher:   c,
		closed:   make(chan struct{}),
	}
}
func (s *Server) Serve() error {
	for {
		conn, err := s.listener.Accept()
		//fmt.Println("debug new conn")
		if err != nil {
			select {
			case <-s.closed:
				return nil // æ­£å¸¸å…³é—­
			default:
				return err // å¼‚å¸¸é”™è¯¯
			}
		}

		s.wg.Add(1)
		go func(c net.Conn) {
			defer s.wg.Done()
			s.handleConn(c)
		}(conn)
	}
}

func (s *Server) handleConn(client net.Conn) {
	defer client.Close()

	// 1ï¸âƒ£ Shadowsocks è§£å¯†
	ssConn := s.unwrap(client)
	defer ssConn.Close()

	// 2ï¸âƒ£ è¯»å–ç›®æ ‡åœ°å€ï¼ˆSOCKS åè®®ï¼‰
	target, err := socks.ReadAddr(ssConn)
	if err != nil {
		return
	}

	// 3ï¸âƒ£ è¿žæŽ¥ç›®æ ‡
	remote, err := s.dialer.DialContext(context.Background(), "tcp", target.String())
	if err != nil {
		return
	}
	defer remote.Close()

	// 4ï¸âƒ£ åŒå‘ pipeï¼ˆä½ çŽ°åœ¨å·²æœ‰çš„ï¼‰
	connID := shared.GenerateConnID()
	hook := s.hookFn(connID)
	pc := &proxyConn{id: connID, hook: hook}

	errCh := make(chan error, 2)

	go func() {
		errCh <- pc.pipe(remote, ssConn, traffic.NewOutCtx(connID, client, remote))
	}()

	go func() {
		errCh <- pc.pipe(ssConn, remote, traffic.NewInCtx(connID, remote, client))
	}()

	<-errCh
}

func (s *Server) unwrap(conn net.Conn) net.Conn {
	if s.cipher == nil {
		return conn
	}
	return s.cipher.StreamConn(conn)
}
func (s *Server) Close() error {
	var err error

	s.closeOnce.Do(func() {
		close(s.closed)

		if s.listener != nil {
			err = s.listener.Close()
		}

		// ç­‰å¾…æ‰€æœ‰ handleConn å®Œæˆ
		s.wg.Wait()
	})

	return err
}

================
File: internal/modules/shared/id.go
================
package shared

import (
	"crypto/rand"
	"encoding/hex"
)

func GenerateConnID() string {
	b := make([]byte, 16)
	_, _ = rand.Read(b)
	return hex.EncodeToString(b)
}

================
File: internal/modules/websocket/conn.go
================
package websocket

import (
	"log"
	"time"

	"github.com/gorilla/websocket"
)

type WSConn struct {
	ID   string
	conn *websocket.Conn
	send chan []byte
}

func newWSConn(id string, conn *websocket.Conn) *WSConn {
	return &WSConn{
		ID:   id,
		conn: conn,
		send: make(chan []byte, 256),
	}
}

func (c *WSConn) readPump(h *Hub) {
	defer func() {
		h.unregister <- c
		_ = c.conn.Close()
	}()

	c.conn.SetReadLimit(1024 * 1024)

	//c.conn.SetReadDeadline(time.Now().Add(h.pingInterval * 2))
	c.conn.SetPongHandler(func(string) error {
		c.conn.SetReadDeadline(time.Now().Add(h.pingInterval * 2))
		return nil
	})

	for {
		if _, _, err := c.conn.ReadMessage(); err != nil {
			log.Printf("ws read error [%s]: %v", c.ID, err)
			return
		}
	}
}

func (c *WSConn) writePump(h *Hub) {
	ticker := time.NewTicker(h.pingInterval)
	defer func() {
		ticker.Stop()
		_ = c.conn.Close()
	}()

	for {
		select {
		case msg, ok := <-c.send:
			c.conn.SetWriteDeadline(time.Now().Add(10 * time.Second))
			if !ok {
				_ = c.conn.WriteMessage(
					websocket.CloseMessage,
					websocket.FormatCloseMessage(websocket.CloseNormalClosure, ""),
				)
				return
			}
			if err := c.conn.WriteMessage(websocket.TextMessage, msg); err != nil {
				log.Printf("ws write error [%s]: %v", c.ID, err)
				return
			}

		case <-ticker.C:
			c.conn.SetWriteDeadline(time.Now().Add(10 * time.Second))
			if err := c.conn.WriteMessage(websocket.PingMessage, nil); err != nil {
				log.Printf("ws ping failed [%s]: %v", c.ID, err)
				return
			}
		}
	}
}

================
File: internal/modules/websocket/hub.go
================
package websocket

import (
	"log"
	"proxy-system-backend/internal/modules/shared"
	"sync"
	"time"

	"github.com/gin-gonic/gin"
)

type Hub struct {
	conns        map[string]*WSConn
	register     chan *WSConn
	unregister   chan *WSConn
	mu           sync.RWMutex
	pingInterval time.Duration
}

func NewHub(cfg Config) *Hub {
	return &Hub{
		conns:        make(map[string]*WSConn),
		register:     make(chan *WSConn),
		unregister:   make(chan *WSConn),
		pingInterval: cfg.PingInterval,
	}
}

func (h *Hub) Run() {
	for {
		select {
		case c := <-h.register:
			h.mu.Lock()
			h.conns[c.ID] = c
			h.mu.Unlock()
			c.conn.WriteMessage(123, []byte("ASDAS"))
			log.Printf("âœ… ws connected: %s, total=%d", c.ID, len(h.conns))

		case c := <-h.unregister:
			h.mu.Lock()
			if _, ok := h.conns[c.ID]; ok {
				delete(h.conns, c.ID)
				close(c.send)
			}
			h.mu.Unlock()
			log.Printf("âŒ ws disconnected: %s, total=%d", c.ID, len(h.conns))
		}
	}
}

func (h *Hub) Handle(c *gin.Context) {
	conn, err := upgrader.Upgrade(c.Writer, c.Request, nil)
	if err != nil {
		log.Printf("ws upgrade error: %v", err)
		return
	}

	wsConn := newWSConn(shared.GenerateConnID(), conn)
	h.register <- wsConn

	go wsConn.readPump(h)
	go wsConn.writePump(h)
}

func (h *Hub) Send(connID string, msg []byte) bool {
	h.mu.RLock()
	c, ok := h.conns[connID]
	h.mu.RUnlock()

	if !ok {
		return false
	}

	select {
	case c.send <- msg:
		return true
	default:
		//h.unregister <- c
		return false
	}
}

func (h *Hub) Broadcast(msg []byte) {
	h.mu.RLock()
	defer h.mu.RUnlock()

	for _, c := range h.conns {
		select {
		case c.send <- msg:
		default:
		}
	}
}

func (h *Hub) ConnIDs() []string {
	h.mu.RLock()
	defer h.mu.RUnlock()

	ids := make([]string, 0, len(h.conns))
	for id := range h.conns {
		ids = append(ids, id)
	}
	return ids
}

================
File: internal/modules/websocket/types.go
================
package websocket

import "time"

type Config struct {
	PingInterval time.Duration
}

================
File: internal/modules/websocket/upgrader.go
================
package websocket

import (
	"github.com/gorilla/websocket"
	"net/http"
)

var upgrader = websocket.Upgrader{
	ReadBufferSize:  1024,
	WriteBufferSize: 1024,
	CheckOrigin: func(r *http.Request) bool {
		return true
	},
}

================
File: internal/service/compat/integration_test.go
================
package compat

import (
	"bytes"
	"database/sql"
	"encoding/json"
	"net/http"
	"net/http/httptest"
	"os"
	"path/filepath"
	"testing"
	"time"

	"proxy-system-backend/internal/types"
)

func TestCompatibilityLayer(t *testing.T) {
	// åˆ›å»ºä¸´æ—¶ç›®å½•
	tempDir, err := os.MkdirTemp("", "test-compatibility")
	if err != nil {
		t.Fatalf("Failed to create temp dir: %v", err)
	}
	defer os.RemoveAll(tempDir)

	// åˆå§‹åŒ–å…¼å®¹çš„æ’ä»¶æœåŠ¡
	pluginConfig := types.PluginManagerConfig{
		PluginDir: tempDir,
		MaxSize:   50 * 1024 * 1024, // 50MB
	}
	compatPluginService := NewPluginService(pluginConfig)
	if err := compatPluginService.Initialize(); err != nil {
		t.Fatalf("Failed to initialize plugin service: %v", err)
	}

	// åˆå§‹åŒ–å…¼å®¹çš„WebSocketæœåŠ¡
	wsService := NewWebSocketService()

	// åˆ›å»ºå…¼å®¹çš„ShadowsocksæœåŠ¡
	shadowsocksService := NewShadowsocksService(wsService, compatPluginService)

	// æµ‹è¯•é…ç½®
	config := types.ServerConfig{
		ListenAddr: "127.0.0.1:0", // ä½¿ç”¨éšæœºç«¯å£
		Password:   "test-password",
		Method:     "aes-256-gcm",
	}

	// æµ‹è¯•Startæ–¹æ³•ä¸åº”panic
	if err := shadowsocksService.Start(config); err != nil {
		t.Fatalf("Start failed: %v", err)
	}
	defer shadowsocksService.Stop()

	// éªŒè¯æœåŠ¡å·²å¯åŠ¨
	time.Sleep(100 * time.Millisecond) // ç­‰å¾…æœåŠ¡å¯åŠ¨

	// æµ‹è¯•å›žè°ƒæ–¹æ³•ä¸åº”panic
	shadowsocksService.OnClientConnected()
	shadowsocksService.OnClientDisconnected()

	testData := []byte("test data")
	shadowsocksService.OnPacketReceived("Câ†’S", testData, len(testData), "127.0.0.1:12345", "192.168.1.100:80")
}

func TestFilterRulesAPI(t *testing.T) {
	// åˆ›å»ºä¸´æ—¶ç›®å½•
	tempDir, err := os.MkdirTemp("", "test-filter-api")
	if err != nil {
		t.Fatalf("Failed to create temp dir: %v", err)
	}
	defer os.RemoveAll(tempDir)

	// åˆå§‹åŒ–æœåŠ¡
	pluginConfig := types.PluginManagerConfig{
		PluginDir: tempDir,
		MaxSize:   50 * 1024 * 1024,
	}
	pluginService := NewPluginService(pluginConfig)
	if err := pluginService.Initialize(); err != nil {
		t.Fatalf("Failed to initialize plugin service: %v", err)
	}

	wsService := NewWebSocketService()
	shadowsocksService := NewShadowsocksService(wsService, pluginService)

	config := types.ServerConfig{
		ListenAddr: "127.0.0.1:0",
		Password:   "test-password",
		Method:     "aes-256-gcm",
	}

	if err := shadowsocksService.Start(config); err != nil {
		t.Fatalf("Start failed: %v", err)
	}
	defer shadowsocksService.Stop()

	// åˆ›å»ºHTTPå¤„ç†å™¨
	// router := handler.SetupRoutes(shadowsocksService, pluginService) // æš‚æ—¶æ³¨é‡ŠæŽ‰ï¼Œé¿å…å¾ªçŽ¯å¯¼å…¥
	router := http.NewServeMux()

	// æµ‹è¯•æ·»åŠ è¿‡æ»¤è§„åˆ™
	rule := types.FilterRule{
		ID:          1,
		Name:        "Test Rule",
		Action:      types.FilterActionAllow,
		Direction:   types.FilterDirectionIn,
		SourceIPs:   []types.IPAddress{{IP: "192.168.1.0", Mask: 24}},
		SourcePorts: []types.PortRange{{Min: 1, Max: 60034}},
		DestIPs:     []types.IPAddress{},
		DestPorts:   []types.PortRange{{Min: 8080, Max: 8080}},
		Enabled:     true,
		Priority:    100,
		Description: "æµ‹è¯•è§„åˆ™",
	}

	ruleJSON, _ := json.Marshal(rule)
	req, _ := http.NewRequest("POST", "/api/filter/rules", bytes.NewBuffer(ruleJSON))
	rr := httptest.NewRecorder()
	router.ServeHTTP(rr, req)

	if status := rr.Code; status != http.StatusOK {
		t.Fatalf("Expected status %d, got %d", http.StatusOK, status)
	}

	// æµ‹è¯•èŽ·å–è¿‡æ»¤è§„åˆ™
	req, _ = http.NewRequest("GET", "/api/filter/rules", nil)
	rr = httptest.NewRecorder()
	router.ServeHTTP(rr, req)

	if status := rr.Code; status != http.StatusOK {
		t.Fatalf("Expected status %d, got %d", http.StatusOK, status)
	}

	var rules []types.FilterRule
	if err := json.Unmarshal(rr.Body.Bytes(), &rules); err != nil {
		t.Fatalf("Failed to parse response: %v", err)
	}

	if len(rules) != 1 {
		t.Fatalf("Expected 1 rule, got %d", len(rules))
	}

	// æµ‹è¯•æ›´æ–°è¿‡æ»¤è§„åˆ™
	rule.Name = "Updated Test Rule"
	ruleJSON, _ = json.Marshal(rule)
	req, _ = http.NewRequest("PUT", "/api/filter/rules/1", bytes.NewBuffer(ruleJSON))
	rr = httptest.NewRecorder()
	router.ServeHTTP(rr, req)

	if status := rr.Code; status != http.StatusOK {
		t.Fatalf("Expected status %d, got %d", http.StatusOK, status)
	}

	// æµ‹è¯•åˆ é™¤è¿‡æ»¤è§„åˆ™
	req, _ = http.NewRequest("DELETE", "/api/filter/rules/1", nil)
	rr = httptest.NewRecorder()
	router.ServeHTTP(rr, req)

	if status := rr.Code; status != http.StatusOK {
		t.Fatalf("Expected status %d, got %d", http.StatusOK, status)
	}

	// éªŒè¯è§„åˆ™å·²åˆ é™¤
	req, _ = http.NewRequest("GET", "/api/filter/rules", nil)
	rr = httptest.NewRecorder()
	router.ServeHTTP(rr, req)

	if status := rr.Code; status != http.StatusOK {
		t.Fatalf("Expected status %d, got %d", http.StatusOK, status)
	}

	if err := json.Unmarshal(rr.Body.Bytes(), &rules); err != nil {
		t.Fatalf("Failed to parse response: %v", err)
	}

	if len(rules) != 0 {
		t.Fatalf("Expected 0 rules, got %d", len(rules))
	}
}

func TestPluginServiceAPI(t *testing.T) {
	// åˆ›å»ºä¸´æ—¶ç›®å½•
	tempDir, err := os.MkdirTemp("", "test-plugin-api")
	if err != nil {
		t.Fatalf("Failed to create temp dir: %v", err)
	}
	defer os.RemoveAll(tempDir)

	// åˆå§‹åŒ–æœåŠ¡
	pluginConfig := types.PluginManagerConfig{
		PluginDir: tempDir,
		MaxSize:   50 * 1024 * 1024,
	}
	pluginService := NewPluginService(pluginConfig)
	if err := pluginService.Initialize(); err != nil {
		t.Fatalf("Failed to initialize plugin service: %v", err)
	}

	wsService := NewWebSocketService()
	shadowsocksService := NewShadowsocksService(wsService, pluginService)

	config := types.ServerConfig{
		ListenAddr: "127.0.0.1:0",
		Password:   "test-password",
		Method:     "aes-256-gcm",
	}

	if err := shadowsocksService.Start(config); err != nil {
		t.Fatalf("Start failed: %v", err)
	}
	defer shadowsocksService.Stop()

	// åˆ›å»ºHTTPå¤„ç†å™¨
	// router := handler.SetupRoutes(shadowsocksService, pluginService) // æš‚æ—¶æ³¨é‡ŠæŽ‰ï¼Œé¿å…å¾ªçŽ¯å¯¼å…¥
	router := http.NewServeMux()

	// åˆ›å»ºæµ‹è¯•æ’ä»¶æ–‡ä»¶
	pluginContent := []byte("test plugin content")
	pluginPath := filepath.Join(tempDir, "test-plugin.txt")
	if err := os.WriteFile(pluginPath, pluginContent, 0644); err != nil {
		t.Fatalf("Failed to create test plugin file: %v", err)
	}

	// æµ‹è¯•èŽ·å–æ’ä»¶åˆ—è¡¨
	req, _ := http.NewRequest("GET", "/api/plugins", nil)
	rr := httptest.NewRecorder()
	router.ServeHTTP(rr, req)

	if status := rr.Code; status != http.StatusOK {
		t.Fatalf("Expected status %d, got %d", http.StatusOK, status)
	}

	var plugins []types.PluginInfo
	if err := json.Unmarshal(rr.Body.Bytes(), &plugins); err != nil {
		t.Fatalf("Failed to parse response: %v", err)
	}

	if len(plugins) != 1 {
		t.Fatalf("Expected 1 plugin, got %d", len(plugins))
	}

	if plugins[0].Name != "test-plugin.txt" {
		t.Fatalf("Expected plugin name 'test-plugin.txt', got %s", plugins[0].Name)
	}
}

func TestDatabasePersistence(t *testing.T) {
	// åˆ›å»ºä¸¤ä¸ªä¸´æ—¶ç›®å½•æ¨¡æ‹Ÿé‡å¯
	tempDir1, err := os.MkdirTemp("", "test-db-persistence-1")
	if err != nil {
		t.Fatalf("Failed to create temp dir: %v", err)
	}
	defer os.RemoveAll(tempDir1)

	tempDir2, err := os.MkdirTemp("", "test-db-persistence-2")
	if err != nil {
		t.Fatalf("Failed to create temp dir: %v", err)
	}
	defer os.RemoveAll(tempDir2)

	// ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæœåŠ¡å¹¶æ·»åŠ è§„åˆ™
	pluginConfig1 := types.PluginManagerConfig{
		PluginDir: tempDir1,
		MaxSize:   50 * 1024 * 1024,
	}
	pluginService1 := NewPluginService(pluginConfig1)
	if err := pluginService1.Initialize(); err != nil {
		t.Fatalf("Failed to initialize plugin service: %v", err)
	}

	// ç›´æŽ¥è®¿é—®åº•å±‚FilterServiceä»¥æ·»åŠ è§„åˆ™
	// æ³¨æ„ï¼šè¿™åªæ˜¯ä¸ºäº†æµ‹è¯•ç›®çš„ï¼Œå®žé™…åº”ç”¨ä¸­åº”é€šè¿‡APIæˆ–å…¼å®¹å±‚æ“ä½œ
	// é€šè¿‡åå°„æˆ–å…¶ä»–æ–¹å¼è®¿é—®å†…éƒ¨æœåŠ¡
	// è¿™é‡Œæˆ‘ä»¬ç®€å•åœ°ä½¿ç”¨æ•°æ®åº“ç›´æŽ¥æ“ä½œæ¥æ¨¡æ‹Ÿ
	dbPath1 := filepath.Join(tempDir1, "filter.db")
	db1, err := sql.Open("sqlite", dbPath1+"?_journal_mode=WAL")
	if err != nil {
		t.Fatalf("Failed to open database: %v", err)
	}
	defer db1.Close()

	// åˆ›å»ºè¡¨
	if _, err := db1.Exec(`
		CREATE TABLE IF NOT EXISTS filter_rules (
			id INTEGER PRIMARY KEY,
			name TEXT NOT NULL,
			action INTEGER NOT NULL,
			direction INTEGER NOT NULL,
			source_ips TEXT NOT NULL,
			source_ports TEXT NOT NULL,
			dest_ips TEXT NOT NULL,
			dest_ports TEXT NOT NULL,
			enabled INTEGER NOT NULL,
			priority INTEGER NOT NULL,
			description TEXT,
			created_at TEXT NOT NULL,
			updated_at TEXT NOT NULL
		)
	`); err != nil {
		t.Fatalf("Failed to create table: %v", err)
	}

	// æ·»åŠ æµ‹è¯•è§„åˆ™
	rule := types.FilterRule{
		ID:          1,
		Name:        "Test Rule",
		Action:      types.FilterActionAllow,
		Direction:   types.FilterDirectionIn,
		SourceIPs:   []types.IPAddress{{IP: "192.168.1.0", Mask: 24}},
		SourcePorts: []types.PortRange{{Min: 1, Max: 60034}},
		DestIPs:     []types.IPAddress{},
		DestPorts:   []types.PortRange{{Min: 8080, Max: 8080}},
		Enabled:     true,
		Priority:    100,
		Description: "æµ‹è¯•è§„åˆ™",
	}

	// åºåˆ—åŒ–JSONå­—æ®µ
	sourceIPsJSON, _ := json.Marshal(rule.SourceIPs)
	sourcePortsJSON, _ := json.Marshal(rule.SourcePorts)
	destIPsJSON, _ := json.Marshal(rule.DestIPs)
	destPortsJSON, _ := json.Marshal(rule.DestPorts)

	now := time.Now().Format(time.RFC3339)

	// æ’å…¥è§„åˆ™
	if _, err := db1.Exec(`
		INSERT INTO filter_rules (
			id, name, action, direction, source_ips, source_ports, 
			dest_ips, dest_ports, enabled, priority, description, created_at, updated_at
		) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
	`,
		rule.ID, rule.Name, rule.Action, rule.Direction,
		sourceIPsJSON, sourcePortsJSON, destIPsJSON, destPortsJSON,
		rule.Enabled, rule.Priority, rule.Description, now, now,
	); err != nil {
		t.Fatalf("Failed to insert filter rule: %v", err)
	}

	// ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæ–°æœåŠ¡å¹¶éªŒè¯è§„åˆ™æ˜¯å¦åŠ è½½
	pluginConfig2 := types.PluginManagerConfig{
		PluginDir: tempDir2,
		MaxSize:   50 * 1024 * 1024,
	}
	pluginService2 := NewPluginService(pluginConfig2)
	if err := pluginService2.Initialize(); err != nil {
		t.Fatalf("Failed to initialize plugin service: %v", err)
	}

	// å¤åˆ¶æ•°æ®åº“æ–‡ä»¶åˆ°æ–°ç›®å½•
	dbPath2 := filepath.Join(tempDir2, "filter.db")
	dbData, err := os.ReadFile(dbPath1)
	if err != nil {
		t.Fatalf("Failed to read database file: %v", err)
	}
	if err := os.WriteFile(dbPath2, dbData, 0644); err != nil {
		t.Fatalf("Failed to write database file: %v", err)
	}

	// é‡æ–°åˆå§‹åŒ–æ’ä»¶æœåŠ¡ä»¥åŠ è½½æ•°æ®åº“
	pluginService2 = NewPluginService(pluginConfig2)
	if err := pluginService2.Initialize(); err != nil {
		t.Fatalf("Failed to re-initialize plugin service: %v", err)
	}

	wsService := NewWebSocketService()
	shadowsocksService := NewShadowsocksService(wsService, pluginService2)

	config := types.ServerConfig{
		ListenAddr: "127.0.0.1:0",
		Password:   "test-password",
		Method:     "aes-256-gcm",
	}

	if err := shadowsocksService.Start(config); err != nil {
		t.Fatalf("Start failed: %v", err)
	}
	defer shadowsocksService.Stop()

	// ç­‰å¾…æœåŠ¡åŠ è½½è§„åˆ™
	time.Sleep(100 * time.Millisecond)

	// éªŒè¯è§„åˆ™å·²åŠ è½½
	// è¿™é‡Œæˆ‘ä»¬æ— æ³•ç›´æŽ¥è®¿é—®å†…éƒ¨PacketFilterï¼Œæ‰€ä»¥é€šè¿‡APIéªŒè¯
	// router := handler.SetupRoutes(shadowsocksService, pluginService2) // æš‚æ—¶æ³¨é‡ŠæŽ‰ï¼Œé¿å…å¾ªçŽ¯å¯¼å…¥
	router := http.NewServeMux()

	req, _ := http.NewRequest("GET", "/api/filter/rules", nil)
	rr := httptest.NewRecorder()
	router.ServeHTTP(rr, req)

	if status := rr.Code; status != http.StatusOK {
		t.Fatalf("Expected status %d, got %d", http.StatusOK, status)
	}

	var rules []types.FilterRule
	if err := json.Unmarshal(rr.Body.Bytes(), &rules); err != nil {
		t.Fatalf("Failed to parse response: %v", err)
	}

	if len(rules) != 1 {
		t.Fatalf("Expected 1 rule, got %d", len(rules))
	}

	if rules[0].ID != 1 {
		t.Fatalf("Expected rule ID 1, got %d", rules[0].ID)
	}

	if rules[0].Name != "Test Rule" {
		t.Fatalf("Expected rule name 'Test Rule', got %s", rules[0].Name)
	}
}

================
File: internal/service/compat/plugin.go
================
package compat

import (
	"proxy-system-backend/internal/service/plugin"
	"proxy-system-backend/internal/types"
)

// PluginService å…¼å®¹PluginService - ç›´æŽ¥ä½¿ç”¨plugin.PluginService
type PluginService = plugin.PluginService

// NewPluginService åˆ›å»ºå…¼å®¹çš„æ’ä»¶æœåŠ¡ - ç›´æŽ¥ä½¿ç”¨plugin.NewPluginService
func NewPluginService(config types.PluginManagerConfig) *PluginService {
	return plugin.NewPluginService(config)
}

================
File: internal/service/compat/shadowsocks.go
================
package compat

import (
	"proxy-system-backend/internal/service/core/proxy"
	"proxy-system-backend/internal/service/core/websocket"
)

// ShadowsocksService å…¼å®¹ShadowsocksService - çŽ°åœ¨ç›´æŽ¥ä½¿ç”¨proxy.ShadowsocksService
type ShadowsocksService = proxy.ShadowsocksService

// NewShadowsocksService åˆ›å»ºå…¼å®¹çš„ShadowsocksæœåŠ¡
func NewShadowsocksService(wsService *WebSocketService, pluginService *PluginService) *ShadowsocksService {
	// ç›´æŽ¥åˆ›å»ºserviceå±‚çš„å®žä¾‹ï¼ˆä½¿ç”¨å…¼å®¹å±‚çš„ç±»åž‹ï¼‰
	serviceWSService := websocket.NewWebSocketService(websocket.WebSocketConfig{
		ReadBufferSize:  1024,
		WriteBufferSize: 1024,
		PingInterval:    30 * 1000000000, // 30ç§’
	})

	// ç›´æŽ¥ä½¿ç”¨å…¼å®¹å±‚çš„pluginServiceå®žä¾‹
	return proxy.NewShadowsocksService(serviceWSService, pluginService)
}

// å…¼å®¹æ€§å±‚ - ShadowsocksServiceçŽ°åœ¨ç›´æŽ¥ä½¿ç”¨service.ShadowsocksService
// ä¸éœ€è¦é¢å¤–çš„ä»£ç†æ–¹æ³•ï¼Œç›´æŽ¥ä½¿ç”¨serviceå±‚çš„æ–¹æ³•

================
File: internal/service/compat/websocket.go
================
package compat

import (
	"proxy-system-backend/internal/service/core/websocket"
)

// WebSocketService å…¼å®¹WebSocketService - ç›´æŽ¥ä½¿ç”¨websocket.WebSocketService
type WebSocketService = websocket.WebSocketService

// NewWebSocketService åˆ›å»ºå…¼å®¹çš„WebSocketæœåŠ¡ - ç›´æŽ¥ä½¿ç”¨websocket.NewWebSocketService
func NewWebSocketService() *WebSocketService {
	return websocket.NewWebSocketService(websocket.WebSocketConfig{
		ReadBufferSize:  1024,
		WriteBufferSize: 1024,
		PingInterval:    30 * 1000000000, // 30ç§’
	})
}

================
File: internal/service/core/websocket/service.go
================
package websocket

import (
	"crypto/rand"
	"encoding/hex"
	"encoding/json"
	"log"
	"net/http"
	"sync"
	"time"

	"github.com/gin-gonic/gin"
	"github.com/gorilla/websocket"
)

// WebSocketService WebSocketæœåŠ¡
type WebSocketService struct {
	clients      map[string]*client
	clientByID   map[string]*client
	tokenMap     map[string]string // token -> clientID æ˜ å°„
	register     chan *client
	unregister   chan *client
	mu           sync.RWMutex
	pingInterval time.Duration
	config       WebSocketConfig
}

// client å†…éƒ¨å®¢æˆ·ç«¯ç»“æž„
type client struct {
	*Client
	conn *websocket.Conn
	send chan []byte // å†™é˜Ÿåˆ—ï¼ˆå”¯ä¸€å†™å…¥å£ï¼‰
}

// NewWebSocketService åˆ›å»ºWebSocketæœåŠ¡
func NewWebSocketService(config WebSocketConfig) *WebSocketService {
	return &WebSocketService{
		clients:      make(map[string]*client),
		clientByID:   make(map[string]*client),
		tokenMap:     make(map[string]string),
		register:     make(chan *client),
		unregister:   make(chan *client),
		pingInterval: config.PingInterval,
		config:       config,
	}
}

var upgrader = websocket.Upgrader{
	ReadBufferSize:  1024,
	WriteBufferSize: 1024,
	CheckOrigin: func(r *http.Request) bool {
		return true
	},
}

// generateClientID ç”Ÿæˆå”¯ä¸€å®¢æˆ·ç«¯ID
func generateClientID() string {
	bytes := make([]byte, 16)
	if _, err := rand.Read(bytes); err != nil {
		return "client-" + time.Now().Format("20060102150405")
	}
	return "client-" + hex.EncodeToString(bytes)
}

// generateToken ç”Ÿæˆå®¢æˆ·ç«¯è®¿é—®ä»¤ç‰Œ
func generateToken() string {
	bytes := make([]byte, 32)
	if _, err := rand.Read(bytes); err != nil {
		return "token-" + time.Now().Format("20060102150405")
	}
	return hex.EncodeToString(bytes)
}

// HandleWebSocket å¤„ç†WebSocketè¿žæŽ¥å‡çº§
func (ws *WebSocketService) HandleWebSocket(c *gin.Context) {
	conn, err := upgrader.Upgrade(c.Writer, c.Request, nil)
	if err != nil {
		log.Println("âŒ WebSocket upgrade error:", err)
		return
	}

	clientID := generateClientID()
	token := generateToken()
	client := &client{
		Client: &Client{
			ID:    clientID,
			Token: token,
		},
		conn: conn,
		send: make(chan []byte, 256),
	}

	// å°†tokenæ˜ å°„æ·»åŠ åˆ°tokenMap
	ws.mu.Lock()
	ws.tokenMap[token] = clientID
	ws.mu.Unlock()

	ws.register <- client

	go ws.readPump(client)
	go ws.writePump(client)

	// å‘é€æ¬¢è¿Žæ¶ˆæ¯ç»™å®¢æˆ·ç«¯ï¼ŒåŒ…å«client_idå’Œtoken
	welcomeMsg := map[string]interface{}{
		"type":      "welcome",
		"client_id": clientID,
		"token":     token,
		"message":   "è¿žæŽ¥æˆåŠŸ",
		"timestamp": time.Now().Unix(),
	}

	jsonData, _ := json.Marshal(welcomeMsg)
	select {
	case client.send <- jsonData:
	default:
		log.Printf("Failed to send welcome message to client: %s", clientID)
	}

	log.Printf("âœ… New client connected with ID: %s", clientID)
}

// readPump å¤„ç†å®¢æˆ·ç«¯è¯»å–æ¶ˆæ¯
func (ws *WebSocketService) readPump(client *client) {
	defer func() {
		ws.unregister <- client
		client.conn.Close()
	}()

	conn := client.conn
	conn.SetReadLimit(1024 * 1024)
	conn.SetReadDeadline(time.Now().Add(ws.pingInterval * 2))
	conn.SetPongHandler(func(string) error {
		conn.SetReadDeadline(time.Now().Add(ws.pingInterval * 2))
		return nil
	})

	for {
		if _, _, err := conn.ReadMessage(); err != nil {
			log.Printf("read error, client disconnected: %v", err)
			return
		}
	}
}

// writePump å¤„ç†å®¢æˆ·ç«¯å†™å…¥æ¶ˆæ¯
func (ws *WebSocketService) writePump(client *client) {
	ticker := time.NewTicker(ws.pingInterval)
	defer func() {
		ticker.Stop()
		client.conn.Close()
	}()

	conn := client.conn

	for {
		select {
		case message, ok := <-client.send:
			conn.SetWriteDeadline(time.Now().Add(10 * time.Second))
			if !ok {
				_ = conn.WriteMessage(
					websocket.CloseMessage,
					websocket.FormatCloseMessage(websocket.CloseNormalClosure, ""),
				)
				return
			}

			if err := conn.WriteMessage(websocket.TextMessage, message); err != nil {
				log.Printf("write error: %v", err)
				return
			}

		case <-ticker.C:
			//conn.SetWriteDeadline(time.Now().Add(10 * time.Second))
			if err := conn.WriteMessage(websocket.PingMessage, nil); err != nil {
				log.Printf("ping failed: %v", err)
				return
			}
		}
	}
}

// Run å¯åŠ¨WebSocketæœåŠ¡ä¸»å¾ªçŽ¯
func (ws *WebSocketService) Run() {
	for {
		select {
		case client := <-ws.register:
			ws.mu.Lock()
			ws.clients[client.ID] = client
			ws.clientByID[client.ID] = client
			ws.mu.Unlock()
			log.Printf("âœ… client connected, ID: %s, current connections: %d", client.ID, len(ws.clients))

		case client := <-ws.unregister:
			ws.mu.Lock()
			if _, ok := ws.clients[client.ID]; ok {
				delete(ws.clients, client.ID)
				delete(ws.clientByID, client.ID)
				// æ¸…ç†tokenæ˜ å°„
				if client.Token != "" {
					delete(ws.tokenMap, client.Token)
				}
				close(client.send)
			}
			ws.mu.Unlock()
			log.Printf("âŒ client disconnected, ID: %s, current connections: %d", client.ID, len(ws.clients))
		}
	}
}

// SendToClient å‘æŒ‡å®šå®¢æˆ·ç«¯å‘é€æ¶ˆæ¯
func (ws *WebSocketService) SendToClient(clientID string, message []byte) bool {
	ws.mu.RLock()
	client, exists := ws.clientByID[clientID]
	ws.mu.RUnlock()

	if !exists {
		log.Printf("client not found: %s", clientID)
		return false
	}

	select {
	case client.send <- message:
		return true
	default:
		log.Printf("write queue full for client: %s", clientID)
		ws.mu.Lock()
		ws.unregister <- client
		ws.mu.Unlock()
		return false
	}
}

// GetClientCount èŽ·å–å½“å‰è¿žæŽ¥å®¢æˆ·ç«¯æ•°é‡
func (ws *WebSocketService) GetClientCount() int {
	ws.mu.RLock()
	defer ws.mu.RUnlock()
	return len(ws.clients)
}

// GetClientIDs èŽ·å–æ‰€æœ‰è¿žæŽ¥å®¢æˆ·ç«¯çš„IDåˆ—è¡¨
func (ws *WebSocketService) GetClientIDs() []string {
	ws.mu.RLock()
	defer ws.mu.RUnlock()

	clientIDs := make([]string, 0, len(ws.clients))
	for clientID := range ws.clients {
		clientIDs = append(clientIDs, clientID)
	}
	return clientIDs
}

// GetFirstClientID èŽ·å–ç¬¬ä¸€ä¸ªè¿žæŽ¥çš„å®¢æˆ·ç«¯IDï¼Œå¦‚æžœæ²¡æœ‰è¿žæŽ¥åˆ™è¿”å›žç©ºå­—ç¬¦ä¸²
func (ws *WebSocketService) GetFirstClientID() string {
	ws.mu.RLock()
	defer ws.mu.RUnlock()

	for clientID := range ws.clients {
		return clientID
	}
	return ""
}

// GetClientIDByToken é€šè¿‡tokenèŽ·å–å®¢æˆ·ç«¯ID
func (ws *WebSocketService) GetClientIDByToken(token string) (string, bool) {
	ws.mu.RLock()
	defer ws.mu.RUnlock()

	clientID, exists := ws.tokenMap[token]
	return clientID, exists
}

// GetClientInfoByToken é€šè¿‡tokenèŽ·å–å®¢æˆ·ç«¯è¯¦ç»†ä¿¡æ¯
func (ws *WebSocketService) GetClientInfoByToken(token string) (ClientInfo, bool) {
	ws.mu.RLock()
	defer ws.mu.RUnlock()

	clientID, exists := ws.tokenMap[token]
	if !exists {
		return ClientInfo{}, false
	}

	client, exists := ws.clientByID[clientID]
	if !exists {
		return ClientInfo{}, false
	}

	info := ClientInfo{
		ID:          client.ID,
		Token:       client.Token,
		Status:      "connected",
		ConnectedAt: time.Now(),
	}

	return info, true
}

// SendMessage å‘é€JSONæ¶ˆæ¯ç»™æŒ‡å®šå®¢æˆ·ç«¯
func (ws *WebSocketService) SendMessage(eventType string, data interface{}) {
	clientID := ws.GetFirstClientID()
	if clientID == "" {
		log.Println("No connected clients to send message")
		return
	}

	message := map[string]interface{}{
		"type":      eventType,
		"data":      data,
		"timestamp": time.Now().Unix(),
	}

	jsonData, err := json.Marshal(message)
	if err != nil {
		log.Printf("Failed to marshal message: %v", err)
		return
	}

	ws.SendToClient(clientID, jsonData)
}

================
File: internal/service/core/websocket/types.go
================
package websocket

import "time"

// Client WebSocketå®¢æˆ·ç«¯
type Client struct {
	ID    string
	Token string      // å®¢æˆ·ç«¯è®¿é—®ä»¤ç‰Œ
}

// ClientInfo å®¢æˆ·ç«¯ä¿¡æ¯
type ClientInfo struct {
	ID       string    `json:"id"`
	Token    string    `json:"token"`
	Status   string    `json:"status"`
	ConnectedAt time.Time `json:"connected_at"`
}

// WebSocketConfig WebSocketæœåŠ¡é…ç½®
type WebSocketConfig struct {
	ReadBufferSize  int           `json:"read_buffer_size"`
	WriteBufferSize int           `json:"write_buffer_size"`
	PingInterval    time.Duration `json:"ping_interval"`
}

================
File: internal/service/packet/filter_test.go
================
package packet

import (
	"testing"
	"time"

	"proxy-system-backend/internal/types"
)

func TestNewPacketFilter(t *testing.T) {
	pf := NewPacketFilter()

	if pf == nil {
		t.Fatal("NewPacketFilter returned nil")
	}

	// éªŒè¯é»˜è®¤å€¼
	config := pf.config.Load().(types.FilterConfig)
	if config.Enabled {
		t.Fatal("Expected filter to be disabled by default")
	}

	if config.DefaultAction != types.FilterActionAllow {
		t.Fatal("Expected default action to be allow")
	}

	if len(config.Rules) != 0 {
		t.Fatal("Expected no rules by default")
	}

	stats := pf.stats.Load().(types.FilterStats)
	if stats.TotalPackets != 0 {
		t.Fatal("Expected total packets to be 0 by default")
	}
}

func TestPacketFilterConfig(t *testing.T) {
	pf := NewPacketFilter()

	// åˆ›å»ºæµ‹è¯•é…ç½®
	config := types.FilterConfig{
		Enabled:       true,
		DefaultAction: types.FilterActionDeny,
		Rules: []types.FilterRule{
			{
				ID:          1,
				Name:        "Test Rule",
				Action:      types.FilterActionAllow,
				Direction:   types.FilterDirectionIn,
				SourceIPs:   []types.IPAddress{{IP: "192.168.1.0", Mask: 24}},
				SourcePorts: []types.PortRange{{Min: 12345, Max: 12345}}, // åŒ¹é…12345ç«¯å£
				DestIPs:     []types.IPAddress{},                         // ç›®æ ‡IPæ£€æŸ¥åœ¨å½“å‰å®žçŽ°ä¸­è¢«è·³è¿‡
				DestPorts:   []types.PortRange{},                         // ç›®æ ‡ç«¯å£æ£€æŸ¥å®žé™…ä¸Šæ£€æŸ¥çš„æ˜¯è¿œç¨‹åœ°å€çš„ç«¯å£
				Enabled:     true,
				Priority:    100,
				Description: "æµ‹è¯•è§„åˆ™",
			},
		},
		UpdateTime: time.Now(),
	}

	// æµ‹è¯•é…ç½®åŠ è½½
	if err := pf.LoadConfig(config); err != nil {
		t.Fatalf("LoadConfig failed: %v", err)
	}

	// éªŒè¯é…ç½®å·²åŠ è½½
	loadedConfig := pf.config.Load().(types.FilterConfig)
	if !loadedConfig.Enabled {
		t.Fatal("Expected filter to be enabled after loading config")
	}

	if loadedConfig.DefaultAction != types.FilterActionDeny {
		t.Fatal("Expected default action to be deny")
	}

	if len(loadedConfig.Rules) != 1 {
		t.Fatal("Expected 1 rule after loading config")
	}

	if loadedConfig.Rules[0].ID != 1 {
		t.Fatal("Expected rule ID to be 1")
	}
}

func TestPacketFilterFilterPacket(t *testing.T) {
	pf := NewPacketFilter()

	// åˆ›å»ºæµ‹è¯•é…ç½®
	config := types.FilterConfig{
		Enabled:       true,
		DefaultAction: types.FilterActionDeny,
		Rules: []types.FilterRule{
			{
				ID:          1,
				Name:        "Test Rule",
				Action:      types.FilterActionAllow,
				Direction:   types.FilterDirectionIn,
				SourceIPs:   []types.IPAddress{{IP: "192.168.1.0", Mask: 24}},
				SourcePorts: []types.PortRange{{Min: 12345, Max: 12345}},
				DestIPs:     []types.IPAddress{},
				DestPorts:   []types.PortRange{{Min: 8080, Max: 8080}},
				Enabled:     true,
				Priority:    100,
				Description: "æµ‹è¯•è§„åˆ™",
			},
		},
		UpdateTime: time.Now(),
	}

	// åŠ è½½é…ç½®
	if err := pf.LoadConfig(config); err != nil {
		t.Fatalf("LoadConfig failed: %v", err)
	}

	// æµ‹è¯•è¿‡æ»¤ - åº”è¯¥å…è®¸
	testData := []byte("test data")

	// æ·»åŠ è°ƒè¯•ä¿¡æ¯
	t.Logf("Testing packet from 192.168.1.10:12345 (should be allowed)")
	result := pf.FilterPacket("client1", "192.168.1.10:12345", testData, types.FilterDirectionIn)
	t.Logf("Filter result: %v", result)

	if !result {
		t.Fatal("Expected packet to be allowed")
	}

	// æµ‹è¯•è¿‡æ»¤ - åº”è¯¥æ‹’ç» (ç«¯å£ä¸åœ¨èŒƒå›´å†…)
	t.Logf("Testing packet from 192.168.1.10:8080 (should be denied)")
	result = pf.FilterPacket("client1", "192.168.1.10:8080", testData, types.FilterDirectionIn)
	t.Logf("Filter result: %v", result)

	if result {
		t.Fatal("Expected packet to be denied (port not in range)")
	}

	// æµ‹è¯•è¿‡æ»¤ - åº”è¯¥æ‹’ç» (IPä¸åœ¨èŒƒå›´å†…)
	t.Logf("Testing packet from 10.0.0.10:12345 (should be denied)")
	result = pf.FilterPacket("client1", "10.0.0.10:12345", testData, types.FilterDirectionIn)
	t.Logf("Filter result: %v", result)

	if result {
		t.Fatal("Expected packet to be denied (IP not in range)")
	}
}

func TestPacketFilterDisabled(t *testing.T) {
	pf := NewPacketFilter()

	// åˆ›å»ºç¦ç”¨è¿‡æ»¤çš„é…ç½®
	config := types.FilterConfig{
		Enabled:       false,
		DefaultAction: types.FilterActionDeny,
		Rules: []types.FilterRule{
			{
				ID:          1,
				Name:        "Test Rule",
				Action:      types.FilterActionAllow,
				Direction:   types.FilterDirectionIn,
				SourceIPs:   []types.IPAddress{{IP: "192.168.1.0", Mask: 24}},
				SourcePorts: []types.PortRange{{Min: 1, Max: 60034}},
				DestIPs:     []types.IPAddress{},
				DestPorts:   []types.PortRange{{Min: 8080, Max: 8080}},
				Enabled:     true,
				Priority:    100,
				Description: "æµ‹è¯•è§„åˆ™",
			},
		},
		UpdateTime: time.Now(),
	}

	// åŠ è½½é…ç½®
	if err := pf.LoadConfig(config); err != nil {
		t.Fatalf("LoadConfig failed: %v", err)
	}

	// æµ‹è¯•è¿‡æ»¤ - å³ä½¿é…ç½®å…è®¸ï¼Œä¹Ÿåº”è¯¥å…è®¸æ‰€æœ‰æ•°æ®åŒ…
	testData := []byte("test data")
	if !pf.FilterPacket("client1", "10.0.0.10:12345", testData, types.FilterDirectionIn) {
		t.Fatal("Expected packet to be allowed when filter is disabled")
	}
}

func TestPacketFilterNoMatchingRules(t *testing.T) {
	pf := NewPacketFilter()

	// åˆ›å»ºé…ç½® - æ²¡æœ‰åŒ¹é…çš„è§„åˆ™
	config := types.FilterConfig{
		Enabled:       true,
		DefaultAction: types.FilterActionDeny,
		Rules: []types.FilterRule{
			{
				ID:          1,
				Name:        "Test Rule",
				Action:      types.FilterActionAllow,
				Direction:   types.FilterDirectionOut,
				SourceIPs:   []types.IPAddress{{IP: "192.168.1.0", Mask: 24}},
				SourcePorts: []types.PortRange{{Min: 1, Max: 60034}},
				DestIPs:     []types.IPAddress{},
				DestPorts:   []types.PortRange{{Min: 8080, Max: 8080}},
				Enabled:     true,
				Priority:    100,
				Description: "æµ‹è¯•è§„åˆ™",
			},
		},
		UpdateTime: time.Now(),
	}

	// åŠ è½½é…ç½®
	if err := pf.LoadConfig(config); err != nil {
		t.Fatalf("LoadConfig failed: %v", err)
	}

	// æµ‹è¯•è¿‡æ»¤ - æ²¡æœ‰åŒ¹é…çš„è§„åˆ™ï¼Œä½¿ç”¨é»˜è®¤åŠ¨ä½œ
	testData := []byte("test data")
	if pf.FilterPacket("client1", "192.168.1.10:12345", testData, types.FilterDirectionIn) {
		t.Fatal("Expected packet to be denied (no matching rules, default action is deny)")
	}
}

func TestPacketFilterStats(t *testing.T) {
	pf := NewPacketFilter()

	// åˆ›å»ºé…ç½®
	config := types.FilterConfig{
		Enabled:       true,
		DefaultAction: types.FilterActionDeny,
		Rules: []types.FilterRule{
			{
				ID:          1,
				Name:        "Allow Rule",
				Action:      types.FilterActionAllow,
				Direction:   types.FilterDirectionIn,
				SourceIPs:   []types.IPAddress{{IP: "192.168.1.0", Mask: 24}},
				SourcePorts: []types.PortRange{{Min: 12345, Max: 12345}}, // åŒ¹é…12345ç«¯å£
				DestIPs:     []types.IPAddress{},                         // ç›®æ ‡IPæ£€æŸ¥åœ¨å½“å‰å®žçŽ°ä¸­è¢«è·³è¿‡
				DestPorts:   []types.PortRange{},                         // ç›®æ ‡ç«¯å£æ£€æŸ¥å®žé™…ä¸Šæ£€æŸ¥çš„æ˜¯è¿œç¨‹åœ°å€çš„ç«¯å£
				Enabled:     true,
				Priority:    100,
				Description: "æµ‹è¯•è§„åˆ™",
			},
		},
		UpdateTime: time.Now(),
	}

	// åŠ è½½é…ç½®
	if err := pf.LoadConfig(config); err != nil {
		t.Fatalf("LoadConfig failed: %v", err)
	}

	testData := []byte("test data")

	// å‘é€å¤šä¸ªæµ‹è¯•åŒ…
	pf.FilterPacket("client1", "192.168.1.10:12345", testData, types.FilterDirectionIn) // å…è®¸
	pf.FilterPacket("client1", "192.168.1.10:12346", testData, types.FilterDirectionIn) // æ‹’ç»
	pf.FilterPacket("client1", "192.168.1.10:12347", testData, types.FilterDirectionIn) // æ‹’ç»

	// èŽ·å–ç»Ÿè®¡ä¿¡æ¯
	stats := pf.GetStats()

	// éªŒè¯ç»Ÿè®¡ä¿¡æ¯
	if stats.TotalPackets != 3 {
		t.Fatalf("Expected total packets to be 3, got %d", stats.TotalPackets)
	}

	if stats.AllowedPackets != 1 {
		t.Fatalf("Expected allowed packets to be 1, got %d", stats.AllowedPackets)
	}

	if stats.BlockedPackets != 2 {
		t.Fatalf("Expected blocked packets to be 2, got %d", stats.BlockedPackets)
	}
}

// æµ‹è¯•GetStatså‡½æ•°
func TestPacketFilterGetStats(t *testing.T) {
	pf := NewPacketFilter()

	// åˆå§‹åŒ–ç»Ÿè®¡ä¿¡æ¯
	stats := types.FilterStats{
		TotalPackets:   10,
		AllowedPackets: 8,
		BlockedPackets: 2,
		LastUpdateTime: time.Now(),
	}

	// ç›´æŽ¥è®¾ç½®ç»Ÿè®¡ä¿¡æ¯ï¼ˆè·³è¿‡LoadConfigä¸­çš„è‡ªåŠ¨åˆå§‹åŒ–ï¼‰
	pf.stats.Store(stats)

	// èŽ·å–ç»Ÿè®¡ä¿¡æ¯
	resultStats := pf.GetStats()

	// éªŒè¯ç»Ÿè®¡ä¿¡æ¯
	if resultStats.TotalPackets != 10 {
		t.Fatalf("Expected total packets to be 10, got %d", resultStats.TotalPackets)
	}

	if resultStats.AllowedPackets != 8 {
		t.Fatalf("Expected allowed packets to be 8, got %d", resultStats.AllowedPackets)
	}

	if resultStats.BlockedPackets != 2 {
		t.Fatalf("Expected blocked packets to be 2, got %d", resultStats.BlockedPackets)
	}
}

================
File: internal/service/packet/filter.go
================
package packet

import (
	"fmt"
	"log"
	"net"
	"sort"
	"strconv"
	"sync"
	"sync/atomic"
	"time"

	"proxy-system-backend/internal/types"
)

// PacketFilter æ•°æ®åŒ…è¿‡æ»¤å™¨
type PacketFilter struct {
	config     atomic.Value // å­˜å‚¨ FilterConfig
	stats      atomic.Value // å­˜å‚¨ FilterStats
	rules      []*FilterRuleInternal
	mu         sync.RWMutex
	lastUpdate time.Time
}

// FilterRuleInternal å†…éƒ¨è¿‡æ»¤è§„åˆ™ç»“æž„
type FilterRuleInternal struct {
	ID            int
	Name          string
	Action        types.FilterAction
	Direction     types.FilterDirection
	SourceIPs     []net.IP
	SourceIPMasks []int
	SourcePorts   []PortRange
	DestIPs       []net.IP
	DestIPMasks   []int
	DestPorts     []PortRange
	Enabled       bool
	Priority      int
	Description   string
}

// PortRange ç«¯å£èŒƒå›´ç»“æž„
type PortRange struct {
	Min int
	Max int
}

// NewPacketFilter åˆ›å»ºæ–°çš„æ•°æ®åŒ…è¿‡æ»¤å™¨
func NewPacketFilter() *PacketFilter {
	pf := &PacketFilter{
		lastUpdate: time.Now(),
	}

	// åˆå§‹åŒ–é»˜è®¤é…ç½®
	defaultConfig := types.FilterConfig{
		Enabled:       false,
		DefaultAction: types.FilterActionAllow,
		Rules:         []types.FilterRule{},
		UpdateTime:    time.Now(),
	}
	pf.config.Store(defaultConfig)

	// åˆå§‹åŒ–é»˜è®¤ç»Ÿè®¡
	defaultStats := types.FilterStats{
		TotalPackets:   0,
		AllowedPackets: 0,
		BlockedPackets: 0,
		ActiveRules:    0,
		LastUpdateTime: time.Now(),
	}
	pf.stats.Store(defaultStats)

	return pf
}

// LoadConfig åŠ è½½è¿‡æ»¤é…ç½®
func (pf *PacketFilter) LoadConfig(config types.FilterConfig) error {
	if err := pf.validateConfig(config); err != nil {
		return err
	}

	compiled, err := pf.compileRules(config.Rules)
	if err != nil {
		return err
	}

	pf.mu.Lock()
	defer pf.mu.Unlock()

	config.UpdateTime = time.Now()
	pf.config.Store(config)

	pf.rules = compiled
	pf.lastUpdate = time.Now()

	stats := pf.stats.Load().(types.FilterStats)
	stats.ActiveRules = len(compiled)
	stats.LastUpdateTime = time.Now()
	pf.stats.Store(stats)

	log.Printf("âœ… Filter loaded: %d active rules", len(compiled))
	return nil
}

// compileRules ç¼–è¯‘è§„åˆ™ä¸ºå†…éƒ¨æ ¼å¼
func (pf *PacketFilter) compileRules(rules []types.FilterRule) ([]*FilterRuleInternal, error) {
	var compiled []*FilterRuleInternal

	for _, rule := range rules {
		if !rule.Enabled {
			continue
		}

		compiledRule, err := pf.compileRule(rule)
		if err != nil {
			log.Printf("Warning: failed to compile rule %s: %v", rule.Name, err)
			continue
		}

		compiled = append(compiled, compiledRule)
	}

	// æŒ‰ä¼˜å…ˆçº§æŽ’åº
	sort.Slice(compiled, func(i, j int) bool {
		return compiled[i].Priority > compiled[j].Priority
	})

	return compiled, nil
}

// compileRule ç¼–è¯‘å•ä¸ªè§„åˆ™
func (pf *PacketFilter) compileRule(rule types.FilterRule) (*FilterRuleInternal, error) {
	compiled := &FilterRuleInternal{
		ID:          rule.ID,
		Name:        rule.Name,
		Action:      rule.Action,
		Direction:   rule.Direction,
		Enabled:     rule.Enabled,
		Priority:    rule.Priority,
		Description: rule.Description,
	}

	// ç¼–è¯‘æºIP
	for _, ipAddr := range rule.SourceIPs {
		ip := net.ParseIP(ipAddr.IP)
		if ip == nil {
			return nil, fmt.Errorf("invalid source IP: %s", ipAddr.IP)
		}
		compiled.SourceIPs = append(compiled.SourceIPs, ip)
		compiled.SourceIPMasks = append(compiled.SourceIPMasks, ipAddr.Mask)
	}

	// ç¼–è¯‘æºç«¯å£
	for _, portRange := range rule.SourcePorts {
		if portRange.Min < 0 || portRange.Max < 0 || portRange.Min > portRange.Max {
			return nil, fmt.Errorf("invalid source port range: %d-%d", portRange.Min, portRange.Max)
		}
		compiled.SourcePorts = append(compiled.SourcePorts, PortRange{Min: portRange.Min, Max: portRange.Max})
	}

	// ç¼–è¯‘ç›®æ ‡IP
	for _, ipAddr := range rule.DestIPs {
		ip := net.ParseIP(ipAddr.IP)
		if ip == nil {
			return nil, fmt.Errorf("invalid dest IP: %s", ipAddr.IP)
		}
		compiled.DestIPs = append(compiled.DestIPs, ip)
		compiled.DestIPMasks = append(compiled.DestIPMasks, ipAddr.Mask)
	}

	// ç¼–è¯‘ç›®æ ‡ç«¯å£
	for _, portRange := range rule.DestPorts {
		if portRange.Min < 0 || portRange.Max < 0 || portRange.Min > portRange.Max {
			return nil, fmt.Errorf("invalid dest port range: %d-%d", portRange.Min, portRange.Max)
		}
		compiled.DestPorts = append(compiled.DestPorts, PortRange{Min: portRange.Min, Max: portRange.Max})
	}

	return compiled, nil
}

// FilterPacket è¿‡æ»¤æ•°æ®åŒ…
func (pf *PacketFilter) FilterPacket(clientID string, remoteAddr string, data []byte, direction types.FilterDirection) bool {
	pf.mu.RLock()
	defer pf.mu.RUnlock()

	config := pf.config.Load().(types.FilterConfig)

	if !config.Enabled {
		return true // è¿‡æ»¤æœªå¯ç”¨ï¼Œå…è®¸æ‰€æœ‰æ•°æ®åŒ…
	}

	stats := pf.stats.Load().(types.FilterStats)
	stats.TotalPackets++
	pf.stats.Store(stats)

	// æ£€æŸ¥æ¯ä¸ªè§„åˆ™
	for _, rule := range pf.rules {
		if !pf.ruleMatches(rule, remoteAddr, direction) {
			continue
		}

		// è§„åˆ™åŒ¹é…ï¼Œæ ¹æ®åŠ¨ä½œå†³å®š
		pf.updateStats(rule.Action == types.FilterActionAllow)
		return rule.Action == types.FilterActionAllow
	}

	// æ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•è§„åˆ™ï¼Œä½¿ç”¨é»˜è®¤åŠ¨ä½œ
	pf.updateStats(config.DefaultAction == types.FilterActionAllow)
	return config.DefaultAction == types.FilterActionAllow
}

// ruleMatches æ£€æŸ¥è§„åˆ™æ˜¯å¦åŒ¹é…
func (pf *PacketFilter) ruleMatches(rule *FilterRuleInternal, remoteAddr string, direction types.FilterDirection) bool {
	// æ£€æŸ¥æ–¹å‘
	if !pf.directionMatches(rule.Direction, direction) {
		log.Printf("Debug ruleMatches: direction mismatch (rule: %s, packet: %s)", rule.Direction, direction)
		return false
	}

	// è§£æžè¿œç¨‹åœ°å€
	host, portStr, err := net.SplitHostPort(remoteAddr)
	if err != nil {
		host = remoteAddr // å¦‚æžœæ²¡æœ‰ç«¯å£ï¼Œä½¿ç”¨æ•´ä¸ªå­—ç¬¦ä¸²
		portStr = "0"
	}

	port, err := strconv.Atoi(portStr)
	if err != nil {
		log.Printf("Debug ruleMatches: failed to parse port: %v", err)
		return false
	}

	log.Printf("Debug ruleMatches: checking remoteAddr %s (host: %s, port: %d)", remoteAddr, host, port)

	// æ£€æŸ¥æºIPï¼ˆå¯¹äºŽå…¥ç«™è¿žæŽ¥ï¼Œè¿œç¨‹åœ°å€å°±æ˜¯æºåœ°å€ï¼‰
	remoteIP := net.ParseIP(host)
	if remoteIP != nil && len(rule.SourceIPs) > 0 {
		log.Printf("Debug ruleMatches: checking source IPs (count: %d)", len(rule.SourceIPs))
		if !pf.ipMatches(remoteIP, rule.SourceIPs, rule.SourceIPMasks) {
			log.Printf("Debug ruleMatches: source IP did not match")
			return false
		}
	}

	// å¯¹äºŽå…¥ç«™è¿žæŽ¥ï¼Œè¿œç¨‹åœ°å€çš„ç«¯å£å°±æ˜¯æºç«¯å£
	// è§„åˆ™ä¸­æŒ‡å®šçš„SourcePortsåº”è¯¥åŒ¹é…è¿œç¨‹åœ°å€çš„ç«¯å£
	if len(rule.SourcePorts) > 0 {
		log.Printf("Debug ruleMatches: checking source ports (count: %d)", len(rule.SourcePorts))
		if !pf.portMatches(port, rule.SourcePorts) {
			log.Printf("Debug ruleMatches: source port %d did not match", port)
			return false
		}
	}

	// æ£€æŸ¥ç›®æ ‡IPï¼ˆå¯¹äºŽå…¥ç«™è¿žæŽ¥ï¼Œæœ¬åœ°åœ°å€å°±æ˜¯ç›®æ ‡åœ°å€ï¼‰
	// è¿™é‡Œæš‚æ—¶ä½¿ç”¨ç®€åŒ–é€»è¾‘ï¼Œå®žé™…åº”è¯¥èŽ·å–æœ¬åœ°åœ°å€
	if len(rule.DestIPs) > 0 {
		log.Printf("Debug ruleMatches: skipping dest IP check (not implemented)")
	}

	// å¯¹äºŽå…¥ç«™è¿žæŽ¥ï¼Œè¿œç¨‹åœ°å€çš„ç«¯å£å°±æ˜¯æºç«¯å£
	// ç›®æ ‡ç«¯å£çš„æ£€æŸ¥åœ¨å½“å‰å®žçŽ°ä¸­è¢«è·³è¿‡ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•èŽ·å–åˆ°çœŸæ­£çš„ç›®æ ‡ç«¯å£

	log.Printf("Debug ruleMatches: rule matched!")
	return true
}

// directionMatches æ£€æŸ¥æ–¹å‘æ˜¯å¦åŒ¹é…
func (pf *PacketFilter) directionMatches(ruleDir types.FilterDirection, pktDir types.FilterDirection) bool {
	return ruleDir == pktDir || ruleDir == types.FilterDirectionBoth
}

// ipMatches æ£€æŸ¥IPæ˜¯å¦åŒ¹é…
func (pf *PacketFilter) ipMatches(ip net.IP, ips []net.IP, masks []int) bool {
	for i, ruleIP := range ips {
		mask := 32
		if i < len(masks) {
			mask = masks[i]
		}

		log.Printf("Debug ipMatches: checking IP %s against rule IP %s with mask %d", ip.String(), ruleIP.String(), mask)

		if mask == 32 {
			// ç²¾ç¡®åŒ¹é…
			if ip.Equal(ruleIP) {
				log.Printf("Debug ipMatches: IP %s exactly matches rule IP %s", ip.String(), ruleIP.String())
				return true
			}
		} else {
			// CIDRåŒ¹é…
			_, subnet, err := net.ParseCIDR(fmt.Sprintf("%s/%d", ruleIP.String(), mask))
			if err != nil {
				log.Printf("Debug ipMatches: failed to parse CIDR: %v", err)
				continue
			}
			if subnet.Contains(ip) {
				log.Printf("Debug ipMatches: IP %s is within subnet %s", ip.String(), subnet.String())
				return true
			}
		}
	}
	log.Printf("Debug ipMatches: IP %s did not match any rules", ip.String())
	return false
}

// portMatches æ£€æŸ¥ç«¯å£æ˜¯å¦åŒ¹é…
func (pf *PacketFilter) portMatches(port int, ranges []PortRange) bool {
	for _, r := range ranges {
		if port >= r.Min && port <= r.Max {
			return true
		}
	}
	return false
}

// updateStats æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
func (pf *PacketFilter) updateStats(allowed bool) {
	stats := pf.stats.Load().(types.FilterStats)
	if allowed {
		stats.AllowedPackets++
	} else {
		stats.BlockedPackets++
	}
	pf.stats.Store(stats)
}

// GetStats èŽ·å–ç»Ÿè®¡ä¿¡æ¯
func (pf *PacketFilter) GetStats() types.FilterStats {
	return pf.stats.Load().(types.FilterStats)
}

// GetConfig èŽ·å–å½“å‰é…ç½®
func (pf *PacketFilter) GetConfig() types.FilterConfig {
	return pf.config.Load().(types.FilterConfig)
}

// validateRule éªŒè¯å•ä¸ªè§„åˆ™
func (pf *PacketFilter) validateRule(rule types.FilterRule) error {
	if rule.Name == "" {
		return fmt.Errorf("rule name cannot be empty")
	}

	if rule.Action != types.FilterActionAllow && rule.Action != types.FilterActionDeny {
		return fmt.Errorf("invalid action: %s", rule.Action)
	}

	if rule.Direction != types.FilterDirectionIn && rule.Direction != types.FilterDirectionOut && rule.Direction != types.FilterDirectionBoth {
		return fmt.Errorf("invalid direction: %s", rule.Direction)
	}

	// éªŒè¯IPæ ¼å¼
	for _, ipAddr := range rule.SourceIPs {
		if ip := net.ParseIP(ipAddr.IP); ip == nil {
			return fmt.Errorf("invalid source IP: %s", ipAddr.IP)
		}
		if ipAddr.Mask < 0 || ipAddr.Mask > 32 {
			return fmt.Errorf("invalid source IP mask: %d", ipAddr.Mask)
		}
	}

	for _, ipAddr := range rule.DestIPs {
		if ip := net.ParseIP(ipAddr.IP); ip == nil {
			return fmt.Errorf("invalid dest IP: %s", ipAddr.IP)
		}
		if ipAddr.Mask < 0 || ipAddr.Mask > 32 {
			return fmt.Errorf("invalid dest IP mask: %d", ipAddr.Mask)
		}
	}

	// éªŒè¯ç«¯å£èŒƒå›´
	for _, portRange := range rule.SourcePorts {
		if portRange.Min < 0 || portRange.Max < 0 || portRange.Min > portRange.Max {
			return fmt.Errorf("invalid source port range: %d-%d", portRange.Min, portRange.Max)
		}
		if portRange.Max > 65535 {
			return fmt.Errorf("source port range exceeds maximum: %d", portRange.Max)
		}
	}

	for _, portRange := range rule.DestPorts {
		if portRange.Min < 0 || portRange.Max < 0 || portRange.Min > portRange.Max {
			return fmt.Errorf("invalid dest port range: %d-%d", portRange.Min, portRange.Max)
		}
		if portRange.Max > 65535 {
			return fmt.Errorf("dest port range exceeds maximum: %d", portRange.Max)
		}
	}

	return nil
}

// validateConfig éªŒè¯é…ç½®
func (pf *PacketFilter) validateConfig(config types.FilterConfig) error {
	if config.DefaultAction != types.FilterActionAllow && config.DefaultAction != types.FilterActionDeny {
		return fmt.Errorf("invalid default action: %s", config.DefaultAction)
	}

	for _, rule := range config.Rules {
		if err := pf.validateRule(rule); err != nil {
			return fmt.Errorf("invalid rule %s: %w", rule.Name, err)
		}
	}

	return nil
}

// AddRule æ·»åŠ è§„åˆ™
func (pf *PacketFilter) AddRule(rule types.FilterRule) error {
	if err := pf.validateRule(rule); err != nil {
		return err
	}

	config := pf.GetConfig()
	config.Rules = append(config.Rules, rule)
	return pf.LoadConfig(config)
}

// UpdateRule æ›´æ–°è§„åˆ™
func (pf *PacketFilter) UpdateRule(rule types.FilterRule) error {
	if err := pf.validateRule(rule); err != nil {
		return err
	}

	config := pf.GetConfig()
	for i, r := range config.Rules {
		if r.ID == rule.ID {
			config.Rules[i] = rule
			break
		}
	}
	return pf.LoadConfig(config)
}

// DeleteRule åˆ é™¤è§„åˆ™
func (pf *PacketFilter) DeleteRule(ruleID int) error {
	config := pf.GetConfig()
	for i, r := range config.Rules {
		if r.ID == ruleID {
			config.Rules = append(config.Rules[:i], config.Rules[i+1:]...)
			break
		}
	}
	return pf.LoadConfig(config)
}

// EnableFiltering å¯ç”¨/ç¦ç”¨è¿‡æ»¤
func (pf *PacketFilter) EnableFiltering(enabled bool) {
	config := pf.GetConfig()
	config.Enabled = enabled
	pf.LoadConfig(config)
}

// SetDefaultAction è®¾ç½®é»˜è®¤åŠ¨ä½œ
func (pf *PacketFilter) SetDefaultAction(action types.FilterAction) {
	config := pf.GetConfig()
	config.DefaultAction = action
	pf.LoadConfig(config)
}

================
File: internal/service/plugin/plugin_service.go
================
package plugin

import (
	"database/sql"

	"fmt"
	"io"
	"log"
	"os"
	"path/filepath"
	"sort"
	"strings"
	"sync"
	"time"

	_ "modernc.org/sqlite"
)

// PluginService æ’ä»¶ç®¡ç†æœåŠ¡
type PluginService struct {
	config    PluginManagerConfig
	db        *sql.DB
	mu        sync.RWMutex
	pluginDir string
}

// NewPluginService åˆ›å»ºæ’ä»¶ç®¡ç†æœåŠ¡
func NewPluginService(config PluginManagerConfig) *PluginService {
	return &PluginService{
		config:    config,
		pluginDir: config.PluginDir,
	}
}

// Initialize åˆå§‹åŒ–æ’ä»¶æœåŠ¡
func (ps *PluginService) Initialize() error {
	// åˆ›å»ºæ’ä»¶ç›®å½•
	if err := os.MkdirAll(ps.pluginDir, 0755); err != nil {
		return fmt.Errorf("failed to create plugin directory: %w", err)
	}

	// åˆå§‹åŒ–æ•°æ®åº“
	dbPath := filepath.Join(ps.pluginDir, "plugins.db")
	db, err := sql.Open("sqlite", dbPath+"?_journal_mode=WAL")
	if err != nil {
		return fmt.Errorf("failed to open database: %w", err)
	}
	ps.db = db

	// åˆ›å»ºè¡¨
	if err := ps.createTables(); err != nil {
		return fmt.Errorf("failed to create tables: %w", err)
	}

	// æ‰«æçŽ°æœ‰æ’ä»¶
	if err := ps.scanPlugins(); err != nil {
		log.Printf("Warning: failed to scan existing plugins: %v", err)
	}

	return nil
}

// createTables åˆ›å»ºæ•°æ®åº“è¡¨
func (ps *PluginService) createTables() error {
	// åˆ›å»ºæ’ä»¶è¡¨
	pluginsQuery := `
	CREATE TABLE IF NOT EXISTS plugins (
		id INTEGER PRIMARY KEY AUTOINCREMENT,
		name TEXT UNIQUE NOT NULL,
		path TEXT NOT NULL,
		size INTEGER NOT NULL,
		created_at TEXT NOT NULL,
		modified_at TEXT NOT NULL,
		status TEXT NOT NULL,
		description TEXT,
		created_at_db TEXT DEFAULT CURRENT_TIMESTAMP
	)
	`

	// åˆ›å»ºè¿‡æ»¤è§„åˆ™è¡¨
	filterRulesQuery := `
	CREATE TABLE IF NOT EXISTS filter_rules (
		id INTEGER PRIMARY KEY AUTOINCREMENT,
		name TEXT NOT NULL,
		action TEXT NOT NULL,
		direction TEXT NOT NULL,
		source_ips TEXT, -- JSONæ ¼å¼å­˜å‚¨
		dest_ips TEXT,   -- JSONæ ¼å¼å­˜å‚¨
		source_ports TEXT, -- JSONæ ¼å¼å­˜å‚¨
		dest_ports TEXT,   -- JSONæ ¼å¼å­˜å‚¨
		enabled INTEGER NOT NULL DEFAULT 1,
		priority INTEGER NOT NULL DEFAULT 0,
		description TEXT,
		created_at TEXT NOT NULL,
		updated_at TEXT NOT NULL,
		created_at_db TEXT DEFAULT CURRENT_TIMESTAMP
	)
	`

	// åˆ›å»ºè¿‡æ»¤é…ç½®è¡¨
	filterConfigQuery := `
	CREATE TABLE IF NOT EXISTS filter_config (
		id INTEGER PRIMARY KEY AUTOINCREMENT,
		enabled INTEGER NOT NULL DEFAULT 0,
		default_action TEXT NOT NULL,
		rules TEXT, -- JSONæ ¼å¼å­˜å‚¨å®Œæ•´è§„åˆ™åˆ—è¡¨
		update_time TEXT NOT NULL,
		created_at_db TEXT DEFAULT CURRENT_TIMESTAMP
	)
	`

	// æ‰§è¡Œå»ºè¡¨è¯­å¥
	if _, err := ps.db.Exec(pluginsQuery); err != nil {
		return fmt.Errorf("failed to create plugins table: %w", err)
	}

	if _, err := ps.db.Exec(filterRulesQuery); err != nil {
		return fmt.Errorf("failed to create filter_rules table: %w", err)
	}

	if _, err := ps.db.Exec(filterConfigQuery); err != nil {
		return fmt.Errorf("failed to create filter_config table: %w", err)
	}

	// æ’å…¥é»˜è®¤è¿‡æ»¤é…ç½®
	if err := ps.insertDefaultFilterConfig(); err != nil {
		return fmt.Errorf("failed to insert default filter config: %w", err)
	}

	return nil
}

// insertDefaultFilterConfig æ’å…¥é»˜è®¤è¿‡æ»¤é…ç½®
func (ps *PluginService) insertDefaultFilterConfig() error {
	// æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨é…ç½®
	var count int
	err := ps.db.QueryRow("SELECT COUNT(*) FROM filter_config").Scan(&count)
	if err != nil {
		return err
	}

	if count > 0 {
		return nil // å·²å­˜åœ¨é…ç½®ï¼Œæ— éœ€æ’å…¥
	}

	// æ’å…¥é»˜è®¤é…ç½®
	query := `
		INSERT INTO filter_config (enabled, default_action, rules, update_time)
		VALUES (?, ?, ?, ?)
	`

	_, err = ps.db.Exec(query, 0, "allow", "[]", time.Now().Format(time.RFC3339))
	return err
}

// UploadPlugin ä¸Šä¼ æ’ä»¶
func (ps *PluginService) UploadPlugin(name string, file io.Reader, metadata PluginUploadRequest) (*PluginInfo, error) {
	// æ£€æŸ¥æ’ä»¶æ˜¯å¦å·²å­˜åœ¨
	exists, err := ps.pluginExists(name)
	if err != nil {
		return nil, fmt.Errorf("failed to check plugin existence: %w", err)
	}
	if exists {
		return nil, fmt.Errorf("plugin '%s' already exists", name)
	}

	// ç”Ÿæˆæ’ä»¶æ–‡ä»¶è·¯å¾„
	pluginPath := filepath.Join(ps.pluginDir, name)

	// æ£€æŸ¥æ–‡ä»¶å¤§å°é™åˆ¶
	if ps.config.MaxSize > 0 {
		// åˆ›å»ºä¸´æ—¶æ–‡ä»¶æ¥æ£€æŸ¥å¤§å°
		tempFile, err := os.CreateTemp(ps.pluginDir, "upload-*")
		if err != nil {
			return nil, fmt.Errorf("failed to create temp file: %w", err)
		}
		defer os.Remove(tempFile.Name())

		// å†™å…¥æ–‡ä»¶å¹¶æ£€æŸ¥å¤§å°
		written, err := io.Copy(tempFile, file)
		if err != nil {
			tempFile.Close()
			return nil, fmt.Errorf("failed to write plugin file: %w", err)
		}

		if ps.config.MaxSize > 0 && written > ps.config.MaxSize {
			tempFile.Close()
			return nil, fmt.Errorf("plugin file too large: %d bytes (max: %d)", written, ps.config.MaxSize)
		}

		// é‡å‘½ååˆ°æœ€ç»ˆè·¯å¾„
		if err := tempFile.Close(); err != nil {
			return nil, fmt.Errorf("failed to close temp file: %w", err)
		}

		if err := os.Rename(tempFile.Name(), pluginPath); err != nil {
			return nil, fmt.Errorf("failed to move plugin file: %w", err)
		}
	} else {
		// ç›´æŽ¥å†™å…¥æœ€ç»ˆæ–‡ä»¶
		outFile, err := os.Create(pluginPath)
		if err != nil {
			return nil, fmt.Errorf("failed to create plugin file: %w", err)
		}
		defer outFile.Close()

		written, err := io.Copy(outFile, file)
		if err != nil {
			return nil, fmt.Errorf("failed to write plugin file: %w", err)
		}

		if ps.config.MaxSize > 0 && written > ps.config.MaxSize {
			return nil, fmt.Errorf("plugin file too large: %d bytes (max: %d)", written, ps.config.MaxSize)
		}
	}

	// èŽ·å–æ–‡ä»¶ä¿¡æ¯
	fileInfo, err := os.Stat(pluginPath)
	if err != nil {
		os.Remove(pluginPath)
		return nil, fmt.Errorf("failed to get file info: %w", err)
	}

	now := time.Now()
	// æ’å…¥æ•°æ®åº“
	query := `
		INSERT INTO plugins (name, path, size, created_at, modified_at, status, description)
		VALUES (?, ?, ?, ?, ?, ?, ?)
	`
	_, err = ps.db.Exec(query, name, pluginPath, fileInfo.Size(),
		fileInfo.ModTime().Format(time.RFC3339), now.Format(time.RFC3339),
		"active", metadata.Description)
	if err != nil {
		os.Remove(pluginPath)
		return nil, fmt.Errorf("failed to insert plugin into database: %w", err)
	}

	// åˆ›å»ºæ’ä»¶ä¿¡æ¯
	pluginInfo := &PluginInfo{
		Name:        name,
		Path:        pluginPath,
		Size:        fileInfo.Size(),
		CreatedAt:   fileInfo.ModTime(),
		ModifiedAt:  now,
		Status:      "active",
		Description: metadata.Description,
	}

	log.Printf("Plugin '%s' uploaded successfully", name)
	return pluginInfo, nil
}

// DeletePlugin åˆ é™¤æ’ä»¶
func (ps *PluginService) DeletePlugin(name string) error {
	// èŽ·å–æ’ä»¶ä¿¡æ¯
	plugin, err := ps.getPluginFromDB(name)
	if err != nil {
		return fmt.Errorf("plugin '%s' not found", name)
	}

	// åˆ é™¤æ–‡ä»¶
	if err := os.Remove(plugin.Path); err != nil {
		log.Printf("Warning: failed to remove plugin file %s: %v", plugin.Path, err)
	}

	// ä»Žæ•°æ®åº“åˆ é™¤
	query := "DELETE FROM plugins WHERE name = ?"
	_, err = ps.db.Exec(query, name)
	if err != nil {
		return fmt.Errorf("failed to delete plugin from database: %w", err)
	}

	log.Printf("Plugin '%s' deleted successfully", name)
	return nil
}

// GetPlugin èŽ·å–æ’ä»¶ä¿¡æ¯
func (ps *PluginService) GetPlugin(name string) (*PluginInfo, error) {
	plugin, err := ps.getPluginFromDB(name)
	if err != nil {
		return nil, fmt.Errorf("plugin '%s' not found", name)
	}

	// æ›´æ–°æ–‡ä»¶ä¿¡æ¯ï¼ˆå¤§å°ç­‰å¯èƒ½å‘ç”Ÿå˜åŒ–ï¼‰
	if err := ps.updatePluginFileInfo(plugin); err != nil {
		log.Printf("Warning: failed to update plugin info for %s: %v", name, err)
	}

	return plugin, nil
}

// ListPlugins èŽ·å–æ’ä»¶åˆ—è¡¨
func (ps *PluginService) ListPlugins() ([]*PluginInfo, error) {
	query := "SELECT name, path, size, created_at, modified_at, status, description FROM plugins ORDER BY name"
	rows, err := ps.db.Query(query)
	if err != nil {
		return nil, fmt.Errorf("failed to query plugins: %w", err)
	}
	defer rows.Close()

	var plugins []*PluginInfo
	for rows.Next() {
		var name, path, status, description string
		var size int64
		var createdAtStr, modifiedAtStr string

		err := rows.Scan(&name, &path, &size, &createdAtStr, &modifiedAtStr, &status, &description)
		if err != nil {
			log.Printf("Warning: failed to scan plugin row: %v", err)
			continue
		}

		createdAt, _ := time.Parse(time.RFC3339, createdAtStr)
		modifiedAt, _ := time.Parse(time.RFC3339, modifiedAtStr)

		plugin := &PluginInfo{
			Name:        name,
			Path:        path,
			Size:        size,
			CreatedAt:   createdAt,
			ModifiedAt:  modifiedAt,
			Status:      status,
			Description: description,
		}

		// æ›´æ–°æ–‡ä»¶ä¿¡æ¯
		if err := ps.updatePluginFileInfo(plugin); err != nil {
			log.Printf("Warning: failed to update plugin info for %s: %v", name, err)
		}

		plugins = append(plugins, plugin)
	}

	// æŒ‰åç§°æŽ’åº
	sort.Slice(plugins, func(i, j int) bool {
		return strings.ToLower(plugins[i].Name) < strings.ToLower(plugins[j].Name)
	})

	return plugins, nil
}

// scanPlugins æ‰«ææ’ä»¶ç›®å½•
func (ps *PluginService) scanPlugins() error {
	return filepath.Walk(ps.pluginDir, func(path string, info os.FileInfo, err error) error {
		if err != nil {
			return err
		}

		// è·³è¿‡ç›®å½•
		if info.IsDir() {
			return nil
		}

		// è·³è¿‡æ•°æ®åº“æ–‡ä»¶
		if strings.HasSuffix(path, ".db") {
			return nil
		}

		// åªå¤„ç†å¯æ‰§è¡Œæ–‡ä»¶æˆ–ç‰¹å®šæ‰©å±•å
		if !ps.isValidPluginFile(path, info) {
			return nil
		}

		name := filepath.Base(path)

		// æ£€æŸ¥æ˜¯å¦å·²åœ¨æ•°æ®åº“ä¸­
		exists, err := ps.pluginExists(name)
		if err != nil {
			log.Printf("Warning: failed to check plugin existence for %s: %v", name, err)
			return nil
		}
		if exists {
			return nil
		}

		// æ’å…¥åˆ°æ•°æ®åº“
		query := `
			INSERT INTO plugins (name, path, size, created_at, modified_at, status, description)
			VALUES (?, ?, ?, ?, ?, ?, ?)
		`
		_, err = ps.db.Exec(query, name, path, info.Size(),
			info.ModTime().Format(time.RFC3339), info.ModTime().Format(time.RFC3339),
			"active", "")
		if err != nil {
			log.Printf("Warning: failed to insert plugin %s into database: %v", name, err)
		}

		return nil
	})
}

// pluginExists æ£€æŸ¥æ’ä»¶æ˜¯å¦å­˜åœ¨
func (ps *PluginService) pluginExists(name string) (bool, error) {
	query := "SELECT COUNT(*) FROM plugins WHERE name = ?"
	var count int
	err := ps.db.QueryRow(query, name).Scan(&count)
	return count > 0, err
}

// getPluginFromDB ä»Žæ•°æ®åº“èŽ·å–æ’ä»¶ä¿¡æ¯
func (ps *PluginService) getPluginFromDB(name string) (*PluginInfo, error) {
	query := "SELECT name, path, size, created_at, modified_at, status, description FROM plugins WHERE name = ?"
	var pluginName, path, status, description string
	var size int64
	var createdAtStr, modifiedAtStr string

	err := ps.db.QueryRow(query, name).Scan(&pluginName, &path, &size, &createdAtStr, &modifiedAtStr, &status, &description)
	if err != nil {
		return nil, err
	}

	createdAt, _ := time.Parse(time.RFC3339, createdAtStr)
	modifiedAt, _ := time.Parse(time.RFC3339, modifiedAtStr)

	return &PluginInfo{
		Name:        pluginName,
		Path:        path,
		Size:        size,
		CreatedAt:   createdAt,
		ModifiedAt:  modifiedAt,
		Status:      status,
		Description: description,
	}, nil
}

// updatePluginFileInfo æ›´æ–°æ’ä»¶æ–‡ä»¶ä¿¡æ¯
func (ps *PluginService) updatePluginFileInfo(plugin *PluginInfo) error {
	fileInfo, err := os.Stat(plugin.Path)
	if err != nil {
		return err
	}

	// å¦‚æžœæ–‡ä»¶ä¿¡æ¯å‘ç”Ÿå˜åŒ–ï¼Œæ›´æ–°æ•°æ®åº“
	if fileInfo.Size() != plugin.Size || !fileInfo.ModTime().Equal(plugin.ModifiedAt) {
		plugin.Size = fileInfo.Size()
		plugin.ModifiedAt = fileInfo.ModTime()

		query := "UPDATE plugins SET size = ?, modified_at = ? WHERE name = ?"
		_, err := ps.db.Exec(query, plugin.Size, plugin.ModifiedAt.Format(time.RFC3339), plugin.Name)
		if err != nil {
			log.Printf("Warning: failed to update plugin info in database: %v", err)
		}
	}

	return nil
}

// validatePlugin éªŒè¯æ’ä»¶æ–‡ä»¶
func (ps *PluginService) validatePlugin(path string) error {
	fileInfo, err := os.Stat(path)
	if err != nil {
		return err
	}

	// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œï¼ˆUnixç³»ç»Ÿï¼‰æˆ–æ£€æŸ¥æ‰©å±•åï¼ˆWindowsï¼‰
	if ps.isValidPluginFile(path, fileInfo) {
		return nil
	}

	return fmt.Errorf("invalid plugin file: %s", path)
}

// isValidPluginFile æ£€æŸ¥æ˜¯å¦ä¸ºæœ‰æ•ˆçš„æ’ä»¶æ–‡ä»¶
func (ps *PluginService) isValidPluginFile(path string, info os.FileInfo) bool {
	// è·³è¿‡éšè—æ–‡ä»¶å’Œç›®å½•
	if strings.HasPrefix(filepath.Base(path), ".") {
		return false
	}

	// æ£€æŸ¥æ–‡ä»¶æ‰©å±•å
	validExtensions := []string{".exe", ".so", ".dylib", ".bin", ".plugin"}
	ext := strings.ToLower(filepath.Ext(path))

	for _, validExt := range validExtensions {
		if ext == validExt {
			return true
		}
	}

	// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œï¼ˆUnixç³»ç»Ÿï¼‰
	if info.Mode()&0111 != 0 {
		return true
	}

	return false
}

// GetPluginDir èŽ·å–æ’ä»¶ç›®å½•
func (ps *PluginService) GetPluginDir() string {
	return ps.pluginDir
}

// UpdatePluginMetadata æ›´æ–°æ’ä»¶å…ƒæ•°æ®
func (ps *PluginService) UpdatePluginMetadata(name string, metadata PluginUploadRequest) error {
	query := "UPDATE plugins SET description = ? WHERE name = ?"
	_, err := ps.db.Exec(query, metadata.Description, name)
	if err != nil {
		return fmt.Errorf("failed to update plugin metadata: %w", err)
	}

	return nil
}

// Close å…³é—­æ•°æ®åº“è¿žæŽ¥
func (ps *PluginService) Close() error {
	if ps.db != nil {
		return ps.db.Close()
	}
	return nil
}

================
File: internal/service/plugin/types.go
================
package plugin

import (
	"time"
)

// PluginInfo æ’ä»¶ä¿¡æ¯ç»“æž„
type PluginInfo struct {
	Name        string    `json:"name"`
	Path        string    `json:"path"`
	Size        int64     `json:"size"`
	CreatedAt   time.Time `json:"created_at"`
	ModifiedAt  time.Time `json:"modified_at"`
	Status      string    `json:"status"` // "active", "inactive", "error"
	Description string    `json:"description"`
}

// PluginUploadRequest æ’ä»¶ä¸Šä¼ è¯·æ±‚
type PluginUploadRequest struct {
	Name        string `json:"name"`
	Description string `json:"description"`
}

// PluginResponse æ’ä»¶æ“ä½œå“åº”
type PluginResponse struct {
	Success bool        `json:"success"`
	Message string      `json:"message"`
	Data    interface{} `json:"data,omitempty"`
}

// PluginListResponse æ’ä»¶åˆ—è¡¨å“åº”
type PluginListResponse struct {
	Success bool        `json:"success"`
	Message string      `json:"message"`
	Data    []PluginInfo `json:"data"`
	Total   int64       `json:"total"`
}

// PluginManagerConfig æ’ä»¶ç®¡ç†å™¨é…ç½®
type PluginManagerConfig struct {
	PluginDir string `json:"plugin_dir"`
	MaxSize   int64  `json:"max_size"` // æ’ä»¶æ–‡ä»¶æœ€å¤§å¤§å°ï¼ˆå­—èŠ‚ï¼‰
}

================
File: internal/storage/filter/model.go
================
package filterstore

import (
	"time"
)

type RuleModel struct {
	ID          int64 `gorm:"primaryKey"`
	Name        string
	Description string

	Action    string
	Direction uint8
	Priority  int
	Enabled   bool

	SrcCIDR string // JSON
	DstCIDR string
	SrcPort string
	DstPort string

	Tags string

	UpdatedAt time.Time
}

================
File: internal/storage/filter/repository.go
================
package filterstore

import "context"

type RuleRepository interface {
	List(ctx context.Context) ([]RuleModel, error)
	Save(ctx context.Context, r *RuleModel) error
	Delete(ctx context.Context, id int64) error
}

================
File: internal/storage/filter/sqlite.go
================
package filterstore

import (
	"context"

	"gorm.io/gorm"
)

type SQLiteRepo struct {
	db *gorm.DB
}

func NewSQLiteRepo(db *gorm.DB) *SQLiteRepo {
	return &SQLiteRepo{db: db}
}

func (r *SQLiteRepo) List(ctx context.Context) ([]RuleModel, error) {
	var rules []RuleModel
	err := r.db.WithContext(ctx).
		Order("priority desc").
		Find(&rules).Error
	return rules, err
}

func (r *SQLiteRepo) Save(ctx context.Context, m *RuleModel) error {
	return r.db.WithContext(ctx).Save(m).Error
}

func (r *SQLiteRepo) Delete(ctx context.Context, id int64) error {
	return r.db.WithContext(ctx).
		Delete(&RuleModel{}, id).Error
}

================
File: internal/traffic/context.go
================
package traffic

import (
	"net"
	"time"
)

//
// ===== Direction =====
//

type Direction uint8

const (
	DirectionUnknown Direction = iota // é»˜è®¤ 0 å€¼
	DirectionOut                      // client -> remote
	DirectionIn                       // remote -> client
)

func (d Direction) String() string {
	switch d {
	case DirectionOut:
		return "out"
	case DirectionIn:
		return "in"
	default:
		return "unknown"
	}
}

//
// ===== Protocolï¼ˆä¸ºæœªæ¥é¢„ç•™ï¼Œå…ˆæ”¾å¥½ï¼‰=====
//

type Protocol uint8

const (
	ProtocolUnknown Protocol = iota
	ProtocolTCP
	ProtocolUDP
)

func (p Protocol) String() string {
	switch p {
	case ProtocolTCP:
		return "tcp"
	case ProtocolUDP:
		return "udp"
	default:
		return "unknown"
	}
}

//
// ===== PacketContext =====
//

type PacketContext struct {
	// åŸºç¡€æ ‡è¯†
	ConnID    string    `json:"conn_id"`
	Direction Direction `json:"direction"`
	Protocol  Protocol  `json:"protocol"`

	// åŽŸå§‹åœ°å€ï¼ˆäº‹å®žæ¥æºï¼‰
	SrcAddr net.Addr `json:"src_addr"`
	DstAddr net.Addr `json:"dst_addr"`

	// è§£æžåŽå­—æ®µï¼ˆæ€§èƒ½å‹å¥½ï¼‰
	SrcIP   net.IP `json:"src_ip"`
	SrcPort int    `json:"src_port"`

	DstIP   net.IP `json:"dst_ip"`
	DstPort int    `json:"dst_port"`

	// ç”Ÿå‘½å‘¨æœŸ
	StartAt time.Time `json:"start_at"`

	// å¯é€‰ï¼šå½“å‰ packet payloadï¼ˆfilter / plugin ç”¨ï¼‰
	Payload []byte `json:"payload"`
}

//
// ===== Hook =====
//

type TrafficHook interface {
	// è¿”å›ž false è¡¨ç¤ºä¸­æ–­/ä¸¢å¼ƒ
	OnPacket(ctx *PacketContext) bool
}

//
// ===== Context Factory =====
//

// NewCtx æ˜¯å”¯ä¸€æŽ¨èçš„ PacketContext æž„é€ å…¥å£
func NewCtx(
	connID string,
	dir Direction,
	proto Protocol,
	src, dst net.Addr,
) *PacketContext {

	ctx := &PacketContext{
		ConnID:    connID,
		Direction: dir,
		Protocol:  proto,
		SrcAddr:   src,
		DstAddr:   dst,
		StartAt:   time.Now(),
	}

	fillIPPort(ctx)
	return ctx
}

// client -> remote
func NewOutCtx(connID string, client, remote net.Conn) *PacketContext {
	return NewCtx(
		connID,
		DirectionOut,
		ProtocolTCP,
		safeRemoteAddr(client),
		safeRemoteAddr(remote),
	)
}

// remote -> client
func NewInCtx(connID string, remote, client net.Conn) *PacketContext {
	return NewCtx(
		connID,
		DirectionIn,
		ProtocolTCP,
		safeRemoteAddr(remote),
		safeRemoteAddr(client),
	)
}

//
// ===== helpers =====
//

// æ°¸è¿œè¿”å›ž net.Addrï¼Œä¸è½¬ string
func safeRemoteAddr(c net.Conn) net.Addr {
	if c == nil {
		return nil
	}
	return c.RemoteAddr()
}

// åªåœ¨ Context åˆ›å»ºæ—¶è§£æžä¸€æ¬¡
func fillIPPort(ctx *PacketContext) {
	if tcp, ok := ctx.SrcAddr.(*net.TCPAddr); ok {
		ctx.SrcIP = tcp.IP
		ctx.SrcPort = tcp.Port
	}

	if tcp, ok := ctx.DstAddr.(*net.TCPAddr); ok {
		ctx.DstIP = tcp.IP
		ctx.DstPort = tcp.Port
	}
}

================
File: internal/types/config.go
================
package types

import (
	"fmt"
	"net"
	"time"
)

// ServerConfig shadowsocksæœåŠ¡å™¨é…ç½®
type ServerConfig struct {
	ListenAddr string `json:"listenAddr"`
	Password   string `json:"password"`
	Method     string `json:"method"`
}

// DefaultServerConfig è¿”å›žé»˜è®¤é…ç½®
func DefaultServerConfig() ServerConfig {
	return ServerConfig{
		ListenAddr: ":8388",
		Password:   "test-password",
		Method:     "aes-256-gcm",
	}
}

// ServerStatus shadowsocksæœåŠ¡å™¨çŠ¶æ€
type ServerStatus struct {
	IsRunning  bool      `json:"isRunning"`
	ListenAddr string    `json:"listenAddr"`
	Password   string    `json:"password"`
	Method     string    `json:"method"`
	Uptime     string    `json:"uptime"`
	Clients    int64     `json:"clients"`
	TotalBytes int64     `json:"totalBytes"`
	StartTime  time.Time `json:"startTime"`
}

// Stats æœåŠ¡ç»Ÿè®¡ä¿¡æ¯
type Stats struct {
	TotalRequests int64 `json:"totalRequests"`
	TotalBytes    int64 `json:"totalBytes"`
	ActiveClients int64 `json:"activeClients"`
}

// ServerStats ShadowsocksæœåŠ¡å™¨ç»Ÿè®¡ä¿¡æ¯
type ServerStats struct {
	IsRunning  bool   `json:"isRunning"`
	ListenAddr string `json:"listenAddr"`
	Password   string `json:"password"`
	Method     string `json:"method"`
	Uptime     string `json:"uptime"`
	Clients    int64  `json:"clients"`
	TotalBytes int64  `json:"totalBytes"`
	StartTime  int64  `json:"startTime"`
}

// PacketInfo æ•°æ®åŒ…ä¿¡æ¯
type PacketInfo struct {
	Direction  string    `json:"direction"`
	Data       string    `json:"data"` // åå…­è¿›åˆ¶å­—ç¬¦ä¸²æ ¼å¼
	Length     int       `json:"length"`
	Timestamp  time.Time `json:"timestamp"`
	SourceAddr string    `json:"source_addr"` // æºåœ°å€
	DestAddr   string    `json:"dest_addr"`   // ç›®æ ‡åœ°å€
}

// ShadowSocksEventCallback ShadowSocksæœåŠ¡å™¨äº‹ä»¶å›žè°ƒæŽ¥å£
type ShadowSocksEventCallback interface {
	// OnClientConnected å®¢æˆ·ç«¯è¿žæŽ¥æ—¶è°ƒç”¨
	OnClientConnected()
	// OnClientDisconnected å®¢æˆ·ç«¯æ–­å¼€è¿žæŽ¥æ—¶è°ƒç”¨
	OnClientDisconnected()
	// OnPacketReceived æ”¶åˆ°æ•°æ®åŒ…æ—¶è°ƒç”¨
	OnPacketReceived(direction string, data []byte, length int, sourceAddr, destAddr string)
	// OnProxyConnectionStarted ä»£ç†è¿žæŽ¥å¼€å§‹æ—¶è°ƒç”¨
	OnProxyConnectionStarted(clientID, connectionID string)
	// OnProxyConnectionEnded ä»£ç†è¿žæŽ¥ç»“æŸæ—¶è°ƒç”¨
	OnProxyConnectionEnded(clientID string)
}

// FilterAction è¿‡æ»¤åŠ¨ä½œç±»åž‹
type FilterAction string

const (
	FilterActionAllow FilterAction = "allow" // å…è®¸
	FilterActionDeny  FilterAction = "deny"  // æ‹’ç»
)

// FilterDirection è¿‡æ»¤æ–¹å‘ç±»åž‹
type FilterDirection string

const (
	FilterDirectionIn   FilterDirection = "in"   // ä¸Šè¡Œï¼ˆå®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨ï¼‰
	FilterDirectionOut  FilterDirection = "out"  // ä¸‹è¡Œï¼ˆæœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯ï¼‰
	FilterDirectionBoth FilterDirection = "both" // åŒå‘
)

// IPAddress IPåœ°å€ç»“æž„
type IPAddress struct {
	IP   string `json:"ip"`   // IPåœ°å€
	Mask int    `json:"mask"` // å­ç½‘æŽ©ç ä½æ•°
}

func (a IPAddress) CIDR() (string, error) {
	ip := net.ParseIP(a.IP)
	if ip == nil {
		return "", fmt.Errorf("invalid ip: %s", a.IP)
	}

	// åˆ¤æ–­ IPv4 / IPv6
	var maxMask int
	if ip.To4() != nil {
		maxMask = 32
	} else {
		maxMask = 128
	}

	if a.Mask < 0 || a.Mask > maxMask {
		return "", fmt.Errorf("invalid mask %d for ip %s", a.Mask, a.IP)
	}

	return fmt.Sprintf("%s/%d", ip.String(), a.Mask), nil
}

// PortRange ç«¯å£èŒƒå›´ç»“æž„

// FilterRule è¿‡æ»¤è§„åˆ™ç»“æž„
type FilterRule struct {
	ID        int             `json:"id"`         // è§„åˆ™ID
	Name      string          `json:"name"`       // è§„åˆ™åç§°
	Action    FilterAction    `json:"action"`     // åŠ¨ä½œï¼ˆå…è®¸/æ‹’ç»ï¼‰
	Direction FilterDirection `json:"direction"`  // æ–¹å‘
	SourceIPs []IPAddress     `json:"source_ips"` // æºIPåˆ—è¡¨ï¼ˆç©ºåˆ—è¡¨è¡¨ç¤ºä»»æ„ï¼‰
	//SourcePorts []PortRange     `json:"source_ports"` // æºç«¯å£åˆ—è¡¨ï¼ˆç©ºåˆ—è¡¨è¡¨ç¤ºä»»æ„ï¼‰
	DestIPs []IPAddress `json:"dest_ips"` // ç›®æ ‡IPåˆ—è¡¨ï¼ˆç©ºåˆ—è¡¨è¡¨ç¤ºä»»æ„ï¼‰
	//DestPorts   []PortRange     `json:"dest_ports"`   // ç›®æ ‡ç«¯å£åˆ—è¡¨ï¼ˆç©ºåˆ—è¡¨è¡¨ç¤ºä»»æ„ï¼‰
	Enabled     bool      `json:"enabled"`     // æ˜¯å¦å¯ç”¨
	Priority    int       `json:"priority"`    // ä¼˜å…ˆçº§ï¼ˆæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼‰
	Description string    `json:"description"` // è§„åˆ™æè¿°
	CreatedAt   time.Time `json:"created_at"`
	UpdatedAt   time.Time `json:"updated_at"`
}

// FilterConfig è¿‡æ»¤é…ç½®
type FilterConfig struct {
	Enabled       bool         `json:"enabled"`        // æ˜¯å¦å¯ç”¨è¿‡æ»¤
	DefaultAction FilterAction `json:"default_action"` // é»˜è®¤åŠ¨ä½œ
	Rules         []FilterRule `json:"rules"`          // è§„åˆ™åˆ—è¡¨
	UpdateTime    time.Time    `json:"update_time"`    // æœ€åŽæ›´æ–°æ—¶é—´
}

// FilterStats è¿‡æ»¤ç»Ÿè®¡ä¿¡æ¯
type FilterStats struct {
	TotalPackets   int64     `json:"total_packets"`    // æ€»åŒ…æ•°
	AllowedPackets int64     `json:"allowed_packets"`  // å…è®¸çš„åŒ…æ•°
	BlockedPackets int64     `json:"blocked_packets"`  // é˜»æ­¢çš„åŒ…æ•°
	ActiveRules    int       `json:"active_rules"`     // æ´»è·ƒè§„åˆ™æ•°
	LastUpdateTime time.Time `json:"last_update_time"` // æœ€åŽæ›´æ–°æ—¶é—´
}

================
File: internal/types/plugin.go
================
package types

import (
	"time"
)

// PluginInfo æ’ä»¶ä¿¡æ¯ç»“æž„
type PluginInfo struct {
	Name        string    `json:"name"`
	Path        string    `json:"path"`
	Size        int64     `json:"size"`
	CreatedAt   time.Time `json:"created_at"`
	ModifiedAt  time.Time `json:"modified_at"`
	Status      string    `json:"status"` // "active", "inactive", "error"
	Description string    `json:"description"`
}

// PluginUploadRequest æ’ä»¶ä¸Šä¼ è¯·æ±‚
type PluginUploadRequest struct {
	Name        string `json:"name"`
	Description string `json:"description"`
}

// PluginResponse æ’ä»¶æ“ä½œå“åº”
type PluginResponse struct {
	Success bool        `json:"success"`
	Message string      `json:"message"`
	Data    interface{} `json:"data,omitempty"`
}

// PluginListResponse æ’ä»¶åˆ—è¡¨å“åº”
type PluginListResponse struct {
	Success bool         `json:"success"`
	Message string       `json:"message"`
	Data    []PluginInfo `json:"data"`
	Total   int64        `json:"total"`
}

// PluginManagerConfig æ’ä»¶ç®¡ç†å™¨é…ç½®
type PluginManagerConfig struct {
	PluginDir string `json:"plugin_dir"`
	MaxSize   int64  `json:"max_size"` // æ’ä»¶æ–‡ä»¶æœ€å¤§å¤§å°ï¼ˆå­—èŠ‚ï¼‰
}

================
File: makefile
================
protoc  -I proto  --go_out=.  --go-grpc_out=.   --go_opt=module=proxy-system-backend  --go-grpc_opt=module=proxy-system-backend  proto/*.proto

================
File: plugins/æµ‹è¯•
================
{"time":1765951955567,"is_client":false,"json_data":{"Version":1,"SequenceID":13,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:12:34.9480000_13"}],"Oneway":false}}
{"time":176595195683{"time":1765951957015,"is_client":false,"json_data":{"Version":1,"SequenceID":15,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:12:36.8170000_15"{"time":1765951995426,"is_client":true,"json_data":{"Version":1,"SequenceID":24,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.SfvClient/SetClientDataForActor","Message":{"key":"BBDialogDataList","value":"1001"},"PassThrough":"20439.06:13:15.3700000_24"}],"Oneway":false}}
{"time":1765952009205,"is_client":true,"json_data":{"Version":1,"SequenceID":29,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.SfvClient/SetClientDataForActor","Message"{"time":1765952009346,"is_client":false,"json_data":{"Version":1,"SequenceID":29,"Metadata":{},"Messages":[{"Ur{"time":1765952077352,"is_client":true,"json_data":{"Version":1,"SequenceID":47,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.SfvClient/SetClientDataF{"time":1765952077425,"is_client":true,"json_data":{"Version":1,"SequenceID":48,"Metadata":{"x-gate-version":["1.2"],"x-dev-serve{"time":1765952078497,"is_client":true,"json_data":{"Version":1,"SequenceID":50,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.Bu{"time":1765952078550,"is_client":true,"json_data":{"Version":1,"SequenceID":51,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name"{"time":1765952090241,"is_client":true,"json_data":{"Version":1,"SequenceID":56,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.SfvClient/SetC{"time":1765952090382,"is_client":false,"json_data":{"Version":1,"SequenceID":55,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","M{"time":1765952097267,"is_client":true,"json_d{"time":1765952097470,"is_client":false,"json_data":{"Version":1,"SequenceID":61,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:14:57.1310000_61"}],"Oneway":false}}
{"time":1765952099793,"is_client":false,"json_data":{"Version":1,"SequenceID":65,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:14:59.4760000_65"}],"Oneway":false}}
{"time":1765952102655,"is_client":false,"json_data":{"Version":1,"SequenceID":69,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:15:02.3110000_69"}],"Oneway":false}}
{"time":1765952103986,"is_client":true,"json_data":{"Version":1,"SequenceID":75,"Metadata":{"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"]},"Messages":[{"Uri":"/service.SfvClient/SetClientDataForActor","Message":{"key":"bbdialog102","value":"1","actions":[{"action_type":13,"param":"bbdialog102"},{"action_type":12,"param":"102"}]},"PassThrough":"20439.06:15:03.9730000_75"}],"Oneway":false}}
{"time":1765952114583,"is_client":true,"json_data":{"Version":1,"SequenceID":80,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.SfvClient/SetClientDataForAct{"time":1765952116138,"is_client":false,"json_data":{"Version":1,"SequenceID":83,"Metadata":{},"Messages":[{"Uri":"netutils.Normal{"time":1765952116138,"is_client":false,"json_data":{"Version":1,"SequenceID":
{"time":1765952117827,"is_client":true,"json_data":{"Version":1,"SequenceID":87,"Metadata":{"x-gate-server-type":["game"],"sandwic{"time":1765952117979,"is_client":false,"json_data":{"Version":1,"SequenceID":86,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:15:17.7680000_86"}],"Oneway":false}}
{"time":1765952120447,"is_client":false,"json_data":{"Version":1,"SequenceID":90,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:15:20.1270000_90"}],"Oneway":false}}
{"time":1765952121417,"is_client":false,"json_data":{"Version":1,"SequenceID":93,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:15:21.2010000_93"}],"Oneway":false}}
{"time":1765952125376,"is_client":true,"json_data":{"Version":1,"SequenceID":97,"Metadata":{"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"]},"Messages":[{"Uri":"/service.SfvClient/SetClientDataForActor","Message":{"key":"bbchoose102","value":"1","actions":[{"action_type":13,"param":"bbchoose102"},{"action_type":12,"param":"102"}]},"PassThrough":"20439.06:15:25.3580000_97"}],"Oneway":false}}
{"time":1765952162339,"is_client":true,"json_data":{"Version":1,"SequenceID":107,"Metadata":{"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"]},"Messages":[{"Uri":"/service.GuideService/FinishForActor","Message":{"guideCfgId":"guide_building_well"},"PassThrough":"20439.06:16:02.2200000_107"}],"Oneway":false}}
{"time":1765952179413,"is_client":false,"json_data":{"Version":1,"SequenceID":111,"Metadata":{},"Messages":[{"Uri":"msg.FinishGuideRep","Message":{"guideCfgId":"dialog_main_well_discuss"},"PassThrough":"20439.06:16:19.2440000_111"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.Village","Message":{"uid":60078142,"power_plant":{},"v":12},"PassThrough":""},{"Uri":"dbstate.UserGuide","Message":{"uid":60078142,"attr37":{"dialog_main_well_discuss":true},"v":11},"PassThrough":""},{"Uri":"dbstate.UserFeature","Message":{"uid":60078142,"attr45":{"mainui_worker":true,"bar_gold":false},"v":9},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952183372,"is_client":true,"json_data":{"Version":1,"SequenceID":115,"Metadata":{"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"]},"Messages":[{"Uri":"/service.SfvClient/SetClientDataForActor","Message":{"key":"BBMessageHistory_9998","value":"106"},"PassThrough":"20439.06:16:50.1900000_130"}],"Oneway":false}}
{"time":1765952190610,"is_client":false,"json_data":{"Version":1,"SequenceID":117,"Metadata":{},"Messages":[{"Uri":"msg.AssignWorker2BuildingResp","Message":{"worker_id":1,"building_id":20},"PassThrough":"20439.06:16:30.4580000_117"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserCounter","Message":{"uid":60078142,"attr15":{"187_building_ex_farm":2,"185_wheat":2},"attr32":{"76":13559,"184_wheat":2},"attr41":{"190_wheat":2,"75_1":1,"6_1":2},"v":80},"PassThrough":""},{"Uri":"dbstate.SfvItem","Message":{"uid":60078142,"id":100004,"count":2,"v":2},"PassThrough":""},{"Uri":"dbstate.Worker","Message":{"uid":60078142,"worker_id":2,"v":8},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142,"attr0":{"wheat":{"count":2,"lastAutoGrowTime":1765951944}},"v":24},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952203709,"is_client":false,"json_data":{"Version":1,"SequenceID":126,"Metadata":{},"Messages":[{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserQuestState","Message":{"uid":60078142,"attr16":{"10000":3},"v":42},"PassThrough":""},{"Uri":"dbstate.UserConditions","Message":{"uid":60078142,"attr10":{"1005130":true,"1004506":true,"1004602":true},"attr40":{"1001320":true,"1004344":true},"v":57},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142,"attr0":{"wheat":{"count":9,"lastAutoGrowTime":1765951944}},"v":30},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142,"attr15":{"185_wheat":9,"187_building_ex_farm":2},"attr32":{"76":13759,"184_wheat":9},"attr35":{"3_building_water":1,"2_building_bar01":1,"29_0":2},"attr41":{"6_1":2,"190_wheat":9,"75_1":1},"v":107},"PassThrough":""},{"Uri":"dbstate.UserItem","Message":{"uid":60078142,"itemCfgId":"tomato_100","itemId":9833377,"count":2,"v":1},"PassThrough":""},{"Uri":"dbstate.UserQuest","Message":{"uid":60078142,"questCfgId":10000,"state":3,"v":5},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952210256,"is_client":true,"json_data":{"Version":1,"SequenceID":130,"Metadata":{"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"]},"Messages":[{"Uri":"/service.SfvClient/SetClientDataForActor","Message":{"key":"BBMessageHistory_9998","value":"106"},"PassThrough":"20439.06:16:50.1900000_130"}],"Oneway":false}}
{"time":1765952214949,"is_client":true,"json_data":{"Version":1,"SequenceID":142,"Metadata":{"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"]},"Messages":[{"Uri":"/service.SfvClient/GetClientDataByKeyForActor","Message":{"key":"bbdialog106"},"PassThrough":"20439.06:16:54.8250000_142"}],"Oneway":false}}
{"time":1765952218187,"is_client":true,"json_data":{"Version":1,"SequenceID":146,"Metadata":{"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"]},"Messages":[{"Uri":"/service.SfvClient/SetClientDataForActor","Message":{"key":"bbchoose201","value":"1","actions":[{"action_type":13,"param":"bbchoose201"},{"action_type":12,"param":"201"}]},"PassThrough":"20439.06:16:58.1760000_146"}],"Oneway":false}}
{"time":1765952219214,"is_client":true,"json_data":{"Version":1,"SequenceID":149,"Metadata":{"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"]},"Messages":[{"Uri":"/service.WorkerService/Commit2GranaryForActor","Message":{"worker_id":2},"PassThrough":"20439.06:16:59.1000000_149"}],"Oneway":false}}
{"time":1765952240055,"is_client":true,"json_data":{"Version":1,"SequenceID":157,"Metadata":{"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"]},"Messages":[{"Uri":"/service.BuildingService/BuildingBuildForActor","Message":{"building_id":4},"PassThrough":"20439.06:17:20.0390000_157"}],"Oneway":false}}
{"time":1765952243152,"is_client":false,"json_data":{"Version":1,"SequenceID":160,"Metadata":{},"Messages":[{"Uri":"msg.Placeholder","Message":{},"PassThrough":"20439.06:17:22.7080000_160"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserQuestState","Message":{"uid":60078142,"attr16":{"10000":3},"v":42},"PassThrough":""},{"Uri":"dbstate.UserConditions","Message":{"uid":60078142,"attr10":{"1005130":true,"1004506":true,"1004602":true},"attr40":{"1001320":true,"1004344":true},"v":57},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142,"attr0":{"wheat":{"count":9,"lastAutoGrowTime":1765951944}},"v":30},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142,"attr15":{"185_wheat":9,"187_building_ex_farm":2},"attr32":{"76":13759,"184_wheat":9},"attr35":{"3_building_water":1,"2_building_bar01":1,"29_0":2},"attr41":{"6_1":2,"190_wheat":9,"75_1":1},"v":114},"PassThrough":""},{"Uri":"dbstate.UserItem","Message":{"uid":60078142,"itemCfgId":"tomato_100","itemId":9833377,"count":4,"v":2},"PassThrough":""},{"Uri":"dbstate.UserQuest","Message":{"uid":60078142,"questCfgId":10000,"state":3,"v":5},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952245643,"is_client":false,"json_data":{"Version":1,"SequenceID":164,"Metadata":{},"Messages":[{"Uri":"msg.Placeholder","Message":{},"PassThrough":"20439.06:17:25.4360000_164"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserItem","Message":{"uid":60078142,"itemCfgId":"tomato_100","itemId":9833377,"count":10,"v":3},"PassThrough":""},{"Uri":"dbstate.UserQuest","Message":{"uid":60078142,"questCfgId":10001,"state":3,"v":5},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142,"attr0":{"wheat":{"count":15,"lastAutoGrowTime":1765951944}},"v":32},"PassThrough":""},{"Uri":"dbstate.UserQuestState","Message":{"uid":60078142,"attr17":{"10001":3},"v":44},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142,"attr15":{"185_wheat":15,"187_building_ex_farm":2},"attr32":{"76":13759,"184_wheat":15},"attr35":{"75_201":1,"3_building_water":1,"2_building_bar01":1,"29_0":2},"attr41":{"6_1":2,"190_wheat":15,"75_1":1},"v":121},"PassThrough":""},{"Uri":"dbstate.UserConditions","Message":{"uid":60078142,"attr1":{"1004641":true},"v":60},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952247319,"is_client":true,"json_d{"time":1765952247420,"is_client":false,"json_data":{"Version":1,"SequenceID":167,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:17:27.1240000_167"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.FarmLand","Message":{"uid":60078142,"crop_id":13,"item_id":100004,"health":100,"is_mature":true,"v":4},"PassThrou{"time":1765952251589,"is_client":false,"json{"time":1765952252389,"is_client":false,"json_data":{"Version":1,"SequenceID":174,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:17:32.1220000_174"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.Worker","Message":{"uid":60078142,"worker_id":1,"carry_value":4,"carry_item_id":100004,"v":25},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952273090,"is_client":false,"json_data":{"Version":1,"SequenceID":183,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:17:52.9280000_183"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserQuest","Message":{"uid":60078142,"questCfgId":10040,"state":2,"v":4},"PassThrough":""},{"Uri":"dbstate.UserBuilding","Message":{"uid":60078142,"buildingId":4,"items_level":{"1401":1,"1409":1,"1412":1,"1404":1,"1407":1,"1408":1,"1411":1,"1405":1,"{"time":1765952273782,"is_client":true,"json_data":{"Version":1,"SequenceID":184,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.WorkerService/Commit2GranaryForActor","Message":{"worker_id":2},"PassThrough":"20439.06:17:53.6470000_184"}],"Oneway":false}}
{"time":1765952292579,"is_client":false,"json_data":{"Version":1,"SequenceID":193,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:18:12.0500000_193"}],"Oneway":false}}
{"time":1765952297306,"is_client":false,"json_data":{"Version":1,"SequenceID":196,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:18:16.9690000_196"}],"Oneway":false}}
{"time":1765952298727,"is_client":true,"json_data":{"Version":1,"SequenceID":201,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.SfvClient/SetClientDataForActor","Message":{"key":"ImportantOrderList"},"PassThrough":"20439.06:18:18.7130000_201"}],"Oneway":false}}
{"time":1765952300934,"is_client":false,"json_data":{"Version":1,"SequenceID":205,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:18:20.7350000_205"}],"Oneway":false}}
{"time":1765952302442,"is_client":false,"json_data":{"Version":1,"SequenceID":208,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:18:22.1020000_208"}],"Oneway":false}}
{"time":1765952304342,"is_client":false,"json_data":{"Version":1,"SequenceID":211,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:18:24.0740000_211"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.Worker","Message":{"uid":60078142,"worker_id":1,"carry_value":16,"carry_item_id":100004,"v":45},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952306911,"is_client":false,"json_data":{"Version":1,"SequenceID":216,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:18:26.6440000_216"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.SfvItem","Message":{"uid":60078142,"id":100001,"count":112,"v":17},"PassThrough":""},{"Uri":"dbstate.Worker","Message":{"uid":60078142,"worker_id":1,"v":48},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142,"attr15":{"187_building_ex_farm":2,"185_wheat":395},"attr41":{"75_1":1,"6_1":2,"190_wheat":55},"v":159},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142,"attr0":{"wheat":{"count":55,"lastAutoGrowTime":1765951944}},"v":49},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952309111,"is_client":true,"json_data":{"Version":1,"SequenceID":220,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.SfvClient/SetClientDataForActor","Message":{"key":"bbpager_sfv_mbti","value":"12;3;12;17;0;0"},"PassThrough":"20439.06:18:28.9290000_220"}],"Oneway":false}}
{"time":1765952309481,"is_client":false,"json_data":{"Version":1,"SequenceID":222,"Metadata":{},"Messages":[{"Uri":"msg.FinishGuideRep","Message":{"guideCfgId":"bbj_dialog_107"},"PassThrough":"20439.06:18:29.0680000_222"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserGuide","Message":{"uid":60078142,"attr39":{"bbj_dialog_107":true},"v":22},"PassThrough":""},{"Uri":"dbstate.Village","Message":{"uid":60078142,"power_plant":{},"v":23},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952310661,"is_client":false,"json_data":{"Version":1,"SequenceID":226,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:18:30.3560000_226"}],"Oneway":false}}
{"time":1765952320291,"is_client":false,"json_data":{"Version":1,"SequenceID":231,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:18:40.0800000_231"}],"Oneway":false}}
{"time":1765952320517,"is_client":false,"json_data":{"Version":1,"SequenceID":236,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:18:40.3270000_236"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserConditions","Message":{"uid":60078142,"attr20":{"1004996":true,"1005140":true,"1004516":true},"v":69},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952322039,"is_client":false,"json_data":{"Version":1,"SequenceID":237,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:18:41.4840000_237"}],"Oneway":false}}
{"time":1765952323065,"is_client":true,"json_data":{"Version":1,"SequenceID":242,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.WorkerService/HarvestCropForActor","Message":{"worker_id":2,"crops_idx":21},"PassThrough":"20439.06:18:42.9430000_242"}],"Oneway":false}}
{"time":1765952325032,"is_client":true,"json_data":{"Version":1,"SequenceID":246,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.SfvClient/SetClientDataForActor","Message":{"key":"bbpager_sfv_mbti","value":"12;3;12;17;0;0"},"PassThrough":"20439.06:18:44.8660000_246"}],"Oneway":false}}
{"time":1765952327152,"is_client":false,"json_data":{"Version":1,"SequenceID":251,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:18:46.8070000_251"}],"Oneway":false}}
{"time":1765952328944,"is_client":true,"json_data":{"Version":1,"SequenceID":255,"Metadata":{"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"]},"Messages":[{"Uri":"/service.SfvClient/SetClientDataForActor","Message":{"key":"bbpager_sfv_mbti","value":"12;15;12;17;0;0"},"PassThrough":"20439.06:18:48.8840000_255"}],"Oneway":false}}
{"time":1765952333200,"is_client":true,"json_data":{"Version":1,"SequenceID":258,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.WorkerService/Commit2GranaryForActor","Message":{"worker_id":1},"PassThrough":"20439.06:18:53.0940000_258"}],"Oneway":false}}
{"time":1765952344236,"is_client":true,"json_data":{"Version":1,"SequenceID":265,"Metadata":{"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"]},"Messages":[{"Uri":"/service.GuideService/FinishForActor","Message":{"guideCfgId":"guide_upgrade_farm_finish"},"PassThrough":"20439.06:19:04.1560000_265"}],"Oneway":false}}
{"time":1765952360726,"is_client":true,"json_data":{"Version":1,"SequenceID":272,"Metadata":{"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"]},"Messages":[{"Uri":"/service.SfvClient/SetClientDataForActor","Message":{"key":"BBDialogDataList","value":"1001,1002,1003"},"PassThrough":"20439.06:19:20.6680000_272"}],"Oneway":false}}
{"time":1765952364813,"is_client":false,"json_data":{"Version":1,"SequenceID":273,"Metadata":{},"Messages":[{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.Worker","Message":{"uid":60078142,"worker_id":2,"carry_value":16,"carry_item_id":100004,"v":65},"PassThrough":""},{"Uri":"dbstate.SfvItem","Message":{"uid":60078142,"id":100001,"count":3,"v":3},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142,"attr3":{"gold":{"count":22,"lastAutoGrowTime":1765951944},"tomato":{"lastAutoGrowTime":1765951944}},"v":62},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142,"attr2":{"185_gold":103},"attr20":{"76":15221,"184_wheat":1609,"65_building_residential01_1":1},"attr41":{"190_wheat":669,"75_1":1,"6_1":2},"v":201},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952368152,"is_client":true,"json_data":{"Version":1,"SequenceID":279,"Metadata":{"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"]},"Messages":[{"Uri":"/service.SfvClient/SetClientDataForActor","Message":{"key":"bbpager_sfv_mbti","value":"12;3;12;17;0;0"},"PassThrough":"20439.06:19:27.6790000_279"}],"Oneway":false}}
{"time":1765952680359,"is_client":false,"json_data":{"Version":1,"SequenceID":546,"Metadata":{},"Messages":[{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserResource","Message":{"uid":60078142,"attr0":{"wheat":{"count":669,"lastAutoGrowTime":1765951944}},"v":215},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142,"attr15":{"186_1201":2,"187_building_ex_farm":3,"185_wheat":3409,"65_building_residential01_1":1},"attr32":{"184_wheat":669,"76":15221},"attr41":{"75_1":1,"6_1":2,"190_wheat":669},"v":597},"PassThrough":""},{"Uri":"dbstate.SfvItem","Message":{"uid":60078142,"id":100004,"count":1916,"v":66},"PassThrough":""},{"Uri":"dbstate.Worker","Message":{"uid":60078142,"worker_id":2,"v":154},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952683754,"is_client":true,"json_data":{"Version":1,"SequenceID":549,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.WorkerService/HarvestCropForActor","Message":{"worker_id":1,"crops_idx":11},"PassThrough":"20439.06:24:43.6170000_549"}],"Oneway":false}}
{"time":1765952684552,"is_client":true,"json_data":{"Version":1,"SequenceID":553,"Metadata":{"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"]},"Messages":[{"Uri":"/service.SfvClient/SetClientDataForActor","Message":{"key":"bbpager_sfv_mbti","value":"12;15;12;17;0;0"},"PassThrough":"20439.06:24:44.4880000_553"}],"Oneway":false}}
{"time":1765952687268,"is_client":true,"json_data":{"Version":1,"SequenceID":558,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.SfvClient/SetClientDataForActor","Message":{"key":"bbpager_sfv_mbti","value":"12;15;12;17;0;0"},"PassThrough":"20439.06:24:47.0890000_558"}],"Oneway":false}}
{"time":1765952687645,"is_client":false,"json_data":{"Version":1,"SequenceID":560,"Metadata":{},"Messages":[{"Uri":"msg.FinishGuideRep","Message":{"guideCfgId":"bbj_dialog_121"},"PassThrough":"20439.06:24:47.2340000_560"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.Village","Message":{"uid":60078142,"power_plant":{},"v":52},"PassThrough":""},{"Uri":"dbstate.UserConditions","Message":{"uid":60078142,"attr23":{"1004615":true,"1005527":true,"1004567":true},"v":110},"PassThrough":""},{"Uri":"dbstate.UserGuide","Message":{"uid":60078142,"attr15":{"bbj_dialog_121":true},"v":41},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952693130,"is_client":false,"json_data":{"Version":1,"SequenceID":569,"Metadata":{},"Messages":[{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserConditions","Message":{"uid":60078142,"attr6":{"1004646":true,"1001526":true,"1005126":true},"attr14":{"1005134":true,"1000622":true,"1004510":true,"1003694":true},"v":114},"PassThrough":""},{"Uri":"dbstate.UserFeature","Message":{"uid":60078142","attr30":{"mainui_system":true,"hero_initial":false,"building_wall":false,"res_bar_tomato":true,"building_residential06":false,"radar_one_click_execution":false,"80_age_show_road":false},"attr44":{"fairy_road_ranking":false,"mainui_res_cell":true,"new_villager_5":true,"money_produce":true,"idle_order":false},"v":260},"PassThrough":""},{"Uri":"dbstate.Benefits","Message":{"uid":60078142","attr":{"102000":{"entries":{"3":200,"11":6,"4":5,"17":1,"18":2,"19":0,"2":1,"16":3,"15":155,"12":4,"1":15}},"100200":{"entries":{"1":22,"18":1,"2":15}}},"v":93},"PassThrough":""},{"Uri":"dbstate.UserBenefits","Message":{"uid":60078142","seq":15,"dict":{"user_building:uid:60078142:buildingId:7":13,"user_building:uid:60078142:buildingId:15":2,"user_building:uid:60078142:buildingId:19":4,"user_building:uid:60078142:buildingId:20":5,"user_building:uid:60078142:buildingId:2":15,"survivor:uid:60078142:cfgId:3000031":7,"user_building:uid:60078142:buildingId:18":3,"user_soldier:uid:60078142":9,"user_building:uid:60078142:buildingId:31240228":12,"user_building:uid:60078142:buildingId:16":1,"user_building:uid:60078142:buildingId:44":10,"user_building:uid:60078142:buildingId:22":14,"user_building:uid:60078142:buildingId:23":6,"user_building:uid:60078142:buildingId:4":11,"survivor:uid:60078142:cfgId:3000030":8},"attr17":{"90017":{"entries":{"15":15}}},"attr18":{"90018":{"entries":{"15":22}}},"attr19":{"90019":{"entries":{"15":1}}},"attr25":{"3001":{"entries":{"4":600,"3":600,"1":600,"13":100,"9":2400,"8":3960.7500374913216,"5":600,"7":3960.7500374913216,"15":100,"6":100,"11":300,"10":600,"14":100,"12":900,"2":600}}},"v":105},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142","attr7":{"184_diamond":305,"2_building_sfv_kitchen":1,"28":21},"attr17":{"48":1,"3_building_transport":1},"attr26":{"65_building_granary_1":1,"64_building_transport_1":2},"attr32":{"76":15521,"184_wheat":1269},"attr33":{"17":5,"3_building_base":1,"4_building_sfv_kitchen":1,"186_1702":2,"64_building_well_1":2},"attr43":{"65_building_transport_1":1},"attr44":{"4_building_tent":1,"4_building_water":1,"65_building_bar01_1":1,"4_building_base":1,"2_building_transport":1},"v":616},"PassThrough":""},{"Uri":"dbstate.UserQuest","Message":{"uid":60078142","questCfgId":10161,"state":2,"v":4},"PassThrough":""},{"Uri":"dbstate.UserQuestState","Message":{"uid":60078142","attr33":{"212385":0,"211905":0,"212865":0,"19905":1,"212145":0,"10161":2,"11361":1,"211185":0,"211425":0,"212625":0,"211665":0},"v":691},"PassThrough":""},{"Uri":"dbstate.User","Message":{"uid":60078142","combatPower":15521,"v":18},"PassThrough":""},{"Uri":"dbstate.UserBuilding","Message":{"uid":60078142","buildingId":2,"level":1,"items_level":{"1202":1,"1203":1,"1201":1},"v":6},"PassThrough":""},{"Uri":"dbstate.UserJob","Message":{"uid":60078142","jobId":32225238},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952697295,"is_client":false,"json_data":{"Version":1,"SequenceID":569,"Metadata":{},"Messages":[{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserCounter","Message":{"uid":60078142","attr3":{"186_1403":5,"65_building_base_1":1,"64_building_residential02_1":1,"65_building_tent_1":1,"2_building_river":1,"2_building_ex_farm":1,"64_building_granary_1":1},"attr7":{"28":22,"184_diamond":305,"2_building_sfv_kitchen":1},"attr11":{"4_building_residential02":1},"attr41":{"75_1":1,"6_1":2,"190_wheat":619},"v":624},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142","attr0":{"wheat":{"count":619,"lastAutoGrowTime":1765951944}},"v":223},"PassThrough":""},{"Uri":"dbstate.UserBuilding","Message":{"uid":60078142","buildingId":8,"typeId":2000052,"Position":{},"state":1,"building_max_index":1,"v":2},"PassThrough":""},{"Uri":"dbstate.UserJob","Message":{"uid":60078142","jobId":32225312,"category":1,"trigger_time":1765952707,"uriDetails":"msg.UserBuildingUpgradingDetails","rawDetails":"CL7w0hwQCA==","createTime":1765952706,"v":4},"PassThrough":""},{"Uri":"dbstate.UserConditions","Message":{"uid":60078142","attr7":{"1005655":true,"1003879":true,"1005127":true},"v":115},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952703083,"is_client":true,"json_data":{"Version":1,"SequenceID":574,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.QuestService/SubmitQuestForActor","Message":{"QuestId":10150},"PassThrough":"20439.06:25:03.0700000_574"}],"Oneway":false}}
{"time":1765952705299,"is_client":true,"json_data":{"Version":1,"SequenceID":578,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.QuestService/SubmitQuestForActor","Message":{"QuestId":10161},"PassThrough":"20439.06:25:05.2900000_578"}],"Oneway":false}}
{"time":1765952709854,"is_client":true,"json_data":{"Version":1,"SequenceID":582,"Metadata":{"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"]},"Messages":[{"Uri":"/service.WorkerService/HarvestCropForActor","Message":{"worker_id":2,"crops_idx":21},"PassThrough":"20439.06:25:09.7160000_582"}],"Oneway":false}}
{"time":1765952713329,"is_client":false,"json_data":{"Version":1,"SequenceID":585,"Metadata":{},"Messages":[{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserResource","Message":{"uid":60078142","attr0":{"wheat":{"count":869,"lastAutoGrowTime":1765951944}},"v":242},"PassThrough":""},{"Uri":"dbstate.SfvItem","Message":{"uid":60078142","id":100004,"count":2116,"v":70},"PassThrough":""},{"Uri":"dbstate.Worker","Message":{"uid":60078142","worker_id":3,"v":68},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142","attr15":{"187_building_ex_farm":3,"185_wheat":4159,"65_building_residential01_1":1},"attr41":{"75_1":1,"6_1":2,"190_wheat":869},"v":682},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952723173,"is_client":true,"json_data":{"Version":1,"SequenceID":591,"Metadata":{"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"]},"Messages":[{"Uri":"/service.WorkerService/HarvestCropForActor","Message":{"worker_id":1,"crops_idx":11},"PassThrough":"20439.06:25:23.0560000_591"}],"Oneway":false}}
{"time":1765952734190,"is_client":true,"json_data":{"Version":1,"SequenceID":596,"Metadata":{"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"]},"Messages":[{"Uri":"/service.VillageService/KitchenProduceFinishForActor","Message":{"stove_id":1},"PassThrough":"20439.06:25:34.0580000_596"}],"Oneway":false}}
{"time":1765952743106,"is_client":false,"json_data":{"Version":1,"SequenceID":602,"Metadata":{},"Messages":[{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.Worker","Message":{"uid":60078142","worker_id":1,"carry_value":25,"carry_item_id":100004,"v":179},"PassThrough":""},{"Uri":"dbstate.SfvItem","Message":{"uid":60078142","id":100001,"count":1132,"v":92},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142","attr2":{"185_gold":1982,"64_building_residential01_1":2},"attr20":{"13_hero_1002":0,"190_gold":991,"64_building_base_1":1,"184_wheat":2},"attr35":{"29_0":23,"184_gold":991,"184_tomato":1,"75_201":1,"3_building_water":1,"2_building_bar01":1},"v":726},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142","attr3":{"gold":{"count":991,"lastAutoGrowTime":1765951944},"tomato":{"count":1,"lastAutoGrowTime":1765951944}},"v":259},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952754327,"is_client":false,"json_data":{"Version":1,"SequenceID":607,"Metadata":{},"Messages":[{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserCounter","Message":{"uid":60078142","attr15":{"187_building_ex_farm":3,"185_wheat":4509,"65_building_residential01_1":1},"attr41":{"75_1":1,"6_1":2,"190_wheat":1189},"v":738},"PassThrough":""},{"Uri":"dbstate.Worker","Message":{"uid":60078142","worker_id":1,"v":183},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142","attr0":{"wheat":{"count":1189,"lastAutoGrowTime":1765951944}},"v":264},"PassThrough":""},{"Uri":"dbstate.SfvItem","Message":{"uid":60078142","id":100004,"count":2416,"v":76},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952757724,"is_client":true,"json_data":{"Version":1,"SequenceID":609,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.WorkerService/HarvestCropForActor","Message":{"worker_id":2,"crops_idx":22},"PassThrough":"20439.06:25:57.6010000_609"}],"Oneway":false}}
{"time":1765952763034,"is_client":false,"json_data":{"Version":1,"SequenceID":612,"Metadata":{},"Messages":[{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.Village","Message":{"uid":60078142","kitchen":{"stoves":{"1":{"start_ts":1765952769,"end_ts":1765952785,"value":1}},"StorageCount":15},"v":63},"PassThrough":""},{"Uri":"dbstate.Worker","Message":{"uid":60078142","worker_id":5,"v":13},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952778992,"is_client":true,"json_data":{"Version":1,"SequenceID":620,"Metadata":{"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"]},"Messages":[{"Uri":"/service.WorkerService/HarvestCropForActor","Message":{"worker_id":2,"crops_idx":22},"PassThrough":"20439.06:26:18.8620000_620"}],"Oneway":false}}
{"time":1765952783570,"is_client":false,"json_data":{"Version":1,"SequenceID":622,"Metadata":{},"Messages":[{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.SfvItem","Message":{"uid":60078142","id":100001,"count":1332,"v":105},"PassThrough":""},{"Uri":"dbstate.Worker","Message":{"uid":60078142","worker_id":3,"carry_value":50,"carry_item_id":100004,"v":83},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142","attr2":{"185_gold":2182,"64_building_residential01_1":2},"attr20":{"64_building_base_1":1,"13_hero_1002":0,"190_gold":1191,"184_tomato":2},"attr35":{"29_0":23,"184_gold":1191,"184_tomato":2,"75_201":1,"3_building_water":1,"2_building_bar01":1},"v":780},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142","attr3":{"gold":{"count":1191,"lastAutoGrowTime":1765951944},"tomato":{"count":2,"lastAutoGrowTime":1765951944}},"v":279},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952803159,"is_client":false,"json_data":{"Version":1,"SequenceID":632,"Metadata":{},"Messages":[{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserCounter","Message":{"uid":60078142","attr2":{"185_gold":2277,"64_building_residential01_1":2},"attr20":{"190_gold":1286,"64_building_base_1":1,"184_steel":43,"13_hero_1002":0},"attr35":{"3_building_water":1,"2_building_bar01":1,"29_0":26,"184_gold":1286,"184_tomato":73,"185_steel":50,"2_building_brick_kiln":1,"75_201":1},"v":810},"PassThrough":""},{"Uri":"dbstate.Worker","Message":{"uid":60078142","worker_id":3,"carry_value":50,"carry_item_id":100004,"v":89},"PassThrough":""},{"Uri":"dbstate.SfvItem","Message":{"uid":60078142","id":100001,"count":1427,"v":111},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142","attr3":{"gold":{"count":1286,"lastAutoGrowTime":1765951944},"tomato":{"count":73,"lastAutoGrowTime":1765951944}},"v":289},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952805175,"is_client":true,"json_data":{"Version":1,"SequenceID":636,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.QuestService/SubmitQuestForActor","Message":{"QuestId":10220},"PassThrough":"20439.06:26:45.1680000_636"}],"Oneway":false}}
{"time":1765952809803,"is_client":false,"json_data":{"Version":1,"SequenceID":640,"Metadata":{},"Messages":[{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserResource","Message":{"uid":60078142","attr3":{"gold":{"count":1316,"lastAutoGrowTime":1765951944},"tomato":{"count":9,"lastAutoGrowTime":1765951944}},"attr7":{"diamond":{"count":350,"lastAutoGrowTime":1765951944}},"v":297},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142","attr2":{"185_gold":2307,"64_building_residential01_1":2},"attr7":{"28":31,"184_diamond":350,"2_building_sfv_kitchen":1,"64_building_transport_2":2},"attr8":{"65_building_river_1":1,"65_building_terra_1":1,"64_building_bar02_1":1,"3_building_farm":2,"185_diamond":345,"187_building_transport":1},"attr16":{"29_1":7,"186_3202":2,"65_building_sfv_kitchen_1":1},"attr20":{"64_building_base_1":1,"184_steel":47,"13_hero_1002":0,"190_gold":1316},"attr22":{"3_building_river":1,"190_diamond":350,"185_tomato":162},"attr35":{"3_building_water":1,"2_building_bar01":1,"29_0":34,"184_gold":1316,"184_tomato":143,"185_steel":54,"2_building_brick_kiln":1,"75_201":1},"v":834},"PassThrough":""},{"Uri":"dbstate.UserConditions","Message":{"uid":60078142","attr30":{"1004190":true,"1005054":true,"1004622":true,"1005198":true},"v":130},"PassThrough":""},{"Uri":"dbstate.UserQuestState","Message":{"uid":60078142","attr34":{"211090":0,"20770":1,"211570":0,"211810":0,"10210":3,"11362":1,"19906":1,"212290":0,"211330":0,"212050":0,"212530":0},"v":710},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952813460,"is_client":true,"json_data":{"Version":1,"SequenceID":644,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.WorkerService/Commit2GranaryForActor","Message":{"worker_id":1},"PassThrough":"20439.06:26:53.2940000_644"}],"Oneway":false}}
{"time":1765952814244,"is_client":false,"json_data":{"Version":1,"SequenceID":647,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:26:53.8840000_647"}],"Oneway":false}}
{"time":1765952817885,"is_client":false,"json_data":{"Version":1,"SequenceID":650,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:26:57.3270000_650"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.Worker","Message":{"uid":60078142","worker_id":3,"v":92},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142","attr0":{"wheat":{"count":1609,"lastAutoGrowTime":1765951944}},"v":302},"PassThrough":""},{"Uri":"dbstate.SfvItem","Message":{"uid":60078142","id":100004,"count":2866,"v":85},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142","attr15":{"187_building_ex_farm":3,"185_wheat":4959,"65_building_residential01_1":1},"attr32":{"76":15621,"184_wheat":1609,"3_building_brick_kiln":1},"attr41":{"75_1":1,"6_1":2,"190_wheat":1609},"v":849},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952819065,"is_client":true,"json_data":{"Version":1,"SequenceID":654,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.SfvClient/GetClientDataByKeyForActor","Message":{"key":"bbdialog116"},"PassThrough":"20439.06:26:58.9120000_654"}],"Oneway":false}}
{"time":1765952828600,"is_client":false,"json_data":{"Version":1,"SequenceID":662,"Metadata":{},"Messages":[{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserQuest","Message":{"uid":60078142","questCfgId":10210,"state":3,"v":5},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142","attr2":{"185_gold":2487,"64_building_residential01_1":2},"attr7":{"28":33,"184_diamond":395,"2_building_sfv_kitchen":1,"64_building_transport_2":2},"attr8":{"65_building_river_1":1,"65_building_terra_1":1,"64_building_bar02_1":1,"3_building_farm":2,"185_diamond":400,"187_building_transport":1},"attr22":{"3_building_river":1,"190_diamond":395,"185_tomato":242},"attr35":{"184_tomato":143,"185_steel":173,"2_building_brick_kiln":1,"75_201":1,"3_building_water":1,"2_building_bar01":1,"29_0":35,"184_gold":1816},"attr40":{"65_building_ex_farm_1":1,"4_building_bar02":1,"64_building_farm_2":2,"190_tomato":156},"v":874},"PassThrough":""},{"Uri":"dbstate.UserConditions","Message":{"uid":60078142","attr30":{"1004190":true,"1005054":true,"1004622":true,"1005198":true},"v":130},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142","attr3":{"tomato":{"count":20,"lastAutoGrowTime":1765951944},"gold":{"count":1816,"lastAutoGrowTime":1765951944}},"attr7":{"diamond":{"count":395,"lastAutoGrowTime":1765951944}},"v":310},"PassThrough":""},{"Uri":"dbstate.UserQuestState","Message":{"uid":60078142","attr34":{"211090":0,"20770":1,"211570":0,"211810":0,"10210":3,"11362":1,"19906":1,"212290":0,"211330":0,"212050":0,"212530":0},"v":747},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952833892,"is_client":true,"json_data":{"Version":1,"SequenceID":667,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.BuildingService/BuildingUpgradeItemForActor","Message":{"building_id":22,"building_item_id":3204},"PassThrough":"20439.06:27:13.8800000_667"}],"Oneway":false}}
{"time":1765952842695,"is_client":false,"json_data":{"Version":1,"SequenceID":673,"Metadata":{},"Messages":[{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserResource","Message":{"uid":60078142","attr3":{"tomato":{"count":16,"lastAutoGrowTime":1765951944},"gold":{"count":1416,"lastAutoGrowTime":1765951944}},"v":323},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142","attr2":{"185_gold":2772,"64_building_residential01_1":2},"attr20":{"13_hero_1002":0,"190_gold":1416,"64_building_base_1":1,"184_steel":147},"attr35":{"75_201":1,"3_building_water":1,"2_building_bar01":1,"29_0":40,"184_gold":1416,"184_tomato":156,"185_steel":209},"v":906},"PassThrough":""},{"Uri":"dbstate.Worker","Message":{"uid":60078142","worker_id":1,"carry_value":25,"carry_item_id":100004,"v":209},"PassThrough":""},{"Uri":"dbstate.SfvItem","Message":{"uid":60078142","id":100001,"count":1637,"v":124},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952849086,"is_client":true,"json_data":{"Version":1,"SequenceID":677,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.WorkerService/HarvestCropForActor","Message":{"worker_id":1,"crops_idx":12},"PassThrough":"20439.06:27:28.9620000_677"}],"Oneway":false}}
{"time":1765952853659,"is_client":true,"json_data":{"Version":1,"SequenceID":678,"Metadata":{"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"]},"Messages":[{"Uri":"/service.WorkerService/Commit2GranaryForActor","Message":{"worker_id":1},"PassThrough":"20439.06:27:33.5310000_678"}],"Oneway":false}}
{"time":1765952856531,"is_client":true,"json_data":{"Version":1,"SequenceID":682,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.WorkerService/HarvestCropForActor","Message":{"worker_id":2,"crops_idx":21},"PassThrough":"20439.06:27:36.3930000_682"}],"Oneway":false}}
{"time":1765952859744,"is_client":false,"json_data":{"Version":1,"SequenceID":685,"Metadata":{},"Messages":[{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserCounter","Message":{"uid":60078142","attr41":{"6_1":2,"190_wheat":1829,"75_1":1},"v":950},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142","attr0":{"wheat":{"count":1829,"lastAutoGrowTime":1765951944}},"v":336},"PassThrough":""},{"Uri":"dbstate.Worker","Message":{"uid":60078142","worker_id":5,"carry_value":15,"carry_item_id":100004,"v":30},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952862815,"is_client":false,"json_data":{"Version":1,"SequenceID":688,"Metadata":{},"Messages":[{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.Worker","Message":{"uid":60078142","worker_id":1,"carry_value":25,"carry_item_id":100004,"v":215},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142","attr2":{"185_gold":2877,"64_building_residential01_1":2},"attr20":{"64_building_base_1":1,"184_steel":147,"13_hero_1002":0,"190_gold":1701},"attr35":{"29_0":26,"184_gold":1701,"184_tomato":143,"185_steel":221,"2_building_brick_kiln":1,"75_201":1,"3_building_water":1,"2_building_bar01":1},"v":961},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142","attr3":{"gold":{"count":1701,"lastAutoGrowTime":1765951944},"tomato":{"count":31,"lastAutoGrowTime":1765951944}},"v":340},"PassThrough":""},{"Uri":"dbstate.SfvItem","Message":{"uid":60078142","id":100001,"count":1722,"v":129},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952874156,"is_client":false,"json_data":{"Version":1,"SequenceID":696,"Metadata":{},"Messages":[{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserResource","Message":{"uid":60078142","attr0":{"wheat":{"count":1979,"lastAutoGrowTime":1765951944}},"v":348},"PassThrough":""},{"Uri":"dbstate.Worker","Message":{"uid":60078142","worker_id":1,"v":219},"PassThrough":""},{"Uri":"dbstate.SfvItem","Message":{"uid":60078142","id":100004,"count":3266,"v":93},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142","attr15":{"186_1201":4,"187_building_ex_farm":3,"185_wheat":5359,"65_building_residential01_1":1},"attr32":{"184_wheat":1979,"76":15721},"attr41":{"75_1":1,"6_1":2,"190_wheat":1979},"v":983},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952882580,"is_client":true,"json_data":{"Version":1,"SequenceID":700,"Metadata":{"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"]},"Messages":[{"Uri":"/service.WorkerService/HarvestCropForActor","Message":{"worker_id":1,"crops_idx":11},"PassThrough":"20439.06:28:02.4260000_700"}],"Oneway":false}}
{"time":1765952884845,"is_client":false,"json_data":{"Version":1,"SequenceID":702,"Metadata":{},"Messages":[{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserCounter","Message":{"uid":60078142","attr2":{"185_gold":3212,"64_building_residential01_1":2},"attr20":{"13_hero_1002":0,"190_gold":1791,"64_building_base_1":1,"184_steel":147},"attr35":{"29_0":25,"184_gold":1791,"184_tomato":55,"185_steel":197,"2_building_brick_kiln":1,"75_201":1,"3_building_water":1,"2_building_bar01":1},"v":1060},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142","attr3":{"gold":{"count":1791,"lastAutoGrowTime":1765951944},"tomato":{"count":55,"lastAutoGrowTime":1765951944}},"v":354},"PassThrough":""},{"Uri":"dbstate.Worker","Message":{"uid":60078142","worker_id":2,"carry_value":50,"v":211},"PassThrough":""},{"Uri":"dbstate.SfvItem","Message":{"uid":60078142","id":100001,"count":1912,"v":141},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952887509,"is_client":false,"json_data":{"Version":1,"SequenceID":707,"Metadata":{},"Messages":[{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.Worker","Message":{"uid":60078142","worker_id":5,"carry_value":140,"carry_item_id":100004,"v":35},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142","attr0":{"wheat":{"count":1839,"lastAutoGrowTime":1765951944}},"v":360},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142","attr41":{"75_1":1,"6_1":2,"190_wheat":1839,"64_building_residential02_3":2},"v":1014},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952889788,"is_client":true,"json_data":{"Version":1,"SequenceID":711,"Metadata":{"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"]},"Messages":[{"Uri":"/service.WorkerService/Commit2GranaryForActor","Message":{"worker_id":2},"PassThrough":"20439.06:28:09.6310000_711"}],"Oneway":false}}
{"time":1765952893886,"is_client":true,"json_data":{"Version":1,"SequenceID":714,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.WorkerService/Commit2GranaryForActor","Message":{"worker_id":1},"PassThrough":"20439.06:28:13.7420000_714"}],"Oneway":false}}
{"time":1765952898860,"is_client":true,"json_data":{"Version":1,"SequenceID":720,"Metadata":{"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"]},"Messages":[{"Uri":"/service.WorkerService/HarvestCropForActor","Message":{"worker_id":2,"crops_idx":21},"PassThrough":"20439.06:28:18.7220000_720"}],"Oneway":false}}
{"time":1765952902827,"is_client":false,"json_data":{"Version":1,"SequenceID":723,"Metadata":{},"Messages":[{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserResource","Message":{"uid":60078142","attr3":{"tomato":{"count":55,"lastAutoGrowTime":1765951944},"gold":{"count":1791,"lastAutoGrowTime":1765951944}},"v":378},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142","attr2":{"185_gold":3212,"64_building_residential01_1":2},"attr20":{"13_hero_1002":0,"190_gold":1791,"64_building_base_1":1,"184_steel":147},"v":1060},"PassThrough":""},{"Uri":"dbstate.Worker","Message":{"uid":60078142","worker_id":1,"carry_value":25,"carry_item_id":100004,"v":227},"PassThrough":""},{"Uri":"dbstate.SfvItem","Message":{"uid":60078142","id":100001,"count":1912,"v":141},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952908894,"is_client":false,"json_data":{"Version":1,"SequenceID":728,"Metadata":{},"Messages":[{"Uri":"msg.FinishGuideRep","Message":{"guideCfgId":"tl_stone_repair"},"PassThrough":"20439.06:28:28.5210000_728"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserGuide","Message":{"uid":60078142","attr41":{"guide_building_sfv_kitchen":true,"tl_stone_repair":true,"bbj_dialog_109":true},"v":46},"PassThrough":""},{"Uri":"dbstate.Village","Message":{"uid":60078142","power_plant":{},"v":84},"PassThrough":""},{"Uri":"dbstate.UserConditions","Message":{"uid":60078142","attr19":{"1000003":true,"1004611":true,"1002019":true,"1005139":true,"1004515":true},"v":142},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952910345,"is_client":true,"json_data":{"Version":1,"SequenceID":733,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.QuestService/SubmitQuestForActor","Message":{"QuestId":10490},"PassThrough":"20439.06:28:30.3320000_733"}],"Oneway":false}}
{"time":1765952914054,"is_client":true,"json_data":{"Version":1,"SequenceID":737,"Metadata":{"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"]},"Messages":[{"Uri":"/service.WorkerService/Commit2GranaryForActor","Message":{"worker_id":1},"PassThrough":"20439.06:28:33.9040000_737"}],"Oneway":false}}
{"time":1765952917093,"is_client":false,"json_data":{"Version":1,"SequenceID":740,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:28:36.7530000_740"}],"Oneway":false}}
{"time":1765952919719,"is_client":false,"json_data":{"Version":1,"SequenceID":744,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:28:39.5160000_744"}],"Oneway":false}}
{"time":1765952921390,"is_client":false,"json_data":{"Version":1,"SequenceID":748,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:28:41.0470000_748"}],"Oneway":false}}
{"time":1765952922266,"is_client":true,"json_data":{"Version":1,"SequenceID":752,"Metadata":{"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"]},"Messages":[{"Uri":"/service.GuideService/FinishForActor","Message":{"guideCfgId":"bbj_dialog_122"},"PassThrough":"20439.06:28:42.0570000_752"}],"Oneway":false}}
{"time":1765952922782,"is_client":false,"json_data":{"Version":1,"SequenceID":753,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:28:42.3590000_753"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserFeature","Message":{"uid":60078142","attr5":{"new_villager_6":true,"mainui_adventure":true,"build_army":false,"80_age_show_road_tavern":false},"attr14":{"fairy_road_starlist":false,"idle_battle":false,"building_brick_kiln":true,"building_furnace":false,"building_granary":true},"v":265},"PassThrough":""},{"Uri":"dbstate.UserQuestState","Message":{"uid":60078142","attr2":{"212450":0,"211250":0,"211490":0,"212450":0,"211970":0,"211010":0,"20690":1,"212210":0,"10130":3,"10370":1,"211010":0,"211570":0,"212050":0,"212530":0},"attr14":{"212030":0,"212750":0,"11150":1,"10190":3,"211550":0,"20750":1,"211070":0,"211790":0,"10142":1,"211310":0,"212510":0,"212270":0},"attr18":{"211890":0,"20850":1,"211410":0,"10050":3,"212130":0,"10242":3,"211650":0,"10290":1,"10530":1,"211170":0,"212610":0,"11394":1,"212850":0,"212370":0},"attr22":{"1000006":1,"10150":3,"211270":0,"211030":0,"212230":0,"212470":0,"212710":0,"10390":1,"212950":0,"20710":1,"211750":0,"211990":0,"211510":0},"attr26":{"10490":3,"212330":0,"212570":0,"20810":1,"11210":1,"10010":3,"212090":0,"211130":0,"10250":1,"211370":0,"211850":0,"211610":0},"v":734},"PassThrough":""},{"Uri":"dbstate.UserConditions","Message":{"uid":60078142","attr20":{"1004612":true,"1005140":true,"1004516":true,"1004996":true,"1005188":true,"1000004":true},"v":145},"PassThrough":""},{"Uri":"dbstate.UserQuest","Message":{"uid":60078142","questCfgId":10370,"state":1,"receiveTime":1765952932,"v":3},"PassThrough":""},{"Uri":"dbstate.UserQuest","Message":{"uid":60078142","questCfgId":10142,"state":1,"receiveTime":1765952932,"v":3},"PassThrough":""},{"Uri":"dbstate.UserQuest","Message":{"uid":60078142","questCfgId":10390,"state":1,"receiveTime":1765952932,"v":3},"PassThrough":""},{"Uri":"dbstate.UserQuest","Message":{"uid":60078142","questCfgId":10250,"state":1,"receiveTime":1765952932,"v":3},"PassThrough":""},{"Uri":"dbstate.UserQuest","Message":{"uid":60078142","questCfgId":10530,"state":1,"receiveTime":1765952932,"v":3},"PassThrough":""},{"Uri":"dbstate.UserQuest","Message":{"uid":60078142","questCfgId":10290,"state":1,"receiveTime":1765952932,"v":3},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952927951,"is_client":false,"json_data":{"Version":1,"SequenceID":758,"Metadata":{},"Messages":[{"Uri":"msg.FinishGuideRep","Message":{"guideCfgId":"guide_building_brick_kiln"},"PassThrough":"20439.06:28:47.7420000_758"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserGuide","Message":{"uid":60078142","attr1":{"bbj_dialog_116":true,"guide_building_brick_kiln":true,"bbj_dialog_101":true},"v":49},"PassThrough":""},{"Uri":"dbstate.Village","Message":{"uid":60078142","power_plant":{},"v":88},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952929937,"is_client":false,"json_data":{"Version":1,"SequenceID":760,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:28:49.5590000_760"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.Worker","Message":{"uid":60078142","worker_id":5,"v":43},"PassThrough":""},{"Uri":"dbstate.Village","Message":{"uid":60078142","kitchen":{"stoves":{"1":{"start_ts":1765952919,"end_ts":1765952933,"value":10}},"StorageCount":185},"v":90},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952932418,"is_client":false,"json_data":{"Version":1,"SequenceID":763,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:28:52.2660000_763"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserCounter","Message":{"uid":60078142","attr4":{"186_1802":2},"attr21":{"190_steel":0,"3_building_tent":1,"186_1412":2},"v":1125},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142","attr4":{"steel":{"lastAutoGrowTime":1765951944}},"v":398},"PassThrough":""},{"Uri":"dbstate.Benefits","Message":{"uid":60078142","attr":{"102000":{"entries":{"4":5,"11":6,"15":155,"12":4,"1":15,"19":0,"17":1,"18":2,"2":1,"3":200,"16":3}},"100200":{"entries":{"18":2,"2":140,"1":21}},"100800":{"entries":{"18":2,"4":5}}},"v":117},"PassThrough":""},{"Uri":"dbstate.UserQuestState","Message":{"uid":60078142","attr13":{"211165":0,"10525":1,"212845":0,"212605":0,"212125":0,"212365":0,"11581":1,"211645":0,"211405":0,"10285":2,"10141":1},"v":737},"PassThrough":""},{"Uri":"dbstate.UserBuilding","Message":{"uid":60078142","buildingId":8,"items_level":{"1802":2,"1801":1},"v":7},"PassThrough":""},{"Uri":"dbstate.UserQuest","Message":{"uid":60078142","questCfgId":10285,"state":2,"v":4},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952940641,"is_client":true,"json_data":{"Version":1,"SequenceID":770,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.WorkerService/HarvestCropForActor","Message":{"worker_id":2,"crops_idx":21},"PassThrough":"20439.06:29:00.5080000_770"}],"Oneway":false}}
{"time":1765952942348,"is_client":false,"json_data":{"Version":1,"SequenceID":772,"Metadata":{},"Messages":[{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserCounter","Message":{"uid":60078142","attr2":{"185_gold":3437,"64_building_residential01_1":2},"attr20":{"13_hero_1002":0,"190_gold":1816,"64_building_base_1":1,"184_steel":147},"attr22":{"3_building_river":1,"190_diamond":395,"185_tomato":360},"attr35":{"184_tomato":143,"185_steel":221,"2_building_brick_kiln":1,"75_201":1,"3_building_water":1,"2_building_bar01":1,"29_0":35,"184_gold":1816,"184_tomato":73},"v":1148},"PassThrough":""},{"Uri":"dbstate.Worker","Message":{"uid":60078142","worker_id":3,"carry_value":50,"carry_item_id":100004,"v":119},"PassThrough":""},{"Uri":"dbstate.SfvItem","Message":{"uid":60078142","id":100001,"count":2137,"v":154},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142","attr3":{"tomato":{"count":63,"lastAutoGrowTime":1765951944},"gold":{"count":1816,"lastAutoGrowTime":1765951944}},"v":407},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952944888,"is_client":true,"json_data":{"Version":1,"SequenceID":776,"Metadata":{"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"]},"Messages":[{"Uri":"/service.QuestService/SubmitQuestForActor","Message":{"QuestId":10280},"PassThrough":"20439.06:29:04.8810000_776"}],"Oneway":false}}
{"time":1765952947263,"is_client":true,"json_data":{"Version":1,"SequenceID":780,"Metadata":{"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"]},"Messages":[{"Uri":"/service.WorkerService/HarvestCropForActor","Message":{"worker_id":2,"crops_idx":22},"PassThrough":"20439.06:29:07.1310000_780"}],"Oneway":false}}
{"time":1765952950078,"is_client":true,"json_data":{"Version":1,"SequenceID":783,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.WorkerService/DigSoilForActor","Message":{"worker_id":6},"PassThrough":"20439.06:29:09.8980000_783"}],"Oneway":false}}
{"time":1765952953457,"is_client":false,"json_data":{"Version":1,"SequenceID":786,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:29:13.1100000_786"}],"Oneway":false}}
{"time":1765952954370,"is_client":true,"json_data":{"Version":1,"SequenceID":789,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.WorkerService/Commit2GranaryForActor","Message":{"worker_id":1},"PassThrough":"20439.06:29:14.2410000_789"}],"Oneway":false}}
{"time":1765952957367,"is_client":false,"json_data":{"Version":1,"SequenceID":793,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:29:17.0890000_793"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.Village","Message":{"uid":60078142","kitchen":{"stoves":{"1":{"start_ts":1765952965,"end_ts":1765952979,"value":8}},"StorageCount":145},"v":95},"PassThrough":""},{"Uri":"dbstate.Worker","Message":{"uid":60078142","worker_id":5,"v":48},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952958096,"is_client":true,"json_data":{"Version":1,"SequenceID":798,"Metadata":{"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"]},"Messages":[{"Uri":"/service.SfvClient/SetClientDataForActor","Message":{"key":"bbdialog123","value":"1","actions":[{"action_type":13,"param":"bbdialog123"},{"action_type":12,"param":"123"}]},"PassThrough":"20439.06:29:18.0920000_798"}],"Oneway":false}}
{"time":1765952963613,"is_client":false,"json_data":{"Version":1,"SequenceID":806,"Metadata":{},"Messages":[{"Uri":"msg.Placeholder","Message":{},"PassThrough":"20439.06:29:23.4610000_806"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserResource","Message":{"uid":60078142,"attr3":{"tomato":{"count":73,"lastAutoGrowTime":1765951944},"gold":{"count":2151,"lastAutoGrowTime":1765951944}},"attr7":{"diamond":{"count":395,"lastAutoGrowTime":1765951944}},"v":431},"PassThrough":""},{"Uri":"dbstate.UserQuestState","Message":{"uid":60078142,"attr28":{"211420":0,"212380":0,"212620":0,"211900":0,"212140":0,"11212":1,"211660":0,"20860":1,"10300":3,"211180":0,"10060":3},"v":747},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142,"attr2":{"185_gold":3772,"64_building_residential01_1":2},"attr7":{"28":31,"184_diamond":405,"2_building_sfv_kitchen":1,"64_building_transport_2":2,"64_building_sfv_kitchen_3":2},"attr8":{"65_building_river_1":1,"65_building_terra_1":1,"64_building_bar02_1":1,"3_building_farm":2,"185_diamond":420,"187_building_transport":1},"attr16":{"29_1":8,"186_3202":2,"65_building_sfv_kitchen_1":1},"attr20":{"64_building_base_1":1,"184_steel":47,"13_hero_1002":0,"190_gold":2151},"attr22":{"3_building_river":1,"190_diamond":405,"185_tomato":370},"attr35":{"184_tomato":143,"185_steel":50,"2_building_brick_kiln":1,"75_201":1,"3_building_water":1,"2_building_bar01":1,"29_0":35,"184_gold":2151},"v":1215},"PassThrough":""},{"Uri":"dbstate.UserConditions","Message":{"uid":60078142,"attr15":{"1005039":true,"1005135":true,"1004127":true,"1004511":true,"1004991":true,"1003695":true},"v":156},"PassThrough":""},{"Uri":"dbstate.UserQuest","Message":{"uid":60078142,"questCfgId":10300},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952968900,"is_client":true,"json_data":{"Version":1,"SequenceID":810,"Metadata":{"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"]},"Messages":[{"Uri":"/service.WorkerService/HarvestCropForActor","Message":{"worker_id":3,"crops_idx":32},"PassThrough":"20439.06:29:28.7400000_810"}],"Oneway":false}}
{"time":1765952972097,"is_client":false,"json_data":{"Version":1,"SequenceID":815,"Metadata":{},"Messages":[{"Uri":"msg.Placeholder","Message":{},"PassThrough":"20439.06:29:31.9030000_815"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserCounter","Message":{"uid":60078142,"attr2":{"185_gold":3882,"64_building_residential01_1":2},"attr7":{"28":31,"184_diamond":427,"2_building_sfv_kitchen":1,"64_building_transport_2":2,"64_building_sfv_kitchen_3":2},"attr8":{"65_building_river_1":1,"65_building_terra_1":1,"64_building_bar02_1":1,"3_building_farm":2,"185_diamond":475,"187_building_transport":1},"attr16":{"29_1":8,"186_3202":2,"65_building_sfv_kitchen_1":1},"attr20":{"184_steel":47,"13_hero_1002":0,"190_gold":2261,"64_building_base_1":1},"attr22":{"3_building_river":1,"190_diamond":423,"185_tomato":414},"attr35":{"184_tomato":182,"185_steel":50,"2_building_brick_kiln":1,"75_201":1,"3_building_water":1,"2_building_bar01":1,"29_0":35,"184_gold":2261},"v":1246},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142,"attr3":{"tomato":{"count":143,"lastAutoGrowTime":1765951944},"gold":{"count":2261,"lastAutoGrowTime":1765951944}},"attr7":{"diamond":{"count":423,"lastAutoGrowTime":1765951944}},"v":442},"PassThrough":""},{"Uri":"dbstate.UserQuestState","Message":{"uid":60078142,"attr29":{"211085":0,"212765":0,"211565":0,"212525":0,"212045":0,"211805":0,"212285":0,"211325":0,"19901":3},"v":751},"PassThrough":""},{"Uri":"dbstate.UserQuest","Message":{"uid":60078142,"questCfgId":19901},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765952979199,"is_client":true,"json_data":{"Version":1,"SequenceID":820,"Metadata":{"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"]},"Messages":[{"Uri":"/service.VillageService/KitchenProduceFinishForActor","Message":{"stove_id":1},"PassThrough":"20439.06:29:39.0790000_820"}],"Oneway":false}}
{"time":1765952984246,"is_client":true,"json_data":{"Version":1,"SequenceID":824,"Metadata":{"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"]},"Messages":[{"Uri":"/service.VillageService/BrickKilnProduceFinishForActor","Message":{},"PassThrough":"20439.06:29:44.0380000_824"}],"Oneway":false}}
{"time":1765952989856,"is_client":true,"json_data":{"Version":1,"SequenceID":828,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.WorkerService/HarvestCropForActor","Message":{"worker_id":1,"crops_idx":12},"PassThrough":"20439.06:29:49.7140000_828"}],"Oneway":false}}
{"time":1765952994237,"is_client":false,"json_data":{"Version":1,"SequenceID":830,"Metadata":{},"Messages":[{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.Worker","Message":{"uid":60078142,"worker_id":2,"v":244},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142,"attr15":{"186_1201":4,"187_building_ex_farm":3,"185_wheat":6109},"attr32":{"76":17423,"184_wheat":2169,"3_building_brick_kiln":1},"attr41":{"75_1":1,"6_1":2,"190_wheat":2169},"v":1282},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142,"attr0":{"wheat":{"count":2169,"lastAutoGrowTime":1765951944}},"v":458},"PassThrough":""},{"Uri":"dbstate.SfvItem","Message":{"uid":60078142,"id":100004,"count":4016,"v":108},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765953002319,"is_client":false,"json_data":{"Version":1,"SequenceID":834,"Metadata":{},"Messages":[{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserCounter","Message":{"uid":60078142,"attr2":{"185_gold":4047,"64_building_residential01_1":2},"attr20":{"184_steel":47,"13_hero_1002":0,"190_gold":2326,"64_building_base_1":1},"attr22":{"3_building_river":1,"190_diamond":405,"185_tomato":260},"attr35":{"184_tomato":143,"185_steel":54,"2_building_brick_kiln":1,"75_201":1,"3_building_water":1,"2_building_bar01":1,"29_0":35,"184_gold":2326},"attr40":{"4_building_bar02":1,"64_building_farm_2":2,"190_tomato":141,"65_building_ex_farm_1":1},"v":1294},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142,"attr3":{"gold":{"count":2326,"lastAutoGrowTime":1765951944},"tomato":{"count":141,"lastAutoGrowTime":1765951944}},"v":463},"PassThrough":""},{"Uri":"dbstate.Village","Message":{"uid":60078142,"kitchen":{"stoves":{"1":{"start_ts":1765953011,"end_ts":1765953025,"value":10}},"StorageCount":85},"v":101},"PassThrough":""},{"Uri":"dbstate.SfvItem","Message":{"uid":60078142,"id":100013,"count":48,"v":12},"PassThrough":""},{"Uri":"dbstate.SfvItem","Message":{"uid":60078142,"id":100001,"count":2497,"v":175},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765953005164,"is_client":true,"json_data":{"Version":1,"SequenceID":838,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.VillageService/BrickKilnProduceFinishForActor","Message":{},"PassThrough":"20439.06:30:05.0190000_838"}],"Oneway":false}}
{"time":1765953009241,"is_client":false,"json_data":{"Version":1,"SequenceID":841,"Metadata":{},"Messages":[{"Uri":"msg.Placeholder","Message":{},"PassThrough":"20439.06:30:09.0830000_841"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserQuest","Message":{"uid":60078142,"questCfgId":10520,"state":3,"v":5},"PassThrough":""},{"Uri":"dbstate.UserQuestState","Message":{"uid":60078142,"attr8":{"212120":0,"211640":0,"211400":0,"10280":3,"20840":1,"212600":0,"10520":3,"11480":1,"211160":0,"212360":0,"212840":0,"211880":0,"10040":3},"v":753},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142,"attr3":{"gold":{"count":2406,"lastAutoGrowTime":1765951944},"tomato":{"count":141,"lastAutoGrowTime":1765951944}},"attr7":{"diamond":{"count":410,"lastAutoGrowTime":1765951944}},"v":469},"PassThrough":""},{"Uri":"dbstate.UserConditions","Message":{"uid":60078142,"attr40":{"1004344":true,"1001320":true,"1005208":true},"v":160},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142,"attr2":{"185_gold":4127,"64_building_residential01_1":2},"attr7":{"64_building_sfv_kitchen_3":2,"28":33,"184_diamond":410,"2_building_sfv_kitchen":1,"64_building_transport_2":2},"attr8":{"65_building_river_1":1,"65_building_terra_1":1,"64_building_bar02_1":1,"3_building_farm":2,"185_diamond":455,"187_building_transport":1},"attr20":{"64_building_base_1":1,"184_steel":59,"13_hero_1002":0,"190_gold":2406},"attr22":{"3_building_river":1,"190_diamond":410,"185_tomato":260},"attr35":{"2_building_brick_kiln":1,"75_201":1,"3_building_water":1,"2_building_bar01":1,"29_0":36,"184_gold":2406,"184_tomato":143,"185_steel":66},"v":1317},"PassThrough":""},{"Uri":"dbstate.UserQuest","Message":{"uid":60078142,"questCfgId":10520,"state":3,"v":5},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765953015199,"is_client":false,"json_data":{"Version":1,"SequenceID":845,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:30:14.8340000_845"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserResource","Message":{"uid":60078142,"attr0":{"wheat":{"count":2179,"lastAutoGrowTime":1765951944}},"v":472},"PassThrough":""},{"Uri":"dbstate.Worker","Message":{"uid":60078142,"worker_id":1,"v":261},"PassThrough":""},{"Uri":"dbstate.SfvItem","Message":{"uid":60078142,"id":100004,"count":4716,"v":122},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142,"attr15":{"185_wheat":6259,"65_building_residential01_1":1,"186_1201":4,"187_building_ex_farm":3},"attr32":{"76":17423,"184_wheat":2179,"3_building_brick_kiln":1,"186_3109":2},"attr41":{"75_1":1,"6_1":2,"190_wheat":2179},"v":1325},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765953016666,"is_client":false,"json_data":{"Version":1,"SequenceID":849,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:30:16.0890000_849"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.SfvItem","Message":{"uid":60078142,"id":100001,"count":2587,"v":181},"PassThrough":""},{"Uri":"dbstate.Worker","Message":{"uid":60078142,"worker_id":3,"carry_value":25,"carry_item_id":100004,"v":136},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142,"attr3":{"tomato":{"count":121,"lastAutoGrowTime":1765951944},"gold":{"count":2266,"lastAutoGrowTime":1765951944}},"v":479},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142,"attr2":{"185_gold":4187,"64_building_residential01_1":2},"attr20":{"13_hero_1002":0,"190_gold":2266,"64_building_base_1":1,"184_steel":147,"13_hero_1002":0},"v":1342},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765953023820,"is_client":false,"json_data":{"Version":1,"SequenceID":853,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:30:23.4630000_853"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserCounter","Message":{"uid":60078142,"attr2":{"64_building_residential01_1":2,"185_gold":4217},"attr20":{"190_gold":2196,"64_building_base_1":1,"184_steel":147,"13_hero_1002":0},"v":1357},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142,"attr3":{"tomato":{"count":121,"lastAutoGrowTime":1765951944},"gold":{"count":2196,"lastAutoGrowTime":1765951944}},"v":485},"PassThrough":""},{"Uri":"dbstate.Worker","Message":{"uid":60078142,"worker_id":1,"carry_value":25,"carry_item_id":100004,"v":263},"PassThrough":""},{"Uri":"dbstate.SfvItem","Message":{"uid":60078142,"id":100001,"count":2617,"v":183},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765953030154,"is_client":true,"json_data":{"Version":1,"SequenceID":859,"Metadata":{"sandwich_actor_target_id":["60078142"],"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"]},"Messages":[{"Uri":"/service.WorkerService/HarvestCropForActor","Message":{"worker_id":3,"crops_idx":31},"PassThrough":"20439.06:30:30.0320000_859"}],"Oneway":false}}
{"time":1765953033838,"is_client":false,"json_data":{"Version":1,"SequenceID":0,"Metadata":{},"Messages":[{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserQueues","Message":{"uid":60078142,"building_queues":{"4000000":{"queueId":4000000}},"v":15},"PassThrough":""},{"Uri":"dbstate.UserBuilding","Message":{"uid":60078142,"buildingId":7,"state":2,"v":9},"PassThrough":""},{"Uri":"dbstate.UserJob","Message":{"uid":60078142,"jobId":32229642},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765953037869,"is_client":false,"json_data":{"Version":1,"SequenceID":866,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:30:37.5750000_866"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.SfvItem","Message":{"uid":60078142,"id":100001,"count":2707,"v":188},"PassThrough":""},{"Uri":"dbstate.Worker","Message":{"uid":60078142,"worker_id":6,"carry_value":12,"carry_item_id":100010,"v":25},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142,"attr3":{"tomato":{"count":131,"lastAutoGrowTime":1765951944},"gold":{"count":2436,"lastAutoGrowTime":1765951944}},"v":498},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142,"attr2":{"185_gold":4457,"64_building_residential01_1":2},"attr20":{"13_hero_1002":0,"190_gold":2436,"64_building_base_1":1,"184_steel":147},"v":1391},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765953042977,"is_client":false,"json_data":{"Version":1,"SequenceID":869,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:30:42.6460000_869"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserCounter","Message":{"uid":60078142,"attr2":{"64_building_residential01_1":2,"185_gold":4472},"attr20":{"13_hero_1002":0,"190_gold":2451,"64_building_base_1":1,"184_steel":147},"attr35":{"29_0":38,"184_gold":2451,"184_tomato":143,"185_steel":161,"2_building_brick_kiln":1,"75_201":1,"3_building_water":1,"2_building_bar01":1},"v":1396},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142,"attr3":{"gold":{"count":2451,"lastAutoGrowTime":1765951944},"tomato":{"count":131,"lastAutoGrowTime":1765951944}},"v":500},"PassThrough":""},{"Uri":"dbstate.Worker","Message":{"uid":60078142,"worker_id":3,"carry_value":25,"carry_item_id":100004,"v":142},"PassThrough":""},{"Uri":"dbstate.SfvItem","Message":{"uid":60078142,"id":100001,"count":2722,"v":189},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765953048134,"is_client":true,"json_data":{"Version":1,"SequenceID":875,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.VillageService/BrickKilnProduceFinishForActor","Message":{},"PassThrough":"20439.06:30:48.0110000_875"}],"Oneway":false}}
{"time":1765953049376,"is_client":true,"json_data":{"Version":1,"SequenceID":878,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.WorkerService/HarvestCropForActor","Message":{"worker_id":3,"crops_idx":32},"PassThrough":"20439.06:30:49.2580000_878"}],"Oneway":false}}
{"time":1765953053204,"is_client":false,"json_data":{"Version":1,"SequenceID":883,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:30:53.0410000_883"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.Benefits","Message":{"uid":60078142,"attr22":{"102200":{"entries":{"20":10000,"4":32,"3":6000,"18":2,"17":10,"13":14}},"101600":{"entries":{"14":17,"5":3,"11":20,"12":4,"2":5}},"101900":{"entries":{"5":5,"18":3,"1":1,"2":5,"3":10}},"100400":{"entries":{"11":6,"4":15,"19":0,"12":33,"18":3,"17":25,"2":1,"3":10000,"1":15,"16":3,"15":50}},"100700":{"entries":{"4":5,"18":3}}},"v":123},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142,"attr21":{"190_steel":123,"3_building_tent":1,"186_1412":2},"attr34":{"2_building_base":1,"186_3204":5,"186_1202":2},"v":1429},"PassThrough":""},{"Uri":"dbstate.UserBenefits","Message":{"uid":60078142,"attr14":{"90014":{"entries":{"14":32}}},"v":150},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142,"attr4":{"steel":{"count":123,"lastAutoGrowTime":1765951944}},"v":516},"PassThrough":""},{"Uri":"dbstate.Village","Message":{"uid":60078142,"kitchen":{"stoves":{"1":{"start_ts":1765953057,"end_ts":1765953071,"value":10},"2":{}},"StorageCount":165},"v":117},"PassThrough":""},{"Uri":"dbstate.UserBuilding","Message":{"uid":60078142,"buildingId":22,"items_level":{"3204":5,"3205":3,"3206":2,"3201":4,"3202":2,"3203":1},"v":23},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765953054952,"is_client":true,"json_data":{"Version":1,"SequenceID":887,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.BuildingService/BuildingUpgradeItemForActor","Message":{"building_id":22,"building_item_id":3204},"PassThrough":"20439.06:30:54.5900000_887"}],"Oneway":false}}
{"time":1765953057932,"is_client":false,"json_data":{"Version":1,"SequenceID":891,"Metadata":{},"Messages":[{"Uri":"msg.Placeholder","Message":{},"PassThrough":"20439.06:30:57.7780000_891"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserQuestState","Message":{"uid":60078142,"attr20":{"212900":0,"212180":0,"211700":0,"212660":0,"211940":0,"211220":0,"211460":0,"11540":1,"212420":0,"10340":3},"v":764},"PassThrough":""},{"Uri":"dbstate.UserConditions","Message":{"uid":60078142,"attr27":{"1005531":true,"1005051":true,"1004523":true,"1003755":true,"1004619":true,"1005195":true},"v":170},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142,"attr7":{"28":37,"184_diamond":415,"2_building_sfv_kitchen":1,"64_building_transport_2":2,"64_building_sfv_kitchen_3":2},"attr8":{"65_building_terra_1":1,"64_building_bar02_1":1,"3_building_farm":2,"185_diamond":420,"187_building_transport":1,"65_building_river_1":1},"attr22":{"190_diamond":415,"185_tomato":360,"3_building_river":1},"attr35":{"184_tomato":156,"185_steel":173,"2_building_brick_kiln":1,"75_201":1,"3_building_water":1,"2_building_bar01":1,"29_0":40,"184_gold":2451},"attr40":{"65_building_ex_farm_1":1,"4_building_bar02":1,"64_building_farm_2":2,"190_tomato":156},"v":1450},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142,"attr3":{"gold":{"count":2106,"lastAutoGrowTime":1765951944},"tomato":{"count":156,"lastAutoGrowTime":1765951944}},"attr7":{"diamond":{"count":415,"lastAutoGrowTime":1765951944}},"v":525},"PassThrough":""},{"Uri":"dbstate.UserQuest","Message":{"uid":60078142,"questCfgId":10340,"state":3,"v":5},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765953070265,"is_client":false,"json_data":{"Version":1,"SequenceID":899,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:31:09.9560000_899"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserCounter","Message":{"uid":60078142,"attr2":{"185_gold":4802,"64_building_residential01_1":2},"attr20":{"13_hero_1002":0,"190_gold":2281,"64_building_base_1":1,"184_steel":147},"v":1472},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142,"attr3":{"gold":{"count":2281,"lastAutoGrowTime":1765951944},"tomato":{"count":156,"lastAutoGrowTime":1765951944}},"v":534},"PassThrough":""},{"Uri":"dbstate.SfvItem","Message":{"uid":60078142,"id":100001,"count":2902,"v":200},"PassThrough":""},{"Uri":"dbstate.Worker","Message":{"uid":60078142,"worker_id":1,"carry_value":50,"v":276},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765953072450,"is_client":true,"json_data":{"Version":1,"SequenceID":904,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.QuestService/SubmitQuestForActor","Message":{"QuestId":10325},"PassThrough":"20439.06:31:12.4400000_904"}],"Oneway":false}}
{"time":1765953078195,"is_client":false,"json_data":{"Version":1,"SequenceID":909,"Metadata":{},"Messages":[{"Uri":"msg.Placeholder","Message":{},"PassThrough":"20439.06:31:18.0230000_909"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserConditions","Message":{"uid":60078142,"attr15":{"1004511":true,"1004991":true,"1003695":true,"1005039":true,"1001535":true,"1005135":true,"1004127":true},"attr40":{"1004344":true,"1001320":true,"1005208":true,"1004536":true},"v":175},"PassThrough":""},{"Uri":"dbstate.Benefits","Message":{"uid":60078142,"attr42":{"102100":{"entries":{"20":1000,"4":15,"13":12,"18":1,"3":300,"5":12,"1":6,"2":10000,"17":100}},"101500":{"entries":{"18":2,"2":8,"3":400,"5":8}},"101800":{"entries":{"3":10,"5":5,"18":2,"1":1,"2":5}}},"v":127},"PassThrough":""},{"Uri":"dbstate.UserQuestState","Message":{"uid":60078142,"attr22":{"212470":0,"10150":3,"211270":0,"211030":0,"10390":2,"211990":0,"211510":0,"20710":1,"212230":0,"212950":0,"212710":0,"211750":0,"1000006":1},"v":769},"PassThrough":""},{"Uri":"dbstate.UserBenefits","Message":{"uid":60078142,"attr22":{"90022":{"entries":{"17":300}}},"attr25":{"90025":{"entries":{"17":100}},"3001":{"entries":{"6":100,"15":1800,"1":600,"7":4261.750037491322,"5":600,"12":1800,"10":600,"14":1800,"8":4261.750037491322,"16":200,"11":300,"2":600,"3":600,"17":200,"4":600,"9":2400,"13":200}}},"v":156},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142,"attr4":{"steel":{"count":102,"lastAutoGrowTime":1765951944}},"attr7":{"diamond":{"count":423,"lastAutoGrowTime":1765951944}},"v":548},"PassThrough":""},{"Uri":"dbstate.UserBuilding","Message":{"uid":60078142,"buildingId":21,"level":2,"v":11},"PassThrough":""},{"Uri":"dbstate.UserQuest","Message":{"uid":60078142,"questCfgId":10390,"state":2,"v":4},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765953083326,"is_client":true,"json_data":{"Version":1,"SequenceID":913,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.WorkerService/HarvestCropForActor","Message":{"worker_id":1,"crops_idx":11},"PassThrough":"20439.06:31:23.1740000_913"}],"Oneway":false}}
{"time":1765953085590,"is_client":true,"json_data":{"Version":1,"SequenceID":916,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.QuestService/SubmitQuestForActor","Message":{"QuestId":10440},"PassThrough":"20439.06:31:25.5750000_916"}],"Oneway":false}}
{"time":1765953093123,"is_client":true,"json_data":{"Version":1,"SequenceID":921,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.VillageService/BrickKilnProduceFinishForActor","Message":{},"PassThrough":"20439.06:31:33.0150000_921"}],"Oneway":false}}
{"time":1765953094712,"is_client":false,"json_data":{"Version":1,"SequenceID":924,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:31:34.4580000_924"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.Worker","Message":{"uid":60078142,"worker_id":1,"v":285},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142,"attr15":{"186_1201":4,"187_building_ex_farm":3,"185_wheat":6809,"65_building_residential01_1":1},"attr32":{"184_wheat":2309,"3_building_brick_kiln":2,"76":17423,"186_3109":2},"attr41":{"75_1":1,"6_1":2,"190_wheat":2309},"v":1558},"PassThrough":""},{"Uri":"dbstate.SfvItem","Message":{"uid":60078142,"id":100004,"count":4716,"v":122},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142,"attr0":{"wheat":{"count":2309,"lastAutoGrowTime":1765951944}},"v":565},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765953097606,"is_client":false,"json_data":{"Version":1,"SequenceID":926,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:31:37.3490000_926"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.Village","Message":{"uid":60078142,"kitchen":{"stoves":{"1":{"start_ts":1765953103,"end_ts":1765953117,"value":12},"2":{}},"StorageCount":145},"v":132},"PassThrough":""},{"Uri":"dbstate.Worker","Message":{"uid":60078142,"worker_id":5,"v":73},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765953103107,"is_client":false,"json_data":{"Version":1,"SequenceID":929,"Metadata":{},"Messages":[{"Uri":"netutils.NormalAck","Message":{},"PassThrough":"20439.06:31:42.7730000_929"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.SfvItem","Message":{"uid":60078142,"id":100001,"count":3120,"v":212},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142,"attr3":{"gold":{"count":2749,"lastAutoGrowTime":1765951944},"tomato":{"count":179,"lastAutoGrowTime":1765951944}},"v":569},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142,"attr2":{"64_building_residential01_1":2,"185_gold":5320},"attr20":{"13_hero_1002":0,"190_gold":2749,"64_building_base_1":1,"184_steel":147},"attr35":{"29_0":43,"184_gold":2749,"184_tomato":179,"185_steel":197,"2_building_brick_kiln":1,"75_201":1,"3_building_water":1,"2_building_bar01":1},"v":1570},"PassThrough":""},{"Uri":"dbstate.Worker","Message":{"uid":60078142,"worker_id":1,"carry_value":25,"carry_item_id":100004,"v":287},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}
{"time":1765953108873,"is_client":true,"json_data":{"Version":1,"SequenceID":934,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.QuestService/SubmitQuestForActor","Message":{"QuestId":10380},"PassThrough":"20439.06:31:48.8590000_934"}],"Oneway":false}}
{"time":1765953113777,"is_client":true,"json_data":{"Version":1,"SequenceID":939,"Metadata":{"x-gate-version":["1.2"],"x-dev-server-name":["Pioneer"],"x-gate-server-type":["game"],"sandwich_actor_system":["logic"],"sandwich_actor_target_id":["60078142"]},"Messages":[{"Uri":"/service.WorkerService/HarvestCropForActor","Message":{"worker_id":2,"crops_idx":22},"PassThrough":"20439.06:31:53.6390000_939"}],"Oneway":false}}
{"time":1765953115072,"is_client":false,"json_data":{"Version":1,"SequenceID":942,"Metadata":{},"Messages":[{"Uri":"msg.Placeholder","Message":{},"PassThrough":"20439.06:31:54.9160000_942"},{"Uri":"protocol.SyncDataSet","Message":[{"Uri":"dbstate.UserConditions","Message":{"uid":60078142,"attr9":{"1001529":true,"1003881":true,"1005177":true,"1005129":true,"1004313":true},"v":182},"PassThrough":""},{"Uri":"dbstate.UserCounter","Message":{"uid":60078142,"attr2":{"64_building_residential01_1":2,"185_gold":5480},"attr7":{"184_diamond":443,"2_building_sfv_kitchen":1,"64_building_transport_2":2,"64_building_sfv_kitchen_3":2,"28":40},"attr8":{"185_diamond":455,"187_building_transport":2,"65_building_river_1":1,"65_building_terra_1":1,"64_building_bar02_1":1,"3_building_farm":2},"attr16":{"29_1":12,"186_3202":2,"65_building_sfv_kitchen_1":1},"attr20":{"184_steel":147,"13_hero_1002":0,"190_gold":2709,"64_building_base_1":1},"attr22":{"185_tomato":388,"64_building_residential02_2":1,"3_building_river":1,"190_diamond":443},"attr35":{"29_0":45,"184_gold":2779,"184_tomato":179,"185_steel":209,"2_building_brick_kiln":1,"75_201":1,"3_building_water":1,"2_building_bar01":1},"v":1608},"PassThrough":""},{"Uri":"dbstate.UserResource","Message":{"uid":60078142,"attr3":{"tomato":{"count":159,"lastAutoGrowTime":1765951944},"gold":{"count":2709,"lastAutoGrowTime":1765951944}},"attr7":{"diamond":{"count":443,"lastAutoGrowTime":1765951944}},"v":583},"PassThrough":""},{"Uri":"dbstate.UserItem","Message":{"uid":60078142,"itemCfgId":"steel_100","itemId":10595566,"count":12,"v":6},"PassThrough":""},{"Uri":"dbstate.UserQuest","Message":{"uid":60078142,"questCfgId":10525,"state":3,"v":6},"PassThrough":""},{"Uri":"dbstate.UserFeature","Message":{"uid":60078142,"attr24":{"battle_tag":false,"idle_resource":false,"building_army_4":false,"building_equip_stone":false,"new_villager_9":true},"v":268},"PassThrough":""},{"Uri":"dbstate.UserQuestState","Message":{"uid":60078142,"attr13":{"212845":0,"211165":0,"10141":3,"212605":0,"10525":3,"211405":0,"10285":3,"11581":1,"211645":0,"212365":0,"212125":0},"v":777},"PassThrough":""}],"PassThrough":""}],"Oneway":false}}

================
File: plugins/asd
================
{}

================
File: plugins/we
================
{}

================
File: proto/common.proto
================
syntax = "proto3";

package  common;

option go_package = "proxy-system-backend/proto/common;common";

enum PacketDirection {
  PACKET_DIRECTION_UNKNOWN = 0;
  PACKET_DIRECTION_C2S     = 1; // client -> server
  PACKET_DIRECTION_S2C     = 2; // server -> client
}

enum TransportType {
  TRANSPORT_UNKNOWN = 0;
  TRANSPORT_TCP     = 1;
  TRANSPORT_UDP     = 2;
}

================
File: proto/common/common.pb.go
================
// Code generated by protoc-gen-go. DO NOT EDIT.
// versions:
// 	protoc-gen-go v1.36.9
// 	protoc        v3.21.4
// source: common.proto

package common

import (
	protoreflect "google.golang.org/protobuf/reflect/protoreflect"
	protoimpl "google.golang.org/protobuf/runtime/protoimpl"
	reflect "reflect"
	sync "sync"
	unsafe "unsafe"
)

const (
	// Verify that this generated code is sufficiently up-to-date.
	_ = protoimpl.EnforceVersion(20 - protoimpl.MinVersion)
	// Verify that runtime/protoimpl is sufficiently up-to-date.
	_ = protoimpl.EnforceVersion(protoimpl.MaxVersion - 20)
)

type PacketDirection int32

const (
	PacketDirection_PACKET_DIRECTION_UNKNOWN PacketDirection = 0
	PacketDirection_PACKET_DIRECTION_C2S     PacketDirection = 1 // client -> server
	PacketDirection_PACKET_DIRECTION_S2C     PacketDirection = 2 // server -> client
)

// Enum value maps for PacketDirection.
var (
	PacketDirection_name = map[int32]string{
		0: "PACKET_DIRECTION_UNKNOWN",
		1: "PACKET_DIRECTION_C2S",
		2: "PACKET_DIRECTION_S2C",
	}
	PacketDirection_value = map[string]int32{
		"PACKET_DIRECTION_UNKNOWN": 0,
		"PACKET_DIRECTION_C2S":     1,
		"PACKET_DIRECTION_S2C":     2,
	}
)

func (x PacketDirection) Enum() *PacketDirection {
	p := new(PacketDirection)
	*p = x
	return p
}

func (x PacketDirection) String() string {
	return protoimpl.X.EnumStringOf(x.Descriptor(), protoreflect.EnumNumber(x))
}

func (PacketDirection) Descriptor() protoreflect.EnumDescriptor {
	return file_common_proto_enumTypes[0].Descriptor()
}

func (PacketDirection) Type() protoreflect.EnumType {
	return &file_common_proto_enumTypes[0]
}

func (x PacketDirection) Number() protoreflect.EnumNumber {
	return protoreflect.EnumNumber(x)
}

// Deprecated: Use PacketDirection.Descriptor instead.
func (PacketDirection) EnumDescriptor() ([]byte, []int) {
	return file_common_proto_rawDescGZIP(), []int{0}
}

type TransportType int32

const (
	TransportType_TRANSPORT_UNKNOWN TransportType = 0
	TransportType_TRANSPORT_TCP     TransportType = 1
	TransportType_TRANSPORT_UDP     TransportType = 2
)

// Enum value maps for TransportType.
var (
	TransportType_name = map[int32]string{
		0: "TRANSPORT_UNKNOWN",
		1: "TRANSPORT_TCP",
		2: "TRANSPORT_UDP",
	}
	TransportType_value = map[string]int32{
		"TRANSPORT_UNKNOWN": 0,
		"TRANSPORT_TCP":     1,
		"TRANSPORT_UDP":     2,
	}
)

func (x TransportType) Enum() *TransportType {
	p := new(TransportType)
	*p = x
	return p
}

func (x TransportType) String() string {
	return protoimpl.X.EnumStringOf(x.Descriptor(), protoreflect.EnumNumber(x))
}

func (TransportType) Descriptor() protoreflect.EnumDescriptor {
	return file_common_proto_enumTypes[1].Descriptor()
}

func (TransportType) Type() protoreflect.EnumType {
	return &file_common_proto_enumTypes[1]
}

func (x TransportType) Number() protoreflect.EnumNumber {
	return protoreflect.EnumNumber(x)
}

// Deprecated: Use TransportType.Descriptor instead.
func (TransportType) EnumDescriptor() ([]byte, []int) {
	return file_common_proto_rawDescGZIP(), []int{1}
}

var File_common_proto protoreflect.FileDescriptor

const file_common_proto_rawDesc = "" +
	"\n" +
	"\fcommon.proto\x12\x06common*c\n" +
	"\x0fPacketDirection\x12\x1c\n" +
	"\x18PACKET_DIRECTION_UNKNOWN\x10\x00\x12\x18\n" +
	"\x14PACKET_DIRECTION_C2S\x10\x01\x12\x18\n" +
	"\x14PACKET_DIRECTION_S2C\x10\x02*L\n" +
	"\rTransportType\x12\x15\n" +
	"\x11TRANSPORT_UNKNOWN\x10\x00\x12\x11\n" +
	"\rTRANSPORT_TCP\x10\x01\x12\x11\n" +
	"\rTRANSPORT_UDP\x10\x02B*Z(proxy-system-backend/proto/common;commonb\x06proto3"

var (
	file_common_proto_rawDescOnce sync.Once
	file_common_proto_rawDescData []byte
)

func file_common_proto_rawDescGZIP() []byte {
	file_common_proto_rawDescOnce.Do(func() {
		file_common_proto_rawDescData = protoimpl.X.CompressGZIP(unsafe.Slice(unsafe.StringData(file_common_proto_rawDesc), len(file_common_proto_rawDesc)))
	})
	return file_common_proto_rawDescData
}

var file_common_proto_enumTypes = make([]protoimpl.EnumInfo, 2)
var file_common_proto_goTypes = []any{
	(PacketDirection)(0), // 0: common.PacketDirection
	(TransportType)(0),   // 1: common.TransportType
}
var file_common_proto_depIdxs = []int32{
	0, // [0:0] is the sub-list for method output_type
	0, // [0:0] is the sub-list for method input_type
	0, // [0:0] is the sub-list for extension type_name
	0, // [0:0] is the sub-list for extension extendee
	0, // [0:0] is the sub-list for field type_name
}

func init() { file_common_proto_init() }
func file_common_proto_init() {
	if File_common_proto != nil {
		return
	}
	type x struct{}
	out := protoimpl.TypeBuilder{
		File: protoimpl.DescBuilder{
			GoPackagePath: reflect.TypeOf(x{}).PkgPath(),
			RawDescriptor: unsafe.Slice(unsafe.StringData(file_common_proto_rawDesc), len(file_common_proto_rawDesc)),
			NumEnums:      2,
			NumMessages:   0,
			NumExtensions: 0,
			NumServices:   0,
		},
		GoTypes:           file_common_proto_goTypes,
		DependencyIndexes: file_common_proto_depIdxs,
		EnumInfos:         file_common_proto_enumTypes,
	}.Build()
	File_common_proto = out.File
	file_common_proto_goTypes = nil
	file_common_proto_depIdxs = nil
}

================
File: proto/plugin.proto
================
syntax = "proto3";

package  plugin;

import "raw_packet.proto";
import "visual_message.proto";
import "google/protobuf/empty.proto";



option go_package = "proxy-system-backend/proto/plugin;plugin";


message DecodeRequest {
  raw.RawPacket packet = 1;

  // ç”±ä¸»ç¨‹åºé€‰æ‹©çš„åè®®ç‰ˆæœ¬
  string protocol_id = 2;
}

message DecodeResponse {
  repeated visual.VisualMessage messages = 1;
}

message PluginInfo {
  string name        = 1;
  string game        = 2;
  string version     = 3;
  string author      = 4;
  string description = 5;

  // æ”¯æŒçš„åè®®ç‰ˆæœ¬
  repeated ProtocolDesc protocols = 6;
}

message ProtocolDesc {
  string id           = 1; // v1 / v2 / cn_2024
  string display_name = 2;
}

service GameProtocolPlugin {
  // æ’ä»¶å…ƒä¿¡æ¯
  rpc Info (google.protobuf.Empty) returns (PluginInfo);

  // è§£ç å…¥å£
  rpc Decode(DecodeRequest) returns (DecodeResponse);

  // è¿žæŽ¥é‡ç½®ï¼ˆæ–­çº¿ / å›žæ”¾é‡ç½®ï¼‰
  rpc ResetConn(ResetConnRequest) returns ( google.protobuf.Empty);
}

message ResetConnRequest {
  string conn_id = 1;
}

================
File: proto/plugin/plugin_grpc.pb.go
================
// Code generated by protoc-gen-go-grpc. DO NOT EDIT.
// versions:
// - protoc-gen-go-grpc v1.5.1
// - protoc             v3.21.4
// source: plugin.proto

package plugin

import (
	context "context"
	grpc "google.golang.org/grpc"
	codes "google.golang.org/grpc/codes"
	status "google.golang.org/grpc/status"
	emptypb "google.golang.org/protobuf/types/known/emptypb"
)

// This is a compile-time assertion to ensure that this generated file
// is compatible with the grpc package it is being compiled against.
// Requires gRPC-Go v1.64.0 or later.
const _ = grpc.SupportPackageIsVersion9

const (
	GameProtocolPlugin_Info_FullMethodName      = "/plugin.GameProtocolPlugin/Info"
	GameProtocolPlugin_Decode_FullMethodName    = "/plugin.GameProtocolPlugin/Decode"
	GameProtocolPlugin_ResetConn_FullMethodName = "/plugin.GameProtocolPlugin/ResetConn"
)

// GameProtocolPluginClient is the client API for GameProtocolPlugin service.
//
// For semantics around ctx use and closing/ending streaming RPCs, please refer to https://pkg.go.dev/google.golang.org/grpc/?tab=doc#ClientConn.NewStream.
type GameProtocolPluginClient interface {
	// æ’ä»¶å…ƒä¿¡æ¯
	Info(ctx context.Context, in *emptypb.Empty, opts ...grpc.CallOption) (*PluginInfo, error)
	// è§£ç å…¥å£
	Decode(ctx context.Context, in *DecodeRequest, opts ...grpc.CallOption) (*DecodeResponse, error)
	// è¿žæŽ¥é‡ç½®ï¼ˆæ–­çº¿ / å›žæ”¾é‡ç½®ï¼‰
	ResetConn(ctx context.Context, in *ResetConnRequest, opts ...grpc.CallOption) (*emptypb.Empty, error)
}

type gameProtocolPluginClient struct {
	cc grpc.ClientConnInterface
}

func NewGameProtocolPluginClient(cc grpc.ClientConnInterface) GameProtocolPluginClient {
	return &gameProtocolPluginClient{cc}
}

func (c *gameProtocolPluginClient) Info(ctx context.Context, in *emptypb.Empty, opts ...grpc.CallOption) (*PluginInfo, error) {
	cOpts := append([]grpc.CallOption{grpc.StaticMethod()}, opts...)
	out := new(PluginInfo)
	err := c.cc.Invoke(ctx, GameProtocolPlugin_Info_FullMethodName, in, out, cOpts...)
	if err != nil {
		return nil, err
	}
	return out, nil
}

func (c *gameProtocolPluginClient) Decode(ctx context.Context, in *DecodeRequest, opts ...grpc.CallOption) (*DecodeResponse, error) {
	cOpts := append([]grpc.CallOption{grpc.StaticMethod()}, opts...)
	out := new(DecodeResponse)
	err := c.cc.Invoke(ctx, GameProtocolPlugin_Decode_FullMethodName, in, out, cOpts...)
	if err != nil {
		return nil, err
	}
	return out, nil
}

func (c *gameProtocolPluginClient) ResetConn(ctx context.Context, in *ResetConnRequest, opts ...grpc.CallOption) (*emptypb.Empty, error) {
	cOpts := append([]grpc.CallOption{grpc.StaticMethod()}, opts...)
	out := new(emptypb.Empty)
	err := c.cc.Invoke(ctx, GameProtocolPlugin_ResetConn_FullMethodName, in, out, cOpts...)
	if err != nil {
		return nil, err
	}
	return out, nil
}

// GameProtocolPluginServer is the server API for GameProtocolPlugin service.
// All implementations must embed UnimplementedGameProtocolPluginServer
// for forward compatibility.
type GameProtocolPluginServer interface {
	// æ’ä»¶å…ƒä¿¡æ¯
	Info(context.Context, *emptypb.Empty) (*PluginInfo, error)
	// è§£ç å…¥å£
	Decode(context.Context, *DecodeRequest) (*DecodeResponse, error)
	// è¿žæŽ¥é‡ç½®ï¼ˆæ–­çº¿ / å›žæ”¾é‡ç½®ï¼‰
	ResetConn(context.Context, *ResetConnRequest) (*emptypb.Empty, error)
	mustEmbedUnimplementedGameProtocolPluginServer()
}

// UnimplementedGameProtocolPluginServer must be embedded to have
// forward compatible implementations.
//
// NOTE: this should be embedded by value instead of pointer to avoid a nil
// pointer dereference when methods are called.
type UnimplementedGameProtocolPluginServer struct{}

func (UnimplementedGameProtocolPluginServer) Info(context.Context, *emptypb.Empty) (*PluginInfo, error) {
	return nil, status.Errorf(codes.Unimplemented, "method Info not implemented")
}
func (UnimplementedGameProtocolPluginServer) Decode(context.Context, *DecodeRequest) (*DecodeResponse, error) {
	return nil, status.Errorf(codes.Unimplemented, "method Decode not implemented")
}
func (UnimplementedGameProtocolPluginServer) ResetConn(context.Context, *ResetConnRequest) (*emptypb.Empty, error) {
	return nil, status.Errorf(codes.Unimplemented, "method ResetConn not implemented")
}
func (UnimplementedGameProtocolPluginServer) mustEmbedUnimplementedGameProtocolPluginServer() {}
func (UnimplementedGameProtocolPluginServer) testEmbeddedByValue()                            {}

// UnsafeGameProtocolPluginServer may be embedded to opt out of forward compatibility for this service.
// Use of this interface is not recommended, as added methods to GameProtocolPluginServer will
// result in compilation errors.
type UnsafeGameProtocolPluginServer interface {
	mustEmbedUnimplementedGameProtocolPluginServer()
}

func RegisterGameProtocolPluginServer(s grpc.ServiceRegistrar, srv GameProtocolPluginServer) {
	// If the following call pancis, it indicates UnimplementedGameProtocolPluginServer was
	// embedded by pointer and is nil.  This will cause panics if an
	// unimplemented method is ever invoked, so we test this at initialization
	// time to prevent it from happening at runtime later due to I/O.
	if t, ok := srv.(interface{ testEmbeddedByValue() }); ok {
		t.testEmbeddedByValue()
	}
	s.RegisterService(&GameProtocolPlugin_ServiceDesc, srv)
}

func _GameProtocolPlugin_Info_Handler(srv interface{}, ctx context.Context, dec func(interface{}) error, interceptor grpc.UnaryServerInterceptor) (interface{}, error) {
	in := new(emptypb.Empty)
	if err := dec(in); err != nil {
		return nil, err
	}
	if interceptor == nil {
		return srv.(GameProtocolPluginServer).Info(ctx, in)
	}
	info := &grpc.UnaryServerInfo{
		Server:     srv,
		FullMethod: GameProtocolPlugin_Info_FullMethodName,
	}
	handler := func(ctx context.Context, req interface{}) (interface{}, error) {
		return srv.(GameProtocolPluginServer).Info(ctx, req.(*emptypb.Empty))
	}
	return interceptor(ctx, in, info, handler)
}

func _GameProtocolPlugin_Decode_Handler(srv interface{}, ctx context.Context, dec func(interface{}) error, interceptor grpc.UnaryServerInterceptor) (interface{}, error) {
	in := new(DecodeRequest)
	if err := dec(in); err != nil {
		return nil, err
	}
	if interceptor == nil {
		return srv.(GameProtocolPluginServer).Decode(ctx, in)
	}
	info := &grpc.UnaryServerInfo{
		Server:     srv,
		FullMethod: GameProtocolPlugin_Decode_FullMethodName,
	}
	handler := func(ctx context.Context, req interface{}) (interface{}, error) {
		return srv.(GameProtocolPluginServer).Decode(ctx, req.(*DecodeRequest))
	}
	return interceptor(ctx, in, info, handler)
}

func _GameProtocolPlugin_ResetConn_Handler(srv interface{}, ctx context.Context, dec func(interface{}) error, interceptor grpc.UnaryServerInterceptor) (interface{}, error) {
	in := new(ResetConnRequest)
	if err := dec(in); err != nil {
		return nil, err
	}
	if interceptor == nil {
		return srv.(GameProtocolPluginServer).ResetConn(ctx, in)
	}
	info := &grpc.UnaryServerInfo{
		Server:     srv,
		FullMethod: GameProtocolPlugin_ResetConn_FullMethodName,
	}
	handler := func(ctx context.Context, req interface{}) (interface{}, error) {
		return srv.(GameProtocolPluginServer).ResetConn(ctx, req.(*ResetConnRequest))
	}
	return interceptor(ctx, in, info, handler)
}

// GameProtocolPlugin_ServiceDesc is the grpc.ServiceDesc for GameProtocolPlugin service.
// It's only intended for direct use with grpc.RegisterService,
// and not to be introspected or modified (even as a copy)
var GameProtocolPlugin_ServiceDesc = grpc.ServiceDesc{
	ServiceName: "plugin.GameProtocolPlugin",
	HandlerType: (*GameProtocolPluginServer)(nil),
	Methods: []grpc.MethodDesc{
		{
			MethodName: "Info",
			Handler:    _GameProtocolPlugin_Info_Handler,
		},
		{
			MethodName: "Decode",
			Handler:    _GameProtocolPlugin_Decode_Handler,
		},
		{
			MethodName: "ResetConn",
			Handler:    _GameProtocolPlugin_ResetConn_Handler,
		},
	},
	Streams:  []grpc.StreamDesc{},
	Metadata: "plugin.proto",
}

================
File: proto/plugin/plugin.pb.go
================
// Code generated by protoc-gen-go. DO NOT EDIT.
// versions:
// 	protoc-gen-go v1.36.9
// 	protoc        v3.21.4
// source: plugin.proto

package plugin

import (
	protoreflect "google.golang.org/protobuf/reflect/protoreflect"
	protoimpl "google.golang.org/protobuf/runtime/protoimpl"
	emptypb "google.golang.org/protobuf/types/known/emptypb"
	raw "proxy-system-backend/proto/raw"
	visual "proxy-system-backend/proto/visual"
	reflect "reflect"
	sync "sync"
	unsafe "unsafe"
)

const (
	// Verify that this generated code is sufficiently up-to-date.
	_ = protoimpl.EnforceVersion(20 - protoimpl.MinVersion)
	// Verify that runtime/protoimpl is sufficiently up-to-date.
	_ = protoimpl.EnforceVersion(protoimpl.MaxVersion - 20)
)

type DecodeRequest struct {
	state  protoimpl.MessageState `protogen:"open.v1"`
	Packet *raw.RawPacket         `protobuf:"bytes,1,opt,name=packet,proto3" json:"packet,omitempty"`
	// ç”±ä¸»ç¨‹åºé€‰æ‹©çš„åè®®ç‰ˆæœ¬
	ProtocolId    string `protobuf:"bytes,2,opt,name=protocol_id,json=protocolId,proto3" json:"protocol_id,omitempty"`
	unknownFields protoimpl.UnknownFields
	sizeCache     protoimpl.SizeCache
}

func (x *DecodeRequest) Reset() {
	*x = DecodeRequest{}
	mi := &file_plugin_proto_msgTypes[0]
	ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
	ms.StoreMessageInfo(mi)
}

func (x *DecodeRequest) String() string {
	return protoimpl.X.MessageStringOf(x)
}

func (*DecodeRequest) ProtoMessage() {}

func (x *DecodeRequest) ProtoReflect() protoreflect.Message {
	mi := &file_plugin_proto_msgTypes[0]
	if x != nil {
		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
		if ms.LoadMessageInfo() == nil {
			ms.StoreMessageInfo(mi)
		}
		return ms
	}
	return mi.MessageOf(x)
}

// Deprecated: Use DecodeRequest.ProtoReflect.Descriptor instead.
func (*DecodeRequest) Descriptor() ([]byte, []int) {
	return file_plugin_proto_rawDescGZIP(), []int{0}
}

func (x *DecodeRequest) GetPacket() *raw.RawPacket {
	if x != nil {
		return x.Packet
	}
	return nil
}

func (x *DecodeRequest) GetProtocolId() string {
	if x != nil {
		return x.ProtocolId
	}
	return ""
}

type DecodeResponse struct {
	state         protoimpl.MessageState  `protogen:"open.v1"`
	Messages      []*visual.VisualMessage `protobuf:"bytes,1,rep,name=messages,proto3" json:"messages,omitempty"`
	unknownFields protoimpl.UnknownFields
	sizeCache     protoimpl.SizeCache
}

func (x *DecodeResponse) Reset() {
	*x = DecodeResponse{}
	mi := &file_plugin_proto_msgTypes[1]
	ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
	ms.StoreMessageInfo(mi)
}

func (x *DecodeResponse) String() string {
	return protoimpl.X.MessageStringOf(x)
}

func (*DecodeResponse) ProtoMessage() {}

func (x *DecodeResponse) ProtoReflect() protoreflect.Message {
	mi := &file_plugin_proto_msgTypes[1]
	if x != nil {
		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
		if ms.LoadMessageInfo() == nil {
			ms.StoreMessageInfo(mi)
		}
		return ms
	}
	return mi.MessageOf(x)
}

// Deprecated: Use DecodeResponse.ProtoReflect.Descriptor instead.
func (*DecodeResponse) Descriptor() ([]byte, []int) {
	return file_plugin_proto_rawDescGZIP(), []int{1}
}

func (x *DecodeResponse) GetMessages() []*visual.VisualMessage {
	if x != nil {
		return x.Messages
	}
	return nil
}

type PluginInfo struct {
	state       protoimpl.MessageState `protogen:"open.v1"`
	Name        string                 `protobuf:"bytes,1,opt,name=name,proto3" json:"name,omitempty"`
	Game        string                 `protobuf:"bytes,2,opt,name=game,proto3" json:"game,omitempty"`
	Version     string                 `protobuf:"bytes,3,opt,name=version,proto3" json:"version,omitempty"`
	Author      string                 `protobuf:"bytes,4,opt,name=author,proto3" json:"author,omitempty"`
	Description string                 `protobuf:"bytes,5,opt,name=description,proto3" json:"description,omitempty"`
	// æ”¯æŒçš„åè®®ç‰ˆæœ¬
	Protocols     []*ProtocolDesc `protobuf:"bytes,6,rep,name=protocols,proto3" json:"protocols,omitempty"`
	unknownFields protoimpl.UnknownFields
	sizeCache     protoimpl.SizeCache
}

func (x *PluginInfo) Reset() {
	*x = PluginInfo{}
	mi := &file_plugin_proto_msgTypes[2]
	ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
	ms.StoreMessageInfo(mi)
}

func (x *PluginInfo) String() string {
	return protoimpl.X.MessageStringOf(x)
}

func (*PluginInfo) ProtoMessage() {}

func (x *PluginInfo) ProtoReflect() protoreflect.Message {
	mi := &file_plugin_proto_msgTypes[2]
	if x != nil {
		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
		if ms.LoadMessageInfo() == nil {
			ms.StoreMessageInfo(mi)
		}
		return ms
	}
	return mi.MessageOf(x)
}

// Deprecated: Use PluginInfo.ProtoReflect.Descriptor instead.
func (*PluginInfo) Descriptor() ([]byte, []int) {
	return file_plugin_proto_rawDescGZIP(), []int{2}
}

func (x *PluginInfo) GetName() string {
	if x != nil {
		return x.Name
	}
	return ""
}

func (x *PluginInfo) GetGame() string {
	if x != nil {
		return x.Game
	}
	return ""
}

func (x *PluginInfo) GetVersion() string {
	if x != nil {
		return x.Version
	}
	return ""
}

func (x *PluginInfo) GetAuthor() string {
	if x != nil {
		return x.Author
	}
	return ""
}

func (x *PluginInfo) GetDescription() string {
	if x != nil {
		return x.Description
	}
	return ""
}

func (x *PluginInfo) GetProtocols() []*ProtocolDesc {
	if x != nil {
		return x.Protocols
	}
	return nil
}

type ProtocolDesc struct {
	state         protoimpl.MessageState `protogen:"open.v1"`
	Id            string                 `protobuf:"bytes,1,opt,name=id,proto3" json:"id,omitempty"` // v1 / v2 / cn_2024
	DisplayName   string                 `protobuf:"bytes,2,opt,name=display_name,json=displayName,proto3" json:"display_name,omitempty"`
	unknownFields protoimpl.UnknownFields
	sizeCache     protoimpl.SizeCache
}

func (x *ProtocolDesc) Reset() {
	*x = ProtocolDesc{}
	mi := &file_plugin_proto_msgTypes[3]
	ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
	ms.StoreMessageInfo(mi)
}

func (x *ProtocolDesc) String() string {
	return protoimpl.X.MessageStringOf(x)
}

func (*ProtocolDesc) ProtoMessage() {}

func (x *ProtocolDesc) ProtoReflect() protoreflect.Message {
	mi := &file_plugin_proto_msgTypes[3]
	if x != nil {
		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
		if ms.LoadMessageInfo() == nil {
			ms.StoreMessageInfo(mi)
		}
		return ms
	}
	return mi.MessageOf(x)
}

// Deprecated: Use ProtocolDesc.ProtoReflect.Descriptor instead.
func (*ProtocolDesc) Descriptor() ([]byte, []int) {
	return file_plugin_proto_rawDescGZIP(), []int{3}
}

func (x *ProtocolDesc) GetId() string {
	if x != nil {
		return x.Id
	}
	return ""
}

func (x *ProtocolDesc) GetDisplayName() string {
	if x != nil {
		return x.DisplayName
	}
	return ""
}

type ResetConnRequest struct {
	state         protoimpl.MessageState `protogen:"open.v1"`
	ConnId        string                 `protobuf:"bytes,1,opt,name=conn_id,json=connId,proto3" json:"conn_id,omitempty"`
	unknownFields protoimpl.UnknownFields
	sizeCache     protoimpl.SizeCache
}

func (x *ResetConnRequest) Reset() {
	*x = ResetConnRequest{}
	mi := &file_plugin_proto_msgTypes[4]
	ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
	ms.StoreMessageInfo(mi)
}

func (x *ResetConnRequest) String() string {
	return protoimpl.X.MessageStringOf(x)
}

func (*ResetConnRequest) ProtoMessage() {}

func (x *ResetConnRequest) ProtoReflect() protoreflect.Message {
	mi := &file_plugin_proto_msgTypes[4]
	if x != nil {
		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
		if ms.LoadMessageInfo() == nil {
			ms.StoreMessageInfo(mi)
		}
		return ms
	}
	return mi.MessageOf(x)
}

// Deprecated: Use ResetConnRequest.ProtoReflect.Descriptor instead.
func (*ResetConnRequest) Descriptor() ([]byte, []int) {
	return file_plugin_proto_rawDescGZIP(), []int{4}
}

func (x *ResetConnRequest) GetConnId() string {
	if x != nil {
		return x.ConnId
	}
	return ""
}

var File_plugin_proto protoreflect.FileDescriptor

const file_plugin_proto_rawDesc = "" +
	"\n" +
	"\fplugin.proto\x12\x06plugin\x1a\x10raw_packet.proto\x1a\x14visual_message.proto\x1a\x1bgoogle/protobuf/empty.proto\"X\n" +
	"\rDecodeRequest\x12&\n" +
	"\x06packet\x18\x01 \x01(\v2\x0e.raw.RawPacketR\x06packet\x12\x1f\n" +
	"\vprotocol_id\x18\x02 \x01(\tR\n" +
	"protocolId\"C\n" +
	"\x0eDecodeResponse\x121\n" +
	"\bmessages\x18\x01 \x03(\v2\x15.visual.VisualMessageR\bmessages\"\xbc\x01\n" +
	"\n" +
	"PluginInfo\x12\x12\n" +
	"\x04name\x18\x01 \x01(\tR\x04name\x12\x12\n" +
	"\x04game\x18\x02 \x01(\tR\x04game\x12\x18\n" +
	"\aversion\x18\x03 \x01(\tR\aversion\x12\x16\n" +
	"\x06author\x18\x04 \x01(\tR\x06author\x12 \n" +
	"\vdescription\x18\x05 \x01(\tR\vdescription\x122\n" +
	"\tprotocols\x18\x06 \x03(\v2\x14.plugin.ProtocolDescR\tprotocols\"A\n" +
	"\fProtocolDesc\x12\x0e\n" +
	"\x02id\x18\x01 \x01(\tR\x02id\x12!\n" +
	"\fdisplay_name\x18\x02 \x01(\tR\vdisplayName\"+\n" +
	"\x10ResetConnRequest\x12\x17\n" +
	"\aconn_id\x18\x01 \x01(\tR\x06connId2\xc0\x01\n" +
	"\x12GameProtocolPlugin\x122\n" +
	"\x04Info\x12\x16.google.protobuf.Empty\x1a\x12.plugin.PluginInfo\x127\n" +
	"\x06Decode\x12\x15.plugin.DecodeRequest\x1a\x16.plugin.DecodeResponse\x12=\n" +
	"\tResetConn\x12\x18.plugin.ResetConnRequest\x1a\x16.google.protobuf.EmptyB*Z(proxy-system-backend/proto/plugin;pluginb\x06proto3"

var (
	file_plugin_proto_rawDescOnce sync.Once
	file_plugin_proto_rawDescData []byte
)

func file_plugin_proto_rawDescGZIP() []byte {
	file_plugin_proto_rawDescOnce.Do(func() {
		file_plugin_proto_rawDescData = protoimpl.X.CompressGZIP(unsafe.Slice(unsafe.StringData(file_plugin_proto_rawDesc), len(file_plugin_proto_rawDesc)))
	})
	return file_plugin_proto_rawDescData
}

var file_plugin_proto_msgTypes = make([]protoimpl.MessageInfo, 5)
var file_plugin_proto_goTypes = []any{
	(*DecodeRequest)(nil),        // 0: plugin.DecodeRequest
	(*DecodeResponse)(nil),       // 1: plugin.DecodeResponse
	(*PluginInfo)(nil),           // 2: plugin.PluginInfo
	(*ProtocolDesc)(nil),         // 3: plugin.ProtocolDesc
	(*ResetConnRequest)(nil),     // 4: plugin.ResetConnRequest
	(*raw.RawPacket)(nil),        // 5: raw.RawPacket
	(*visual.VisualMessage)(nil), // 6: visual.VisualMessage
	(*emptypb.Empty)(nil),        // 7: google.protobuf.Empty
}
var file_plugin_proto_depIdxs = []int32{
	5, // 0: plugin.DecodeRequest.packet:type_name -> raw.RawPacket
	6, // 1: plugin.DecodeResponse.messages:type_name -> visual.VisualMessage
	3, // 2: plugin.PluginInfo.protocols:type_name -> plugin.ProtocolDesc
	7, // 3: plugin.GameProtocolPlugin.Info:input_type -> google.protobuf.Empty
	0, // 4: plugin.GameProtocolPlugin.Decode:input_type -> plugin.DecodeRequest
	4, // 5: plugin.GameProtocolPlugin.ResetConn:input_type -> plugin.ResetConnRequest
	2, // 6: plugin.GameProtocolPlugin.Info:output_type -> plugin.PluginInfo
	1, // 7: plugin.GameProtocolPlugin.Decode:output_type -> plugin.DecodeResponse
	7, // 8: plugin.GameProtocolPlugin.ResetConn:output_type -> google.protobuf.Empty
	6, // [6:9] is the sub-list for method output_type
	3, // [3:6] is the sub-list for method input_type
	3, // [3:3] is the sub-list for extension type_name
	3, // [3:3] is the sub-list for extension extendee
	0, // [0:3] is the sub-list for field type_name
}

func init() { file_plugin_proto_init() }
func file_plugin_proto_init() {
	if File_plugin_proto != nil {
		return
	}
	type x struct{}
	out := protoimpl.TypeBuilder{
		File: protoimpl.DescBuilder{
			GoPackagePath: reflect.TypeOf(x{}).PkgPath(),
			RawDescriptor: unsafe.Slice(unsafe.StringData(file_plugin_proto_rawDesc), len(file_plugin_proto_rawDesc)),
			NumEnums:      0,
			NumMessages:   5,
			NumExtensions: 0,
			NumServices:   1,
		},
		GoTypes:           file_plugin_proto_goTypes,
		DependencyIndexes: file_plugin_proto_depIdxs,
		MessageInfos:      file_plugin_proto_msgTypes,
	}.Build()
	File_plugin_proto = out.File
	file_plugin_proto_goTypes = nil
	file_plugin_proto_depIdxs = nil
}

================
File: proto/raw_packet.proto
================
syntax = "proto3";

package  raw;
//ä»£ç†å±‚ â†’ æ’ä»¶
import "common.proto";

option go_package = "proxy-system-backend/proto/raw;raw";

message RawPacket {
  // è¿žæŽ¥å”¯ä¸€æ ‡è¯†ï¼ˆç”±ä»£ç†å±‚ç”Ÿæˆï¼‰
  string conn_id = 1;

  // æ—¶é—´æˆ³ï¼ˆå»ºè®®ç»Ÿä¸€ï¼šUnixNanoï¼‰
  int64 timestamp = 2;

  // æ•°æ®æ–¹å‘
  common.PacketDirection direction = 3;

  // ä¼ è¾“å±‚åè®®
  common.TransportType transport = 4;

  // åŽŸå§‹ payload
  bytes payload = 5;

  // å¯é€‰ï¼šè¿žæŽ¥ä¿¡æ¯ï¼ˆä¸»è¦ç”¨äºŽ UI / è°ƒè¯•ï¼‰
  string local_addr  = 6;
  string remote_addr = 7;
}

================
File: proto/raw/raw_packet.pb.go
================
// Code generated by protoc-gen-go. DO NOT EDIT.
// versions:
// 	protoc-gen-go v1.36.9
// 	protoc        v3.21.4
// source: raw_packet.proto

package raw

import (
	protoreflect "google.golang.org/protobuf/reflect/protoreflect"
	protoimpl "google.golang.org/protobuf/runtime/protoimpl"
	common "proxy-system-backend/proto/common"
	reflect "reflect"
	sync "sync"
	unsafe "unsafe"
)

const (
	// Verify that this generated code is sufficiently up-to-date.
	_ = protoimpl.EnforceVersion(20 - protoimpl.MinVersion)
	// Verify that runtime/protoimpl is sufficiently up-to-date.
	_ = protoimpl.EnforceVersion(protoimpl.MaxVersion - 20)
)

type RawPacket struct {
	state protoimpl.MessageState `protogen:"open.v1"`
	// è¿žæŽ¥å”¯ä¸€æ ‡è¯†ï¼ˆç”±ä»£ç†å±‚ç”Ÿæˆï¼‰
	ConnId string `protobuf:"bytes,1,opt,name=conn_id,json=connId,proto3" json:"conn_id,omitempty"`
	// æ—¶é—´æˆ³ï¼ˆå»ºè®®ç»Ÿä¸€ï¼šUnixNanoï¼‰
	Timestamp int64 `protobuf:"varint,2,opt,name=timestamp,proto3" json:"timestamp,omitempty"`
	// æ•°æ®æ–¹å‘
	Direction common.PacketDirection `protobuf:"varint,3,opt,name=direction,proto3,enum=common.PacketDirection" json:"direction,omitempty"`
	// ä¼ è¾“å±‚åè®®
	Transport common.TransportType `protobuf:"varint,4,opt,name=transport,proto3,enum=common.TransportType" json:"transport,omitempty"`
	// åŽŸå§‹ payload
	Payload []byte `protobuf:"bytes,5,opt,name=payload,proto3" json:"payload,omitempty"`
	// å¯é€‰ï¼šè¿žæŽ¥ä¿¡æ¯ï¼ˆä¸»è¦ç”¨äºŽ UI / è°ƒè¯•ï¼‰
	LocalAddr     string `protobuf:"bytes,6,opt,name=local_addr,json=localAddr,proto3" json:"local_addr,omitempty"`
	RemoteAddr    string `protobuf:"bytes,7,opt,name=remote_addr,json=remoteAddr,proto3" json:"remote_addr,omitempty"`
	unknownFields protoimpl.UnknownFields
	sizeCache     protoimpl.SizeCache
}

func (x *RawPacket) Reset() {
	*x = RawPacket{}
	mi := &file_raw_packet_proto_msgTypes[0]
	ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
	ms.StoreMessageInfo(mi)
}

func (x *RawPacket) String() string {
	return protoimpl.X.MessageStringOf(x)
}

func (*RawPacket) ProtoMessage() {}

func (x *RawPacket) ProtoReflect() protoreflect.Message {
	mi := &file_raw_packet_proto_msgTypes[0]
	if x != nil {
		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
		if ms.LoadMessageInfo() == nil {
			ms.StoreMessageInfo(mi)
		}
		return ms
	}
	return mi.MessageOf(x)
}

// Deprecated: Use RawPacket.ProtoReflect.Descriptor instead.
func (*RawPacket) Descriptor() ([]byte, []int) {
	return file_raw_packet_proto_rawDescGZIP(), []int{0}
}

func (x *RawPacket) GetConnId() string {
	if x != nil {
		return x.ConnId
	}
	return ""
}

func (x *RawPacket) GetTimestamp() int64 {
	if x != nil {
		return x.Timestamp
	}
	return 0
}

func (x *RawPacket) GetDirection() common.PacketDirection {
	if x != nil {
		return x.Direction
	}
	return common.PacketDirection(0)
}

func (x *RawPacket) GetTransport() common.TransportType {
	if x != nil {
		return x.Transport
	}
	return common.TransportType(0)
}

func (x *RawPacket) GetPayload() []byte {
	if x != nil {
		return x.Payload
	}
	return nil
}

func (x *RawPacket) GetLocalAddr() string {
	if x != nil {
		return x.LocalAddr
	}
	return ""
}

func (x *RawPacket) GetRemoteAddr() string {
	if x != nil {
		return x.RemoteAddr
	}
	return ""
}

var File_raw_packet_proto protoreflect.FileDescriptor

const file_raw_packet_proto_rawDesc = "" +
	"\n" +
	"\x10raw_packet.proto\x12\x03raw\x1a\fcommon.proto\"\x88\x02\n" +
	"\tRawPacket\x12\x17\n" +
	"\aconn_id\x18\x01 \x01(\tR\x06connId\x12\x1c\n" +
	"\ttimestamp\x18\x02 \x01(\x03R\ttimestamp\x125\n" +
	"\tdirection\x18\x03 \x01(\x0e2\x17.common.PacketDirectionR\tdirection\x123\n" +
	"\ttransport\x18\x04 \x01(\x0e2\x15.common.TransportTypeR\ttransport\x12\x18\n" +
	"\apayload\x18\x05 \x01(\fR\apayload\x12\x1d\n" +
	"\n" +
	"local_addr\x18\x06 \x01(\tR\tlocalAddr\x12\x1f\n" +
	"\vremote_addr\x18\a \x01(\tR\n" +
	"remoteAddrB$Z\"proxy-system-backend/proto/raw;rawb\x06proto3"

var (
	file_raw_packet_proto_rawDescOnce sync.Once
	file_raw_packet_proto_rawDescData []byte
)

func file_raw_packet_proto_rawDescGZIP() []byte {
	file_raw_packet_proto_rawDescOnce.Do(func() {
		file_raw_packet_proto_rawDescData = protoimpl.X.CompressGZIP(unsafe.Slice(unsafe.StringData(file_raw_packet_proto_rawDesc), len(file_raw_packet_proto_rawDesc)))
	})
	return file_raw_packet_proto_rawDescData
}

var file_raw_packet_proto_msgTypes = make([]protoimpl.MessageInfo, 1)
var file_raw_packet_proto_goTypes = []any{
	(*RawPacket)(nil),           // 0: raw.RawPacket
	(common.PacketDirection)(0), // 1: common.PacketDirection
	(common.TransportType)(0),   // 2: common.TransportType
}
var file_raw_packet_proto_depIdxs = []int32{
	1, // 0: raw.RawPacket.direction:type_name -> common.PacketDirection
	2, // 1: raw.RawPacket.transport:type_name -> common.TransportType
	2, // [2:2] is the sub-list for method output_type
	2, // [2:2] is the sub-list for method input_type
	2, // [2:2] is the sub-list for extension type_name
	2, // [2:2] is the sub-list for extension extendee
	0, // [0:2] is the sub-list for field type_name
}

func init() { file_raw_packet_proto_init() }
func file_raw_packet_proto_init() {
	if File_raw_packet_proto != nil {
		return
	}
	type x struct{}
	out := protoimpl.TypeBuilder{
		File: protoimpl.DescBuilder{
			GoPackagePath: reflect.TypeOf(x{}).PkgPath(),
			RawDescriptor: unsafe.Slice(unsafe.StringData(file_raw_packet_proto_rawDesc), len(file_raw_packet_proto_rawDesc)),
			NumEnums:      0,
			NumMessages:   1,
			NumExtensions: 0,
			NumServices:   0,
		},
		GoTypes:           file_raw_packet_proto_goTypes,
		DependencyIndexes: file_raw_packet_proto_depIdxs,
		MessageInfos:      file_raw_packet_proto_msgTypes,
	}.Build()
	File_raw_packet_proto = out.File
	file_raw_packet_proto_goTypes = nil
	file_raw_packet_proto_depIdxs = nil
}

================
File: proto/visual_message.proto
================
syntax = "proto3";

package visual;

import "common.proto";
import "google/protobuf/struct.proto";

option go_package = "proxy-system-backend/proto/visual;visual";

message VisualMessage {
  // æ’ä»¶ç”Ÿæˆçš„å”¯ä¸€ ID
  string id = 1;

  // æ‰€å±žè¿žæŽ¥
  string conn_id = 2;

  // æ—¶é—´æˆ³ï¼ˆé€šå¸¸ç»§æ‰¿ RawPacketï¼‰
  int64 timestamp = 3;

  // æ•°æ®æ–¹å‘
  common.PacketDirection direction = 4;

  // ===== å±•ç¤ºç›¸å…³ =====

  // æ¶ˆæ¯åï¼ˆLoginReq / Move / SyncDataï¼‰
  string name = 5;

  // åˆ†ç±»ï¼ˆauth / battle / sync / chatï¼‰
  string category = 6;

  // ä¸€è¡Œæ‘˜è¦ï¼ˆUI åˆ—è¡¨ç”¨ï¼‰
  string summary = 7;

  // ===== ç»“æž„åŒ–æ•°æ® =====

  // è§£ç åŽçš„å­—æ®µï¼ˆé€‚åˆæ ‘å½¢å±•ç¤ºï¼‰
  google.protobuf.Struct fields = 8;

  // ===== å¯é€‰é™„åŠ ä¿¡æ¯ =====

  // åŽŸå§‹æ•°æ®ï¼ˆå¯é€‰ï¼Œç”¨äºŽå¯¼å‡º / å›žæ”¾ï¼‰
  bytes raw = 9;

  // æ ‡ç­¾ï¼ˆæœç´¢ / é«˜äº® / è§„åˆ™ï¼‰
  repeated string tags = 10;
}

================
File: proto/visual/visual_message.pb.go
================
// Code generated by protoc-gen-go. DO NOT EDIT.
// versions:
// 	protoc-gen-go v1.36.9
// 	protoc        v3.21.4
// source: visual_message.proto

package visual

import (
	protoreflect "google.golang.org/protobuf/reflect/protoreflect"
	protoimpl "google.golang.org/protobuf/runtime/protoimpl"
	structpb "google.golang.org/protobuf/types/known/structpb"
	common "proxy-system-backend/proto/common"
	reflect "reflect"
	sync "sync"
	unsafe "unsafe"
)

const (
	// Verify that this generated code is sufficiently up-to-date.
	_ = protoimpl.EnforceVersion(20 - protoimpl.MinVersion)
	// Verify that runtime/protoimpl is sufficiently up-to-date.
	_ = protoimpl.EnforceVersion(protoimpl.MaxVersion - 20)
)

type VisualMessage struct {
	state protoimpl.MessageState `protogen:"open.v1"`
	// æ’ä»¶ç”Ÿæˆçš„å”¯ä¸€ ID
	Id string `protobuf:"bytes,1,opt,name=id,proto3" json:"id,omitempty"`
	// æ‰€å±žè¿žæŽ¥
	ConnId string `protobuf:"bytes,2,opt,name=conn_id,json=connId,proto3" json:"conn_id,omitempty"`
	// æ—¶é—´æˆ³ï¼ˆé€šå¸¸ç»§æ‰¿ RawPacketï¼‰
	Timestamp int64 `protobuf:"varint,3,opt,name=timestamp,proto3" json:"timestamp,omitempty"`
	// æ•°æ®æ–¹å‘
	Direction common.PacketDirection `protobuf:"varint,4,opt,name=direction,proto3,enum=common.PacketDirection" json:"direction,omitempty"`
	// æ¶ˆæ¯åï¼ˆLoginReq / Move / SyncDataï¼‰
	Name string `protobuf:"bytes,5,opt,name=name,proto3" json:"name,omitempty"`
	// åˆ†ç±»ï¼ˆauth / battle / sync / chatï¼‰
	Category string `protobuf:"bytes,6,opt,name=category,proto3" json:"category,omitempty"`
	// ä¸€è¡Œæ‘˜è¦ï¼ˆUI åˆ—è¡¨ç”¨ï¼‰
	Summary string `protobuf:"bytes,7,opt,name=summary,proto3" json:"summary,omitempty"`
	// è§£ç åŽçš„å­—æ®µï¼ˆé€‚åˆæ ‘å½¢å±•ç¤ºï¼‰
	Fields *structpb.Struct `protobuf:"bytes,8,opt,name=fields,proto3" json:"fields,omitempty"`
	// åŽŸå§‹æ•°æ®ï¼ˆå¯é€‰ï¼Œç”¨äºŽå¯¼å‡º / å›žæ”¾ï¼‰
	Raw []byte `protobuf:"bytes,9,opt,name=raw,proto3" json:"raw,omitempty"`
	// æ ‡ç­¾ï¼ˆæœç´¢ / é«˜äº® / è§„åˆ™ï¼‰
	Tags          []string `protobuf:"bytes,10,rep,name=tags,proto3" json:"tags,omitempty"`
	unknownFields protoimpl.UnknownFields
	sizeCache     protoimpl.SizeCache
}

func (x *VisualMessage) Reset() {
	*x = VisualMessage{}
	mi := &file_visual_message_proto_msgTypes[0]
	ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
	ms.StoreMessageInfo(mi)
}

func (x *VisualMessage) String() string {
	return protoimpl.X.MessageStringOf(x)
}

func (*VisualMessage) ProtoMessage() {}

func (x *VisualMessage) ProtoReflect() protoreflect.Message {
	mi := &file_visual_message_proto_msgTypes[0]
	if x != nil {
		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
		if ms.LoadMessageInfo() == nil {
			ms.StoreMessageInfo(mi)
		}
		return ms
	}
	return mi.MessageOf(x)
}

// Deprecated: Use VisualMessage.ProtoReflect.Descriptor instead.
func (*VisualMessage) Descriptor() ([]byte, []int) {
	return file_visual_message_proto_rawDescGZIP(), []int{0}
}

func (x *VisualMessage) GetId() string {
	if x != nil {
		return x.Id
	}
	return ""
}

func (x *VisualMessage) GetConnId() string {
	if x != nil {
		return x.ConnId
	}
	return ""
}

func (x *VisualMessage) GetTimestamp() int64 {
	if x != nil {
		return x.Timestamp
	}
	return 0
}

func (x *VisualMessage) GetDirection() common.PacketDirection {
	if x != nil {
		return x.Direction
	}
	return common.PacketDirection(0)
}

func (x *VisualMessage) GetName() string {
	if x != nil {
		return x.Name
	}
	return ""
}

func (x *VisualMessage) GetCategory() string {
	if x != nil {
		return x.Category
	}
	return ""
}

func (x *VisualMessage) GetSummary() string {
	if x != nil {
		return x.Summary
	}
	return ""
}

func (x *VisualMessage) GetFields() *structpb.Struct {
	if x != nil {
		return x.Fields
	}
	return nil
}

func (x *VisualMessage) GetRaw() []byte {
	if x != nil {
		return x.Raw
	}
	return nil
}

func (x *VisualMessage) GetTags() []string {
	if x != nil {
		return x.Tags
	}
	return nil
}

var File_visual_message_proto protoreflect.FileDescriptor

const file_visual_message_proto_rawDesc = "" +
	"\n" +
	"\x14visual_message.proto\x12\x06visual\x1a\fcommon.proto\x1a\x1cgoogle/protobuf/struct.proto\"\xae\x02\n" +
	"\rVisualMessage\x12\x0e\n" +
	"\x02id\x18\x01 \x01(\tR\x02id\x12\x17\n" +
	"\aconn_id\x18\x02 \x01(\tR\x06connId\x12\x1c\n" +
	"\ttimestamp\x18\x03 \x01(\x03R\ttimestamp\x125\n" +
	"\tdirection\x18\x04 \x01(\x0e2\x17.common.PacketDirectionR\tdirection\x12\x12\n" +
	"\x04name\x18\x05 \x01(\tR\x04name\x12\x1a\n" +
	"\bcategory\x18\x06 \x01(\tR\bcategory\x12\x18\n" +
	"\asummary\x18\a \x01(\tR\asummary\x12/\n" +
	"\x06fields\x18\b \x01(\v2\x17.google.protobuf.StructR\x06fields\x12\x10\n" +
	"\x03raw\x18\t \x01(\fR\x03raw\x12\x12\n" +
	"\x04tags\x18\n" +
	" \x03(\tR\x04tagsB*Z(proxy-system-backend/proto/visual;visualb\x06proto3"

var (
	file_visual_message_proto_rawDescOnce sync.Once
	file_visual_message_proto_rawDescData []byte
)

func file_visual_message_proto_rawDescGZIP() []byte {
	file_visual_message_proto_rawDescOnce.Do(func() {
		file_visual_message_proto_rawDescData = protoimpl.X.CompressGZIP(unsafe.Slice(unsafe.StringData(file_visual_message_proto_rawDesc), len(file_visual_message_proto_rawDesc)))
	})
	return file_visual_message_proto_rawDescData
}

var file_visual_message_proto_msgTypes = make([]protoimpl.MessageInfo, 1)
var file_visual_message_proto_goTypes = []any{
	(*VisualMessage)(nil),       // 0: visual.VisualMessage
	(common.PacketDirection)(0), // 1: common.PacketDirection
	(*structpb.Struct)(nil),     // 2: google.protobuf.Struct
}
var file_visual_message_proto_depIdxs = []int32{
	1, // 0: visual.VisualMessage.direction:type_name -> common.PacketDirection
	2, // 1: visual.VisualMessage.fields:type_name -> google.protobuf.Struct
	2, // [2:2] is the sub-list for method output_type
	2, // [2:2] is the sub-list for method input_type
	2, // [2:2] is the sub-list for extension type_name
	2, // [2:2] is the sub-list for extension extendee
	0, // [0:2] is the sub-list for field type_name
}

func init() { file_visual_message_proto_init() }
func file_visual_message_proto_init() {
	if File_visual_message_proto != nil {
		return
	}
	type x struct{}
	out := protoimpl.TypeBuilder{
		File: protoimpl.DescBuilder{
			GoPackagePath: reflect.TypeOf(x{}).PkgPath(),
			RawDescriptor: unsafe.Slice(unsafe.StringData(file_visual_message_proto_rawDesc), len(file_visual_message_proto_rawDesc)),
			NumEnums:      0,
			NumMessages:   1,
			NumExtensions: 0,
			NumServices:   0,
		},
		GoTypes:           file_visual_message_proto_goTypes,
		DependencyIndexes: file_visual_message_proto_depIdxs,
		MessageInfos:      file_visual_message_proto_msgTypes,
	}.Build()
	File_visual_message_proto = out.File
	file_visual_message_proto_goTypes = nil
	file_visual_message_proto_depIdxs = nil
}
